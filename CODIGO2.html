<!-- Basic Info Tab -->
<div id="basic-tab" class="tab-content">
    <h2 style="color: #ffd700; margin-bottom: 2rem;">üìã Informaci√≥n B√°sica</h2>
    
    <div class="form-grid">
        <div class="form-group">
            <label class="form-label">Nombre del Personaje</label>
            <input type="text" class="form-input" id="characterName" placeholder="Ej: Nombre del Personaje" 
                   onchange="updateCharacterDisplay()" oninput="updateCharacterDisplay()">
        </div>
        
        <div class="form-group">
            <label class="form-label">Jugador</label>
            <input type="text" class="form-input" id="playerName" placeholder="Tu nombre">
        </div>
        
        <div class="form-group">
            <label class="form-label">Raza</label>
            <select class="form-input" id="race" onchange="updateCharacterDisplay(); updateAllBasicStats();">
                <option value="">Selecciona Raza</option>
                <option value="humano">Humano</option>
                <option value="elfo">Elfo</option>
                <option value="enano">Enano</option>
                <option value="mediano">Mediano</option>
                <option value="orco">Orco</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">Alineamiento</label>
            <select class="form-input" id="alignment">
                <option value="LB">Legal Bueno</option>
                <option value="NB">Neutral Bueno</option>
                <option value="CB">Ca√≥tico Bueno</option>
                <option value="LN">Legal Neutral</option>
                <option value="N" selected>Neutral Aut√©ntico</option>
                <option value="CN">Ca√≥tico Neutral</option>
                <option value="LM">Legal Malvado</option>
                <option value="NM">Neutral Malvado</option>
                <option value="CM">Ca√≥tico Malvado</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">Altura (cm)</label>
            <input type="number" class="form-input" id="characterHeight" min="1" max="30000" 
       placeholder="Ej: 175" onchange="updateCharacterSize()" oninput="updateCharacterSize()">
        </div>

        <div class="form-group">
            <label class="form-label">Tama√±o</label>
            <input type="text" class="form-input" id="characterSize" value="Mediano" readonly>
        </div>

        <div class="form-group">
            <label class="form-label">Religi√≥n</label>
            <select class="form-input" id="religion">
                <option value="">Sin religi√≥n</option>
                <option value="ao">Ao (El Oculto)</option>
                <option value="lathander">Lathander</option>
                <option value="gond">Gond</option>
                <option value="tyr">Tyr</option>
                <option value="helm">Helm</option>
                <option value="tempus">Tempus</option>
                <option value="mystra">Mystra</option>
                <option value="selune">Sel√ªne</option>
                <option value="shar">Shar</option>
                <option value="cyric">Cyric</option>
                <option value="bane">Bane</option>
                <option value="bhaal">Bhaal</option>
                <option value="myrkul">Myrkul</option>
                <option value="kelemvor">Kelemvor</option>
                <option value="otro">Otro</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">Experiencia</label>
            <input type="number" class="form-input" id="experience" value="0" min="0"
       		onchange="updateFromXP()" oninput="updateFromXP()">
        </div>
        
        <div class="form-group">
            <label class="form-label">Nivel</label>
            <input type="number" class="form-input" id="Level" value="1" min="1" max="20"
       			onchange="updateFromLevel()" oninput="updateFromLevel()">
        </div>
    </div>

    <!-- Salvaciones -->
    <div class="combat-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üõ°Ô∏è Tiradas de Salvaci√≥n</h3>
        
        <!-- Encabezados -->
        <div class="saves-headers">
            <div class="save-type-header">Tipo de Salvaci√≥n</div>
            <div class="save-data-headers">
                <span class="header-item">Base</span>
                <span class="header-item">Mod1</span>
                <span class="header-item">Mod2</span>
                <span class="header-item">Total</span>
            </div>
        </div>
        
        <div class="saving-throws-vertical" id="saving-throws">
            <div class="saving-throw-row">
                <div class="save-type-name">Par√°lisis/Veneno/Muerte</div>
                <div class="save-data-row">
                    <span class="save-value" id="save-paralysis-base">14</span>
                    <input type="number" id="save-paralysis-mod1" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <input type="number" id="save-paralysis-mod2" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <span class="save-total-value" id="save-paralysis-total">14</span>
                </div>
            </div>
            
            <div class="saving-throw-row">
                <div class="save-type-name">Cetros/Varas/Varitas</div>
                <div class="save-data-row">
                    <span class="save-value" id="save-rods-base">16</span>
                    <input type="number" id="save-rods-mod1" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <input type="number" id="save-rods-mod2" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <span class="save-total-value" id="save-rods-total">16</span>
                </div>
            </div>
            
            <div class="saving-throw-row">
                <div class="save-type-name">Petrificaci√≥n/Polimorfismo</div>
                <div class="save-data-row">
                    <span class="save-value" id="save-petrification-base">12</span>
                    <input type="number" id="save-petrification-mod1" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <input type="number" id="save-petrification-mod2" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <span class="save-total-value" id="save-petrification-total">12</span>
                </div>
            </div>
            
            <div class="saving-throw-row">
                <div class="save-type-name">Arma de Aliento</div>
                <div class="save-data-row">
                    <span class="save-value" id="save-breath-base">17</span>
                    <input type="number" id="save-breath-mod1" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <input type="number" id="save-breath-mod2" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <span class="save-total-value" id="save-breath-total">17</span>
                </div>
            </div>
            
            <div class="saving-throw-row">
                <div class="save-type-name">Conjuros</div>
                <div class="save-data-row">
                    <span class="save-value" id="save-spells-base">17</span>
                    <input type="number" id="save-spells-mod1" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <input type="number" id="save-spells-mod2" value="0" class="save-modifier-input" 
                           oninput="updateSavingThrows()">
                    <span class="save-total-value" id="save-spells-total">17</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Display -->
    <div class="stats-row">
        <div class="stat-card">
    <div class="stat-value-container">
        <div class="stat-value" id="totalHP">10</div>
        <div class="stat-detail" id="hp-breakdown">Base: 10</div>
        <input type="number" id="hp-manual-bonus" value="0" class="manual-bonus-input" 
               placeholder="Bonus" oninput="updateHitPoints()">
    	</div>
    	<div class="stat-label">Puntos de Golpe</div>
    </div>
        
        <!-- Man√° Arcano - Solo para Hechiceros -->
<div class="stat-card mana-card" id="arcane-mana-card" style="display: none;">
    <div class="stat-value-container">
        <div class="stat-value" id="arcaneMana">0</div>
        <div class="stat-detail" id="arcane-mana-breakdown">0/0</div>
        <input type="number" id="arcane-mana-manual" value="0" class="manual-bonus-input" 
               placeholder="Bonus" oninput="updateArcaneMana()">
    </div>
    <div class="stat-label">Man√° Arcano</div>
</div>
        
        <!-- Man√° Divino - Solo para Sacerdotes -->
        <div class="stat-card mana-card" id="divine-mana-card" style="display: none;">
    <div class="stat-value-container">
        <div class="stat-value" id="divineMana">0</div>
        <div class="stat-detail" id="divine-mana-breakdown">0/0</div>
        <input type="number" id="divine-mana-manual" value="0" class="manual-bonus-input" 
               placeholder="Bonus" oninput="updateDivineMana()">
    </div>
    <div class="stat-label">Man√° Divino</div>
</div>
        
        <!-- Pool PSP - Solo para Psi√≥nicos -->
        <div class="stat-card psp-card" id="psp-card" style="display: none;">
    <div class="stat-value-container">
        <div class="stat-value" id="pspPool">0</div>
        <div class="stat-detail" id="psp-breakdown">Base + Mods</div>
        <input type="number" id="psp-manual" value="0" class="manual-bonus-input" 
               placeholder="Bonus" oninput="updatePSPPool()">
    </div>
    <div class="stat-label">Pool PSP</div>
</div>

    <!-- Informaci√≥n de Progreso XP/Nivel -->
    <div class="xp-progress-section">
        <div id="nextLevelInfo" class="next-level-info">
            <strong>Nivel 1</strong><br>
            <small>Selecciona clases para ver progreso XP</small>
        </div>
    </div>
</div>

<style>
/* Estilos adicionales para el Tab B√°sico mejorado */

.xp-progress-section {
    margin-top: 2rem;
    display: flex;
    justify-content: center;
}

.next-level-info {
    max-width: 500px;
    padding: 1rem;
    background: rgba(255, 215, 0, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 8px;
    font-size: 0.9rem;
    color: #ffd700;
    line-height: 1.5;
    text-align: center;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    margin-top: 8px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffd700, #ffed4e);
    transition: width 0.3s ease;
    border-radius: 4px;
}

/* Mejorar visibilidad de stats por clase */
.mana-card {
    border: 2px solid rgba(138, 43, 226, 0.4);
    background: linear-gradient(135deg, rgba(75, 0, 130, 0.15), rgba(138, 43, 226, 0.15));
}

.psp-card {
    border: 2px solid rgba(199, 21, 133, 0.4);
    background: linear-gradient(135deg, rgba(255, 20, 147, 0.15), rgba(199, 21, 133, 0.15));
}

.stat-value-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.stat-detail {
    font-size: 0.8rem;
    color: #b0b0b0;
    text-align: center;
    min-height: 20px;
    font-weight: 500;
}

.manual-bonus-input {
    width: 70px;
    padding: 0.3rem;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    color: #e5e5e5;
    font-size: 0.8rem;
    text-align: center;
    margin-top: 0.3rem;
}

.manual-bonus-input:focus {
    outline: none;
    border-color: #ffd700;
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 8px rgba(255, 215, 0, 0.2);
}

.manual-bonus-input::placeholder {
    color: #666;
    font-size: 0.7rem;
}

/* Mejorar responsive */
@media (max-width: 768px) {
    .stats-row {
        grid-template-columns: 1fr;
    }
    
    .saves-headers {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
    }
    
    .saving-throw-row {
        flex-direction: column;
        gap: 0.8rem;
        text-align: center;
    }
    
    .save-data-row {
        justify-content: center;
        flex-wrap: wrap;
    }
}
</style>

<!-- Abilities Tab -->
<div id="abilities-tab" class="tab-content">
    <h2 style="color: #ffd700; margin-bottom: 2rem;">üí™ Caracter√≠sticas</h2>

<!-- Controles superiores -->
<div class="abilities-controls">
    <div class="control-group">
        <button class="btn btn-secondary" onclick="rollAbilities()">üé≤ Rodar Stats (4d6)</button>
        <button class="btn btn-secondary" onclick="rollAbilitiesStandard()">üéØ Rodar Standard (3d6)</button>
        <button class="btn btn-secondary" onclick="setAbilitiesToAverage()">üìä Valores Promedio</button>
    </div>
    
    <div class="debug-toggle">
        <label>
            <input type="checkbox" id="showDebugInfo" onchange="toggleDebugInfo()"> 
            Mostrar Debug
        </label>
    </div>
</div>
    
    <!-- Controles superiores -->
    <div class="abilities-controls">
        <div class="control-group">
            <button class="btn btn-secondary" onclick="rollAbilities()">üé≤ Rodar Stats (4d6)</button>
            <button class="btn btn-secondary" onclick="rollAbilitiesStandard()">üéØ Rodar Standard (3d6)</button>
            <button class="btn btn-secondary" onclick="setAbilitiesToAverage()">üìä Valores Promedio</button>
        </div>
        
        <div class="debug-toggle">
            <label>
                <input type="checkbox" id="showDebugInfo" onchange="toggleDebugInfo()"> 
                Mostrar Debug
            </label>
        </div>
    </div>

    <!-- Debug info (oculto por defecto) -->
    <div class="debug-info" id="debug-info" style="display: none;">
        Status: Sistema de c√°lculo listo
    </div>
    
    <div class="abilities-grid">
        <!-- FUERZA -->
        <div class="ability-card">
            <div class="ability-name">Fuerza</div>
            <div class="ability-main-row">
                <input type="number" class="ability-input" id="strength" min="1" max="65" value="10" 
       			oninput="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();"
       		        onchange="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();">
                <div class="ability-details-row">
                    <div class="ability-detail-box">
                        <span class="detail-name">Golpe</span>
                        <span class="detail-value" id="str-hit-prob">+0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Da√±o</span>
                        <span class="detail-value" id="str-damage-adj">+0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Peso</span>
                        <span class="detail-value" id="str-weight-cap">0kg</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Esf. M√°x.</span>
                        <span class="detail-value" id="str-max-effort">0kg</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Puertas</span>
                        <span class="detail-value" id="str-open-doors">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Barras</span>
                        <span class="detail-value" id="str-bend-bar">0%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- DESTREZA -->
        <div class="ability-card">
            <div class="ability-name">Destreza</div>
            <div class="ability-main-row">
                <input type="number" class="ability-input" id="dexterity" min="1" max="65" value="10" 
                       oninput="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();"
       		        onchange="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();">
                <div class="ability-details-row">
                    <div class="ability-detail-box">
                        <span class="detail-name">Ajuste Reacci√≥n</span>
                        <span class="detail-value" id="dex-reaction">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Atq. Proyectiles</span>
                        <span class="detail-value" id="dex-missile">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Def. CA</span>
                        <span class="detail-value" id="dex-defensive">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CONSTITUCI√ìN -->
        <div class="ability-card">
            <div class="ability-name">Constituci√≥n</div>
            <div class="ability-main-row">
                <input type="number" class="ability-input" id="constitution" min="1" max="65" value="10" 
                       oninput="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();"
       		        onchange="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();">
                <div class="ability-details-row">
                    <div class="ability-detail-box">
                        <span class="detail-name">HP/Nivel</span>
                        <span class="detail-value" id="con-hp-bonus">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Shock Sistema</span>
                        <span class="detail-value" id="con-shock-survival">0%</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Superv. Revivir</span>
                        <span class="detail-value" id="con-resurrection">0%</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Prot. Veneno</span>
                        <span class="detail-value" id="con-poison">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Regeneraci√≥n</span>
                        <span class="detail-value" id="con-regeneration">--</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- INTELIGENCIA -->
        <div class="ability-card">
            <div class="ability-name">Inteligencia</div>
            <div class="ability-main-row">
                <input type="number" class="ability-input" id="intelligence" min="1" max="65" value="10" 
                       oninput="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();"
       		        onchange="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();">
                <div class="ability-details-row">
                    <div class="ability-detail-box">
                        <span class="detail-name">Idiomas</span>
                        <span class="detail-value" id="int-languages">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Niv. Conjuros</span>
                        <span class="detail-value" id="int-spell-level">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Oport. Conjuros</span>
                        <span class="detail-value" id="int-spell-chance">0%</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Max Conjuros</span>
                        <span class="detail-value" id="int-max-spells">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Inmunidad</span>
                        <span class="detail-value" id="int-immunity">--</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SABIDUR√çA -->
        <div class="ability-card">
            <div class="ability-name">Sabidur√≠a</div>
            <div class="ability-main-row">
                <input type="number" class="ability-input" id="wisdom" min="1" max="65" value="10" 
                       oninput="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();"
       		        onchange="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();">
                <div class="ability-details-row">
                    <div class="ability-detail-box">
                        <span class="detail-name">Def. M√°gica</span>
                        <span class="detail-value" id="wis-magic-defense">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Bonif. Conjuros</span>
                        <span class="detail-value" id="wis-spell-bonus">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Fracaso Conjuro</span>
                        <span class="detail-value" id="wis-spell-failure">0%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CARISMA -->
        <div class="ability-card">
            <div class="ability-name">Carisma</div>
            <div class="ability-main-row">
                <input type="number" class="ability-input" id="charisma" min="1" max="65" value="10" 
                       oninput="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();"
       		        onchange="window.AbilityCalculator.calculateModifiers(); updateAllConnectedSystems();">
                <div class="ability-details-row">
                    <div class="ability-detail-box">
                        <span class="detail-name">N¬∫ Servidores</span>
                        <span class="detail-value" id="cha-max-servers">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Lealtad Base</span>
                        <span class="detail-value" id="cha-base-loyalty">0</span>
                    </div>
                    <div class="ability-detail-box">
                        <span class="detail-name">Ajuste Reacci√≥n</span>
                        <span class="detail-value" id="cha-reaction-adj">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resumen de Modificadores -->
    <div class="modifiers-summary">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üìä Resumen de Modificadores</h3>
        <div class="summary-grid">
            <div class="summary-item">
                <span class="summary-label">Ataques Cuerpo a Cuerpo:</span>
                <span class="summary-value" id="summary-melee-attack">+0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Da√±o Cuerpo a Cuerpo:</span>
                <span class="summary-value" id="summary-melee-damage">+0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Ataques a Distancia:</span>
                <span class="summary-value" id="summary-ranged-attack">+0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Bonificaci√≥n CA:</span>
                <span class="summary-value" id="summary-ac-bonus">+0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">HP por Nivel:</span>
                <span class="summary-value" id="summary-hp-bonus">+0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Idiomas Adicionales:</span>
                <span class="summary-value" id="summary-languages">0</span>
            </div>
        </div>
    </div>

    <!-- Puntuaciones Extraordinarias -->
    <div class="extraordinary-scores" id="extraordinary-scores" style="display: none;">
        <h4 style="color: #ffed4e;">‚ö° Puntuaciones Extraordinarias</h4>
        <div id="extraordinary-list"></div>
    </div>
</div>

<style>
/* Estilos adicionales y mejoras para el Tab Habilidades */

.abilities-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.control-group {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.debug-toggle {
    color: #b0b0b0;
    font-size: 0.85rem;
}

.debug-toggle input[type="checkbox"] {
    margin-right: 0.5rem;
}

.ability-input {
    transition: all 0.3s ease;
    font-weight: bold;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}

.ability-input:focus {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
}

.detail-value {
    transition: all 0.3s ease;
    font-weight: bold;
}

.detail-value.positive {
    color: #4CAF50;
    text-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
}

.detail-value.negative {
    color: #f44336;
    text-shadow: 0 0 8px rgba(244, 67, 54, 0.3);
}

.detail-value.neutral {
    color: #e5e5e5;
}

.detail-value.special {
    color: #ff9800;
    text-shadow: 0 0 8px rgba(255, 152, 0, 0.3);
}

.modifiers-summary {
    margin-top: 2rem;
    padding: 1.5rem;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    border: 1px solid rgba(255, 215, 0, 0.2);
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    border-left: 3px solid #ffd700;
}

.summary-label {
    color: #e5e5e5;
    font-weight: 500;
}

.summary-value {
    color: #ffd700;
    font-weight: bold;
    font-size: 1.1rem;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
}

.extraordinary-scores {
    margin-top: 2rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.1));
    border-radius: 12px;
    border: 2px solid rgba(255, 215, 0, 0.3);
    animation: pulse-glow 2s infinite alternate;
}

@keyframes pulse-glow {
    from { box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
    to { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
}

.extraordinary-item {
    margin: 0.5rem 0;
    color: #ffed4e;
    font-weight: bold;
}

.debug-info {
    background-color: rgba(26, 26, 26, 0.9);
    border: 1px solid #333;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    color: #4CAF50;
    transition: all 0.3s ease;
}

.debug-info.error {
    color: #f44336;
    border-color: #f44336;
}

.debug-info.warning {
    color: #ff9800;
    border-color: #ff9800;
}

/* Animaci√≥n para cambios de valores */
@keyframes value-change {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.value-changed {
    animation: value-change 0.3s ease;
}

/* Responsive improvements */
@media (max-width: 1024px) {
    .abilities-grid {
        grid-template-columns: 1fr;
    }
    
    .ability-details-row {
        grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
    }
}

@media (max-width: 768px) {
    .abilities-controls {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .summary-grid {
        grid-template-columns: 1fr;
    }
    
    .ability-details-row {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<!-- Combat Tab -->
<div id="combat-tab" class="tab-content">
    <h2 style="color: #ffd700; margin-bottom: 2rem;">‚öîÔ∏è Combate</h2>

    <!-- Stats de Combate -->
    <div class="combat-stats-row">
        <div class="stat-card combat-stat">
            <div class="stat-value" id="combatAC">10</div>
            <div class="stat-label">Clase de Armadura</div>
            <div class="stat-detail" id="ac-calculation">Base + Dex</div>
        </div>
        <div class="stat-card combat-stat">
            <div class="stat-value" id="combatGaco">20</div>
            <div class="stat-label">GACO Base</div>
            <div class="stat-detail" id="gaco-calculation">Por clase/nivel</div>
        </div>
        <div class="stat-card combat-stat">
            <div class="stat-value" id="combatInitiative">+0</div>
            <div class="stat-label">Iniciativa</div>
            <div class="stat-detail">Mod. Destreza</div>
        </div>
        <div class="stat-card combat-stat">
            <div class="stat-value" id="combatMovement">12</div>
            <div class="stat-label">Movimiento</div>
            <div class="stat-detail" id="movement-calculation">Seg√∫n armadura</div>
        </div>
    </div>

    <!-- Armas Equipadas -->
    <div class="combat-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">‚öîÔ∏è Armas Equipadas</h3>
        
        <div class="equipped-weapons" id="equipped-weapons-container">
            <div class="weapon-slot-combat" id="main-hand-slot">
                <div class="slot-label">üó°Ô∏è Mano Principal</div>
                <div class="weapon-info" id="main-hand-weapon">
                    <div class="weapon-name-combat" id="main-hand-name">Pu√±os</div>
                    <div class="weapon-stats-combat">
                        <span class="weapon-gaco" id="main-hand-gaco">GACO: 20</span>
                        <span class="weapon-damage" id="main-hand-damage">Da√±o: 1d2</span>
                        <span class="weapon-speed" id="main-hand-speed">Vel: 2</span>
                        <span class="weapon-attacks" id="main-hand-attacks">Ataques: 1/ronda</span>
                    </div>
                </div>
                <button class="equip-weapon-btn" onclick="openWeaponSelector('main-hand')">Cambiar Arma</button>
            </div>

            <div class="weapon-slot-combat" id="off-hand-slot">
                <div class="slot-label">üõ°Ô∏è Mano Secundaria</div>
                <div class="weapon-info" id="off-hand-weapon">
                    <div class="weapon-name-combat" id="off-hand-name">Vac√≠o</div>
                    <div class="weapon-stats-combat">
                        <span class="weapon-note">Segunda arma o escudo</span>
                    </div>
                </div>
                <button class="equip-weapon-btn" onclick="openWeaponSelector('off-hand')">Equipar</button>
            </div>

            <div class="weapon-slot-combat" id="ranged-slot">
                <div class="slot-label">üèπ Arma a Distancia</div>
                <div class="weapon-info" id="ranged-weapon">
                    <div class="weapon-name-combat" id="ranged-name">Sin Arma</div>
                    <div class="weapon-stats-combat">
                        <span class="weapon-gaco" id="ranged-gaco">GACO: --</span>
                        <span class="weapon-damage" id="ranged-damage">Da√±o: --</span>
                        <span class="weapon-range" id="ranged-range">Alcance: --</span>
                    </div>
                </div>
                <button class="equip-weapon-btn" onclick="openWeaponSelector('ranged')">Equipar</button>
            </div>
        </div>
    </div>

    <!-- Especializaci√≥n en Armas -->
    <div class="combat-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üéØ Especializaci√≥n en Armas</h3>
        
        <div class="weapon-specialization" id="weapon-specialization">
            <div class="specialization-info">
                <p style="color: #b0b0b0; font-style: italic; text-align: center;">
                    La especializaci√≥n en armas se gestiona desde la pesta√±a <strong>Pericias</strong>.<br>
                    Las bonificaciones aparecer√°n aqu√≠ autom√°ticamente.
                </p>
            </div>
            
            <div class="active-specializations" id="active-specializations">
                <!-- Se llenar√° din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Estilos de Combate Activos -->
    <div class="combat-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">ü•ã Estilos de Combate</h3>
        
        <div class="active-combat-styles" id="active-combat-styles">
            <div class="no-styles-active" id="no-styles-message">
                <p style="color: #b0b0b0; font-style: italic; text-align: center;">
                    Los estilos de combate se aprenden en la pesta√±a <strong>Pericias</strong>.<br>
                    <small>Solo disponibles para clases de Luchador.</small>
                </p>
            </div>
        </div>
    </div>

    <!-- Armadura y Protecci√≥n -->
    <div class="combat-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üõ°Ô∏è Armadura y Protecci√≥n</h3>
        
        <div class="armor-protection-grid">
            <div class="armor-slot-combat" id="body-armor-slot">
                <div class="armor-type-label">Armadura Corporal</div>
                <div class="armor-info" id="body-armor-info">
                    <div class="armor-name" id="body-armor-name">Sin Armadura</div>
                    <div class="armor-stats">
                        <span class="armor-ac" id="body-armor-ac">CA: 10</span>
                        <span class="armor-dex-bonus" id="body-armor-dex">Dex: Sin l√≠mite</span>
                        <span class="armor-speed" id="body-armor-speed">Mov: 12</span>
                    </div>
                </div>
                <button class="change-armor-btn" onclick="openArmorSelector('body')">Cambiar</button>
            </div>

            <div class="armor-slot-combat" id="shield-slot">
                <div class="armor-type-label">Escudo</div>
                <div class="armor-info" id="shield-info">
                    <div class="armor-name" id="shield-name">Sin Escudo</div>
                    <div class="armor-stats">
                        <span class="shield-ac" id="shield-ac">CA: +0</span>
                        <span class="shield-attacks" id="shield-attacks">Ataques: +0</span>
                    </div>
                </div>
                <button class="change-armor-btn" onclick="openArmorSelector('shield')">Cambiar</button>
            </div>
        </div>

        <!-- Modificadores de CA -->
        <div class="ac-modifiers" id="ac-breakdown">
            <h4 style="color: #ffd700; margin-bottom: 0.5rem;">Desglose de CA:</h4>
            <div class="ac-breakdown-list">
                <div class="ac-modifier-item">
                    <span>Armadura base:</span>
                    <span id="ac-base-armor">10</span>
                </div>
                <div class="ac-modifier-item">
                    <span>Modificador de Destreza:</span>
                    <span id="ac-dex-mod">0</span>
                </div>
                <div class="ac-modifier-item">
                    <span>Escudo:</span>
                    <span id="ac-shield">0</span>
                </div>
                <div class="ac-modifier-item">
                    <span>Estilos de combate:</span>
                    <span id="ac-style-bonus">0</span>
                </div>
                <div class="ac-modifier-item">
                    <span>Bonificaciones m√°gicas:</span>
                    <span id="ac-magic-bonus">0</span>
                </div>
                <div class="ac-modifier-item">
                    <span>Otros modificadores:</span>
                    <span id="ac-other-bonus">0</span>
                </div>
                <div class="ac-modifier-total">
                    <span><strong>CA Total:</strong></span>
                    <span id="ac-total"><strong>10</strong></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Ataques por Ronda -->
    <div class="combat-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">‚ö° Ataques por Ronda</h3>
        
        <div class="attacks-per-round" id="attacks-breakdown">
            <div class="attacks-grid">
                <div class="attacks-main-hand">
                    <h5 style="color: #ffd700;">Mano Principal</h5>
                    <div class="attacks-info">
                        <div class="attacks-stat">
                            <span class="attacks-label">Ataques base:</span>
                            <span class="attacks-value" id="base-attacks-main">1</span>
                        </div>
                        <div class="attacks-stat">
                            <span class="attacks-label">Por especializaci√≥n:</span>
                            <span class="attacks-value" id="specialization-attacks-main">+0</span>
                        </div>
                        <div class="attacks-stat">
                            <span class="attacks-label">Por estilos:</span>
                            <span class="attacks-value" id="style-attacks-main">+0</span>
                        </div>
                        <div class="attacks-total">
                            <span class="attacks-label"><strong>Total:</strong></span>
                            <span class="attacks-value" id="total-attacks-main"><strong>1</strong></span>
                        </div>
                    </div>
                </div>
                
                <div class="attacks-off-hand" id="attacks-off-hand-section" style="display: none;">
                    <h5 style="color: #ffd700;">Mano Secundaria</h5>
                    <div class="attacks-info">
                        <div class="attacks-stat">
                            <span class="attacks-label">Ataques base:</span>
                            <span class="attacks-value" id="base-attacks-off">1</span>
                        </div>
                        <div class="attacks-stat">
                            <span class="attacks-label">Penalizadores:</span>
                            <span class="attacks-value" id="penalty-attacks-off">-2/-4</span>
                        </div>
                        <div class="attacks-stat">
                            <span class="attacks-label">Por estilos:</span>
                            <span class="attacks-value" id="style-attacks-off">+0</span>
                        </div>
                        <div class="attacks-total">
                            <span class="attacks-label"><strong>GACO Efectivo:</strong></span>
                            <span class="attacks-value" id="effective-gaco-off"><strong>--</strong></span>
                        </div>
                    </div>
                </div>

                <div class="attacks-ranged">
                    <h5 style="color: #ffd700;">Arma a Distancia</h5>
                    <div class="attacks-info">
                        <div class="attacks-stat">
                            <span class="attacks-label">Ataques base:</span>
                            <span class="attacks-value" id="base-attacks-ranged">1</span>
                        </div>
                        <div class="attacks-stat">
                            <span class="attacks-label">Por especializaci√≥n:</span>
                            <span class="attacks-value" id="specialization-attacks-ranged">+0</span>
                        </div>
                        <div class="attacks-stat">
                            <span class="attacks-label">Cadencia:</span>
                            <span class="attacks-value" id="rate-of-fire">1/ronda</span>
                        </div>
                        <div class="attacks-total">
                            <span class="attacks-label"><strong>Total:</strong></span>
                            <span class="attacks-value" id="total-attacks-ranged"><strong>1</strong></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="attacks-note">
                <p style="color: #b0b0b0; font-size: 0.9rem; font-style: italic;">
                    <strong>Nota:</strong> Los ataques fraccionarios (como 3/2) se alternan entre rondas.<br>
                    <strong>Ejemplo:</strong> 1.5 ataques = 2 ataques en ronda 1, 1 ataque en ronda 2, etc.
                </p>
            </div>
        </div>
    </div>

    <!-- Acciones de Combate R√°pidas -->
    <div class="combat-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">‚ö° Acciones R√°pidas</h3>
        
        <div class="quick-combat-actions">
            <button class="combat-action-btn" onclick="rollInitiative()">
                üé≤ Rodar Iniciativa
            </button>
            <button class="combat-action-btn" onclick="rollToHitMainHand()">
                ‚öîÔ∏è Atacar (Principal)
            </button>
            <button class="combat-action-btn" onclick="rollDamageMainHand()">
                üí• Da√±o (Principal)
            </button>
            <button class="combat-action-btn" onclick="rollToHitRanged()" id="ranged-attack-btn" style="display: none;">
                üèπ Atacar (Distancia)
            </button>
            <button class="combat-action-btn" onclick="rollSavingThrow()">
                üõ°Ô∏è Tirada Salvaci√≥n
            </button>
        </div>
    </div>

</div>

<style>
/* Estilos espec√≠ficos para Combat Tab */
.combat-stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.combat-stat {
    background: linear-gradient(135deg, rgba(220, 20, 60, 0.12), rgba(255, 69, 0, 0.12));
    border: 2px solid rgba(220, 20, 60, 0.4);
    position: relative;
    overflow: hidden;
}

.combat-stat::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, transparent, #dc143c, transparent);
    animation: sweep 3s infinite;
}

@keyframes sweep {
    0% { left: -100%; }
    100% { left: 100%; }
}

.stat-detail {
    font-size: 0.75rem;
    color: #b0b0b0;
    margin-top: 0.3rem;
    text-align: center;
    font-style: italic;
}

.combat-section {
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    position: relative;
}

.combat-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #ffd700, #ffed4e, #ffd700);
    border-radius: 12px 12px 0 0;
}

/* Armas Equipadas */
.equipped-weapons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
}

.weapon-slot-combat {
    background: rgba(0, 0, 0, 0.4);
    border: 2px dashed rgba(255, 255, 255, 0.25);
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
}

.weapon-slot-combat:hover {
    border-color: rgba(255, 215, 0, 0.6);
    background: rgba(255, 215, 0, 0.08);
    transform: translateY(-2px);
}

.weapon-slot-combat.equipped {
    border-style: solid;
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.15);
}

.weapon-name-combat {
    color: #ffd700;
    font-weight: bold;
    font-size: 1.1rem;
    margin-bottom: 0.8rem;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
}

.weapon-stats-combat {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    color: #e5e5e5;
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

.weapon-stats-combat span {
    padding: 0.2rem 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
    border-left: 2px solid #ffd700;
}

.equip-weapon-btn, .change-armor-btn {
    padding: 0.8rem 1.5rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.08);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: 600;
}

.equip-weapon-btn:hover, .change-armor-btn:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.2);
    color: #ffd700;
    transform: scale(1.05);
}

/* Armadura y Protecci√≥n */
.armor-protection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.armor-slot-combat {
    background: rgba(0, 100, 200, 0.12);
    border: 2px solid rgba(0, 100, 200, 0.4);
    border-radius: 10px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
}

.armor-slot-combat:hover {
    background: rgba(0, 100, 200, 0.18);
    border-color: rgba(0, 150, 255, 0.6);
    transform: translateY(-2px);
}

.armor-type-label {
    color: #4da6ff;
    font-weight: bold;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-size: 0.9rem;
}

.armor-stats {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    color: #e5e5e5;
    font-size: 0.85rem;
    margin-bottom: 1rem;
}

.armor-stats span {
    padding: 0.3rem 0.6rem;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 4px;
    border-left: 2px solid #4da6ff;
}

/* Desglose de CA */
.ac-modifiers {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.12);
}

.ac-breakdown-list {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
}

.ac-modifier-item {
    display: flex;
    justify-content: space-between;
    color: #e5e5e5;
    font-size: 0.9rem;
    padding: 0.4rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.ac-modifier-total {
    display: flex;
    justify-content: space-between;
    color: #ffd700;
    font-size: 1.1rem;
    margin-top: 0.8rem;
    padding-top: 0.8rem;
    border-top: 2px solid rgba(255, 215, 0, 0.3);
}

/* Ataques por Ronda */
.attacks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-bottom: 1.5rem;
}

.attacks-main-hand, .attacks-off-hand, .attacks-ranged {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.attacks-info {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.attacks-stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
}

.attacks-label {
    color: #e5e5e5;
    font-weight: 500;
}

.attacks-value {
    color: #ffd700;
    font-weight: bold;
}

.attacks-total {
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    padding-top: 0.8rem;
    margin-top: 0.5rem;
}

.attacks-note {
    background: rgba(255, 215, 0, 0.08);
    border-left: 4px solid #ffd700;
    padding: 1rem;
    border-radius: 0 8px 8px 0;
}

/* Acciones R√°pidas */
.quick-combat-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.combat-action-btn {
    padding: 1rem 1.5rem;
    border: 2px solid rgba(255, 215, 0, 0.4);
    border-radius: 10px;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.1));
    color: #ffd700;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.95rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.combat-action-btn:hover {
    border-color: #ffd700;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.2));
    transform: scale(1.05);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
}

.combat-action-btn:active {
    transform: scale(0.98);
}

/* Responsive Design */
@media (max-width: 1024px) {
    .combat-stats-row {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .equipped-weapons {
        grid-template-columns: 1fr;
    }
    
    .armor-protection-grid {
        grid-template-columns: 1fr;
    }
    
    .attacks-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .combat-stats-row {
        grid-template-columns: 1fr;
    }
    
    .weapon-stats-combat {
        flex-direction: column;
    }
    
    .quick-combat-actions {
        grid-template-columns: 1fr;
    }
}

/* Estados especiales */
.weapon-slot-combat.has-specialization {
    border-color: #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
}

.weapon-slot-combat.has-mastery {
    border-color: #4ecdc4;
    background: rgba(78, 205, 196, 0.1);
    animation: mastery-glow 2s infinite alternate;
}

@keyframes mastery-glow {
    from { box-shadow: 0 0 10px rgba(78, 205, 196, 0.2); }
    to { box-shadow: 0 0 20px rgba(78, 205, 196, 0.4); }
}

.combat-section.fighter-only {
    border-left: 4px solid #dc143c;
}

.no-styles-active {
    text-align: center;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.04);
    border-radius: 8px;
    border: 1px dashed rgba(255, 255, 255, 0.2);
}
</style>

<!-- Skills Tab -->
<div id="skills-tab" class="tab-content">
    <h2 style="color: #ffd700; margin-bottom: 2rem;">üéØ Pericias</h2>

    <!-- Pericias en Armas -->
    <div class="skills-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            ‚öîÔ∏è Pericias en Armas
            <span class="slot-counter" id="weapon-slots-counter">0/0 casillas</span>
        </h3>
        
        <div class="weapons-proficiency-container">
            <div class="weapon-search-container">
                <input type="text" id="weapon-search" class="form-input" placeholder="üîç Buscar arma..." 
                       oninput="filterWeaponProficiencies()" style="margin-bottom: 1rem;">
                
                <select id="weapon-category-filter" class="form-input" style="margin-bottom: 1rem;"
                        onchange="filterWeaponProficiencies()">
                    <option value="all">Todas las categor√≠as</option>
                    <option value="Cuchilla Peque√±a">Cuchillas Peque√±as</option>
                    <option value="Cuchilla Larga">Cuchillas Largas</option>
                    <option value="Hacha">Hachas</option>
                    <option value="Contundente">Armas Contundentes</option>
                    <option value="Lanza">Lanzas</option>
                    <option value="Asta">Armas de Asta</option>
                    <option value="Arco">Arcos</option>
                    <option value="Ballesta">Ballestas</option>
                    <option value="Honda">Hondas</option>
                    <option value="Ex√≥tica">Armas Ex√≥ticas</option>
                </select>
            </div>
            
            <div class="weapons-grid" id="weapons-proficiency-grid">
                <!-- Las armas se cargar√°n din√°micamente aqu√≠ -->
            </div>
        </div>
    </div>

    <!-- Pericias en No-Armas -->
    <div class="skills-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            üõ†Ô∏è Pericias en No-Armas
            <span class="slot-counter" id="nonweapon-slots-counter">0/0 casillas</span>
        </h3>
        
        <div class="nonweapon-proficiency-container">
            <div class="skill-search-container">
                <input type="text" id="skill-search" class="form-input" placeholder="üîç Buscar pericia..." 
                       oninput="filterNonWeaponProficiencies()" style="margin-bottom: 1rem;">
                <select id="skill-group-filter" class="form-input" style="margin-bottom: 1rem;"
                        onchange="filterNonWeaponProficiencies()">
                    <option value="all">Todos los grupos</option>
                    <option value="Gen">General (Gen)</option>
                    <option value="Luc">Luchador (Luc)</option>
                    <option value="Sac">Sacerdote (Sac)</option>
                    <option value="Hec">Hechicero (Hec)</option>
                    <option value="Bri">Brib√≥n (Bri)</option>
                    <option value="Psi">Psi√≥nico (Psi)</option>
                </select>
            </div>
            
            <div class="skills-grid" id="nonweapon-skills-grid">
                <!-- Las pericias se cargar√°n din√°micamente aqu√≠ -->
            </div>
        </div>
    </div>

    <!-- Estilos de Combate -->
    <div class="skills-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            ü•ã Estilos de Combate
            <span class="slot-counter" id="combat-styles-counter">0/0 casillas</span>
            <small style="color: #b0b0b0; font-size: 0.8rem; margin-left: 1rem;">(Solo Luchadores)</small>
        </h3>
        
        <div class="combat-styles-container" id="combat-styles-container">
            <!-- Los estilos se cargar√°n din√°micamente seg√∫n la clase -->
        </div>
    </div>

    <!-- Resumen de Pericias -->
    <div class="skills-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üìä Resumen de Pericias</h3>
        
        <div class="skills-summary">
            <div class="summary-column">
                <h4 style="color: #ffed4e;">Armas Dominadas</h4>
                <div class="mastered-weapons" id="mastered-weapons-list">
                    <p style="color: #b0b0b0; font-style: italic;">Ninguna todav√≠a</p>
                </div>
            </div>
            
            <div class="summary-column">
                <h4 style="color: #ffed4e;">Pericias Destacadas</h4>
                <div class="notable-skills" id="notable-skills-list">
                    <p style="color: #b0b0b0; font-style: italic;">Ninguna todav√≠a</p>
                </div>
            </div>
            
            <div class="summary-column">
                <h4 style="color: #ffed4e;">Estilos Activos</h4>
                <div class="active-styles" id="active-styles-list">
                    <p style="color: #b0b0b0; font-style: italic;">Ninguno todav√≠a</p>
                </div>
            </div>
        </div>
    </div>

</div>

<style>
/* Estilos espec√≠ficos para el tab de Skills */
.skills-section {
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    position: relative;
}

.skills-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #ffd700, #ffed4e, #ffd700);
    border-radius: 12px 12px 0 0;
}

.slot-counter {
    background: rgba(255, 215, 0, 0.2);
    color: #ffd700;
    padding: 0.4rem 0.9rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: bold;
    border: 2px solid rgba(255, 215, 0, 0.4);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
}

.weapons-grid, .skills-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.2rem;
    max-height: 600px;
    overflow-y: auto;
    padding: 0.5rem;
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.1);
}

.weapon-item, .skill-item {
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    padding: 1.2rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.weapon-item:hover, .skill-item:hover {
    border-color: rgba(255, 215, 0, 0.6);
    background: rgba(255, 215, 0, 0.08);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.2);
}

.weapon-item.has-proficiency, .skill-item.has-proficiency {
    border-color: #4ecdc4;
    background: rgba(78, 205, 196, 0.1);
}

.weapon-item.specialized, .skill-item.specialized {
    border-color: #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
}

.weapon-item.mastered, .skill-item.mastered {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.15);
    animation: mastery-pulse 2s infinite alternate;
}

@keyframes mastery-pulse {
    from { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
    to { box-shadow: 0 0 25px rgba(255, 215, 0, 0.6); }
}

.item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.item-name {
    color: #ffd700;
    font-weight: bold;
    font-size: 1.1rem;
    flex: 1;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
}

.item-group {
    background: rgba(0, 150, 255, 0.25);
    color: #87ceeb;
    padding: 0.3rem 0.7rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: bold;
    margin-left: 0.8rem;
    border: 1px solid rgba(135, 206, 235, 0.4);
}

.item-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.2rem;
    color: #e5e5e5;
    font-size: 0.9rem;
    background: rgba(255, 255, 255, 0.05);
    padding: 0.6rem;
    border-radius: 6px;
}

.item-characteristic {
    color: #b0b0b0;
    font-weight: 500;
}

.item-modifier {
    color: #ffd700;
    font-weight: bold;
    font-size: 1rem;
}

.proficiency-controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.proficiency-level {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.level-btn {
    width: 35px;
    height: 35px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
}

.level-btn:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.2);
    transform: scale(1.1);
}

.level-btn.active {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.4);
    color: #ffd700;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
}

.level-btn.disabled {
    border-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.3);
    cursor: not-allowed;
    background: rgba(0, 0, 0, 0.3);
}

.mastery-info {
    margin-top: 0.8rem;
    padding: 0.8rem;
    background: rgba(255, 215, 0, 0.12);
    border-radius: 8px;
    border-left: 4px solid #ffd700;
    font-size: 0.85rem;
    color: #e5e5e5;
    display: none;
    transition: all 0.3s ease;
}

.mastery-info.show {
    display: block;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.slots-required {
    color: #ffd700;
    font-weight: bold;
    font-size: 0.9rem;
    background: rgba(255, 215, 0, 0.15);
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    border: 1px solid rgba(255, 215, 0, 0.3);
}

.combat-styles-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 1.5rem;
}

.combat-style-card {
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    padding: 1.8rem;
    transition: all 0.3s ease;
    position: relative;
}

.combat-style-card:hover {
    border-color: rgba(255, 215, 0, 0.6);
    background: rgba(255, 215, 0, 0.08);
    transform: translateY(-3px);
}

.combat-style-card.available {
    border-color: #4ecdc4;
    background: rgba(78, 205, 196, 0.08);
}

.combat-style-card.purchased {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.12);
}

.style-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.style-name {
    color: #ffd700;
    font-weight: bold;
    font-size: 1.2rem;
    flex: 1;
}

.style-cost {
    color: #b0b0b0;
    font-size: 0.85rem;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
}

.style-description {
    color: #e5e5e5;
    margin-bottom: 1.5rem;
    line-height: 1.5;
    font-size: 0.9rem;
    font-style: italic;
}

.style-levels {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.style-level {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 8px;
    border-left: 3px solid transparent;
    transition: all 0.3s ease;
}

.style-level.purchased {
    border-left-color: #ffd700;
    background: rgba(255, 215, 0, 0.12);
}

.style-level.available {
    border-left-color: #4ecdc4;
    background: rgba(78, 205, 196, 0.08);
}

.style-level-name {
    font-weight: bold;
    color: #ffd700;
    min-width: 120px;
    font-size: 0.95rem;
}

.style-level-effect {
    flex: 1;
    color: #e5e5e5;
    font-size: 0.9rem;
    line-height: 1.3;
}

.style-level-btn {
    padding: 0.6rem 1.2rem;
    border: 2px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.85rem;
    font-weight: bold;
}

.style-level-btn:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.15);
    color: #ffd700;
}

.style-level-btn.purchased {
    background: rgba(255, 215, 0, 0.4);
    border-color: #ffd700;
    color: #ffd700;
    cursor: default;
}

.style-level-btn.disabled {
    border-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.3);
    cursor: not-allowed;
    background: rgba(0, 0, 0, 0.3);
}

.no-styles-message {
    text-align: center;
    color: #b0b0b0;
    font-style: italic;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.04);
    border-radius: 8px;
    border: 2px dashed rgba(255, 255, 255, 0.2);
}

/* Filtros y b√∫squeda */
.weapon-search-container, .skill-search-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.skills-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
}

.summary-column {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.summary-column h4 {
    margin-bottom: 1rem;
    text-align: center;
}

.mastered-weapons, .notable-skills, .active-styles {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.summary-item {
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    border-left: 3px solid #ffd700;
    color: #e5e5e5;
    font-size: 0.9rem;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .weapons-grid, .skills-grid {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    
    .combat-styles-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .weapons-grid, .skills-grid {
        grid-template-columns: 1fr;
        max-height: 400px;
    }
    
    .weapon-search-container, .skill-search-container {
        grid-template-columns: 1fr;
    }
    
    .skills-summary {
        grid-template-columns: 1fr;
    }
    
    .proficiency-controls {
        flex-direction: column;
        gap: 0.8rem;
    }
    
    .style-level {
        flex-direction: column;
        text-align: center;
        gap: 0.8rem;
    }
    
    .style-level-name {
        min-width: auto;
    }
}

/* Estados especiales adicionales */
.skills-section.fighter-bonus {
    border-left: 4px solid #dc143c;
}

.skills-section.fighter-bonus::before {
    background: linear-gradient(90deg, #dc143c, #ffd700, #dc143c);
}

.weapon-item.fighter-weapon {
    border-color: rgba(220, 20, 60, 0.4);
}

.weapon-item.fighter-weapon:hover {
    border-color: rgba(220, 20, 60, 0.8);
    background: rgba(220, 20, 60, 0.1);
}

/* Tooltips para informaci√≥n adicional */
.tooltip {
    position: relative;
    cursor: help;
}

.tooltip::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    padding: 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    z-index: 1000;
}

.tooltip:hover::after {
    opacity: 1;
}
</style>

<!-- Spells Tab -->
<div id="spells-tab" class="tab-content">
    <h2 style="color: #ffd700; margin-bottom: 2rem;">‚ú® Conjuros</h2>
    
    <!-- Sistema de Lanzamiento -->
    <div class="spells-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üîÆ Sistema de Lanzamiento</h3>
        
        <div class="caster-detection" id="caster-detection">
            <div class="caster-info" id="caster-info">
                <p style="color: #b0b0b0; font-style: italic; text-align: center;">
                    Selecciona clases para detectar capacidades de lanzamiento
                </p>
            </div>
            
            <div class="casting-abilities" id="casting-abilities" style="display: none;">
                <div class="ability-group arcane" id="arcane-casting" style="display: none;">
                    <h4 style="color: #9c27b0;">üîÆ Lanzamiento Arcano</h4>
                    <div class="casting-stats">
                        <div class="stat-item">
                            <span>Habilidad clave:</span>
                            <span class="stat-value">Inteligencia</span>
                        </div>
                        <div class="stat-item">
                            <span>Nivel m√°ximo de conjuro:</span>
                            <span class="stat-value" id="max-arcane-level">1</span>
                        </div>
                        <div class="stat-item">
                            <span>Man√° disponible:</span>
                            <span class="stat-value" id="current-arcane-mana">0/0</span>
                        </div>
                    </div>
                </div>
                
                <div class="ability-group divine" id="divine-casting" style="display: none;">
                    <h4 style="color: #4caf50;">üôè Lanzamiento Divino</h4>
                    <div class="casting-stats">
                        <div class="stat-item">
                            <span>Habilidad clave:</span>
                            <span class="stat-value">Sabidur√≠a</span>
                        </div>
                        <div class="stat-item">
                            <span>Nivel m√°ximo de conjuro:</span>
                            <span class="stat-value" id="max-divine-level">1</span>
                        </div>
                        <div class="stat-item">
                            <span>Man√° disponible:</span>
                            <span class="stat-value" id="current-divine-mana">0/0</span>
                        </div>
                    </div>
                </div>
                
                <div class="ability-group psionic" id="psionic-casting" style="display: none;">
                    <h4 style="color: #e91e63;">üß† Poderes Psi√≥nicos</h4>
                    <div class="casting-stats">
                        <div class="stat-item">
                            <span>Pool PSP:</span>
                            <span class="stat-value" id="current-psp">0/0</span>
                        </div>
                        <div class="stat-item">
                            <span>Disciplinas conocidas:</span>
                            <span class="stat-value" id="known-disciplines">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Espacios de Conjuro -->
    <div class="spells-section" id="spell-slots-section" style="display: none;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üìú Espacios de Conjuro</h3>
        
        <div class="spell-system-toggle">
            <label>
                <input type="radio" name="spell-system" value="slots" checked onchange="toggleSpellSystem()">
                Sistema Cl√°sico (Slots)
            </label>
            <label>
                <input type="radio" name="spell-system" value="mana" onchange="toggleSpellSystem()">
                Sistema de Man√°
            </label>
        </div>
        
        <div id="slots-display" class="slots-container">
            <!-- Arcane Slots -->
            <div class="spell-type-slots" id="arcane-slots" style="display: none;">
                <h4 style="color: #9c27b0;">Conjuros Arcanos</h4>
                <div class="spell-levels-grid" id="arcane-levels-grid">
                    <!-- Se generan din√°micamente -->
                </div>
            </div>
            
            <!-- Divine Slots -->
            <div class="spell-type-slots" id="divine-slots" style="display: none;">
                <h4 style="color: #4caf50;">Conjuros Divinos</h4>
                <div class="spell-levels-grid" id="divine-levels-grid">
                    <!-- Se generan din√°micamente -->
                </div>
            </div>
        </div>
        
        <div id="mana-display" class="mana-container" style="display: none;">
            <div class="mana-pools">
                <div class="mana-pool arcane" id="arcane-mana-pool" style="display: none;">
                    <h4 style="color: #9c27b0;">Man√° Arcano</h4>
                    <div class="mana-bar">
                        <div class="mana-current" id="arcane-mana-current"></div>
                        <span class="mana-text" id="arcane-mana-text">0/0</span>
                    </div>
                    <div class="mana-controls">
                        <button onclick="adjustMana('arcane', -1)">-1</button>
                        <button onclick="adjustMana('arcane', -5)">-5</button>
                        <button onclick="restoreMana('arcane')">Restaurar</button>
                        <button onclick="adjustMana('arcane', 5)">+5</button>
                        <button onclick="adjustMana('arcane', 1)">+1</button>
                    </div>
                </div>
                
                <div class="mana-pool divine" id="divine-mana-pool" style="display: none;">
                    <h4 style="color: #4caf50;">Man√° Divino</h4>
                    <div class="mana-bar">
                        <div class="mana-current" id="divine-mana-current"></div>
                        <span class="mana-text" id="divine-mana-text">0/0</span>
                    </div>
                    <div class="mana-controls">
                        <button onclick="adjustMana('divine', -1)">-1</button>
                        <button onclick="adjustMana('divine', -5)">-5</button>
                        <button onclick="restoreMana('divine')">Restaurar</button>
                        <button onclick="adjustMana('divine', 5)">+5</button>
                        <button onclick="adjustMana('divine', 1)">+1</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grimorio / Lista de Conjuros -->
    <div class="spells-section" id="spellbook-section" style="display: none;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üìö Grimorio</h3>
        
        <div class="spellbook-controls">
            <div class="spell-filters">
                <select id="spell-type-filter" onchange="filterSpells()">
                    <option value="all">Todos los tipos</option>
                    <option value="arcane">Arcanos</option>
                    <option value="divine">Divinos</option>
                    <option value="psionic">Psi√≥nicos</option>
                </select>
                
                <select id="spell-level-filter" onchange="filterSpells()">
                    <option value="all">Todos los niveles</option>
                    <option value="0">Trucos (Nivel 0)</option>
                    <option value="1">Nivel 1</option>
                    <option value="2">Nivel 2</option>
                    <option value="3">Nivel 3</option>
                    <option value="4">Nivel 4</option>
                    <option value="5">Nivel 5</option>
                    <option value="6">Nivel 6</option>
                    <option value="7">Nivel 7</option>
                    <option value="8">Nivel 8</option>
                    <option value="9">Nivel 9</option>
                </select>
                
                <select id="spell-school-filter" onchange="filterSpells()">
                    <option value="all">Todas las escuelas</option>
                    <option value="Abjuration">Abjuraci√≥n</option>
                    <option value="Alteration">Alteraci√≥n</option>
                    <option value="Conjuration">Conjuraci√≥n</option>
                    <option value="Divination">Adivinaci√≥n</option>
                    <option value="Enchantment">Encantamiento</option>
                    <option value="Evocation">Evocaci√≥n</option>
                    <option value="Illusion">Ilusi√≥n</option>
                    <option value="Necromancy">Nigromancia</option>
                </select>
                
                <input type="text" id="spell-search" placeholder="üîç Buscar conjuro..." 
                       oninput="filterSpells()">
            </div>
            
            <div class="spellbook-actions">
                <button class="btn btn-primary" onclick="addCustomSpell()">‚ûï A√±adir Conjuro</button>
                <button class="btn btn-secondary" onclick="importSpellList()">üìÅ Importar Lista</button>
                <button class="btn btn-secondary" onclick="exportSpellbook()">üíæ Exportar</button>
            </div>
        </div>
        
        <div class="known-spells-container">
            <div class="spells-by-level" id="spells-by-level">
                <!-- Se organizan por nivel autom√°ticamente -->
            </div>
        </div>
    </div>

    <!-- Biblioteca de Conjuros -->
    <div class="spells-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üèõÔ∏è Biblioteca de Conjuros</h3>
        
        <div class="spell-library-controls">
            <div class="library-tabs">
                <button class="library-tab active" onclick="showLibraryTab('common')" id="tab-common">
                    Conjuros Comunes
                </button>
                <button class="library-tab" onclick="showLibraryTab('advanced')" id="tab-advanced">
                    Conjuros Avanzados
                </button>
                <button class="library-tab" onclick="showLibraryTab('psionic')" id="tab-psionic">
                    Poderes Psi√≥nicos
                </button>
            </div>
            
            <div class="library-search">
                <input type="text" id="library-search" placeholder="üîç Buscar en biblioteca..." 
                       oninput="filterLibrary()">
            </div>
        </div>
        
        <div class="spell-library-content">
            <div class="library-tab-content active" id="common-spells">
                <div class="spells-grid" id="common-spells-grid">
                    <!-- Conjuros comunes -->
                </div>
            </div>
            
            <div class="library-tab-content" id="advanced-spells">
                <div class="spells-grid" id="advanced-spells-grid">
                    <!-- Conjuros avanzados -->
                </div>
            </div>
            
            <div class="library-tab-content" id="psionic-powers">
                <div class="spells-grid" id="psionic-powers-grid">
                    <!-- Poderes psi√≥nicos -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para detalles de conjuro -->
    <div class="spell-modal" id="spell-modal" style="display: none;">
        <div class="spell-modal-content">
            <span class="close-btn" onclick="closeSpellModal()">&times;</span>
            <div class="spell-detail" id="spell-detail">
                <!-- Contenido del conjuro seleccionado -->
            </div>
        </div>
    </div>

</div>

<style>
/* Estilos para el Tab Conjuros */
.spells-section {
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    position: relative;
}

.spells-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #9c27b0, #ffd700, #9c27b0);
    border-radius: 12px 12px 0 0;
}

/* Sistema de Lanzamiento */
.caster-detection {
    text-align: center;
    padding: 1rem;
}

.casting-abilities {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.ability-group {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 1.5rem;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.ability-group.arcane {
    border-color: rgba(156, 39, 176, 0.4);
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(156, 39, 176, 0.05));
}

.ability-group.divine {
    border-color: rgba(76, 175, 80, 0.4);
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
}

.ability-group.psionic {
    border-color: rgba(233, 30, 99, 0.4);
    background: linear-gradient(135deg, rgba(233, 30, 99, 0.1), rgba(233, 30, 99, 0.05));
}

.casting-stats {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    margin-top: 1rem;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    color: #e5e5e5;
    font-size: 0.9rem;
}

.stat-value {
    color: #ffd700;
    font-weight: bold;
}

/* Sistema de Conjuros */
.spell-system-toggle {
    display: flex;
    gap: 2rem;
    margin-bottom: 2rem;
    justify-content: center;
}

.spell-system-toggle label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #e5e5e5;
    cursor: pointer;
    padding: 0.8rem 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.spell-system-toggle label:hover {
    background: rgba(255, 215, 0, 0.1);
    border-color: rgba(255, 215, 0, 0.4);
}

.spell-system-toggle input[type="radio"]:checked + label {
    background: rgba(255, 215, 0, 0.2);
    border-color: #ffd700;
    color: #ffd700;
}

/* Slots de Conjuro */
.slots-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.spell-type-slots h4 {
    margin-bottom: 1rem;
    text-align: center;
}

.spell-levels-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.spell-level-group {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.spell-level-header {
    text-align: center;
    color: #ffd700;
    font-weight: bold;
    margin-bottom: 0.8rem;
    font-size: 0.9rem;
}

.spell-slots-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    justify-content: center;
}

.spell-slot {
    width: 30px;
    height: 30px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.8rem;
    font-weight: bold;
    position: relative;
}

.spell-slot.available {
    background: rgba(76, 175, 80, 0.2);
    border-color: #4caf50;
    color: #4caf50;
}

.spell-slot.used {
    background: rgba(244, 67, 54, 0.2);
    border-color: #f44336;
    color: #f44336;
}

.spell-slot:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
}

/* Sistema de Man√° */
.mana-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.mana-pool {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 1.5rem;
    border: 2px solid transparent;
}

.mana-pool.arcane {
    border-color: rgba(156, 39, 176, 0.4);
}

.mana-pool.divine {
    border-color: rgba(76, 175, 80, 0.4);
}

.mana-bar {
    position: relative;
    height: 30px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 15px;
    margin: 1rem 0;
    overflow: hidden;
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.mana-current {
    height: 100%;
    background: linear-gradient(90deg, #4caf50, #8bc34a);
    border-radius: 15px;
    transition: width 0.3s ease;
    min-width: 0;
}

.mana-current.arcane {
    background: linear-gradient(90deg, #9c27b0, #e91e63);
}

.mana-current.divine {
    background: linear-gradient(90deg, #4caf50, #8bc34a);
}

.mana-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    z-index: 1;
}

.mana-controls {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
}

.mana-controls button {
    padding: 0.5rem 1rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.1);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.85rem;
}

.mana-controls button:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.2);
    color: #ffd700;
}

/* Grimorio */
.spellbook-controls {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.spell-filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    flex: 1;
}

.spellbook-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.known-spells-container {
    max-height: 500px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 1rem;
}

.spells-by-level {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.spell-level-section {
    border-left: 4px solid #ffd700;
    padding-left: 1rem;
}

.spell-level-title {
    color: #ffd700;
    font-weight: bold;
    font-size: 1.1rem;
    margin-bottom: 0.8rem;
}

.spells-list {
    display: grid;
    gap: 0.8rem;
}

.spell-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.spell-item:hover {
    background: rgba(255, 215, 0, 0.1);
    border-color: rgba(255, 215, 0, 0.3);
    transform: translateX(4px);
}

.spell-item.arcane {
    border-left: 4px solid #9c27b0;
}

.spell-item.divine {
    border-left: 4px solid #4caf50;
}

.spell-item.psionic {
    border-left: 4px solid #e91e63;
}

.spell-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
}

.spell-name {
    color: #ffd700;
    font-weight: bold;
    font-size: 1rem;
    flex: 1;
}

.spell-level {
    background: rgba(255, 255, 255, 0.15);
    color: #e5e5e5;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    margin-left: 0.5rem;
}

.spell-school {
    background: rgba(156, 39, 176, 0.3);
    color: #e1bee7;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    margin-left: 0.3rem;
}

.spell-description {
    color: #b0b0b0;
    font-size: 0.85rem;
    line-height: 1.4;
    margin-top: 0.5rem;
}

.spell-actions {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    display: flex;
    gap: 0.3rem;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.spell-item:hover .spell-actions {
    opacity: 1;
}

.spell-action-btn {
    width: 24px;
    height: 24px;
    border: none;
    background: rgba(255, 255, 255, 0.2);
    color: #e5e5e5;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.7rem;
    transition: all 0.2s ease;
}

.spell-action-btn:hover {
    background: rgba(255, 215, 0, 0.3);
    color: #ffd700;
}

/* Biblioteca de Conjuros */
.spell-library-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.library-tabs {
    display: flex;
    gap: 0.5rem;
}

.library-tab {
    padding: 0.8rem 1.5rem;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.library-tab:hover {
    border-color: rgba(255, 215, 0, 0.4);
    background: rgba(255, 215, 0, 0.1);
}

.library-tab.active {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.2);
    color: #ffd700;
}

.library-search {
    flex: 1;
    max-width: 300px;
}

.library-tab-content {
    display: none;
    max-height: 400px;
    overflow-y: auto;
}

.library-tab-content.active {
    display: block;
}

.spells-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
}

.library-spell-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.library-spell-item:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 215, 0, 0.4);
}

.add-spell-btn {
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    padding: 0.4rem 0.8rem;
    background: rgba(76, 175, 80, 0.2);
    border: 1px solid #4caf50;
    border-radius: 6px;
    color: #4caf50;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.2s ease;
    opacity: 0;
}

.library-spell-item:hover .add-spell-btn {
    opacity: 1;
}

.add-spell-btn:hover {
    background: rgba(76, 175, 80, 0.3);
}

/* Modal de Conjuro */
.spell-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items:

<!-- Spells Tab -->
<div id="spells-tab" class="tab-content">
    <h2 style="color: #ffd700; margin-bottom: 2rem;">‚ú® Conjuros</h2>
    
    <!-- Sistema de Lanzamiento -->
    <div class="spells-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üîÆ Sistema de Lanzamiento</h3>
        
        <div class="caster-detection" id="caster-detection">
            <div class="caster-info" id="caster-info">
                <p style="color: #b0b0b0; font-style: italic; text-align: center;">
                    Selecciona clases para detectar capacidades de lanzamiento
                </p>
            </div>
            
            <div class="casting-abilities" id="casting-abilities" style="display: none;">
                <div class="ability-group arcane" id="arcane-casting" style="display: none;">
                    <h4 style="color: #9c27b0;">üîÆ Lanzamiento Arcano</h4>
                    <div class="casting-stats">
                        <div class="stat-item">
                            <span>Habilidad clave:</span>
                            <span class="stat-value">Inteligencia</span>
                        </div>
                        <div class="stat-item">
                            <span>Nivel m√°ximo de conjuro:</span>
                            <span class="stat-value" id="max-arcane-level">1</span>
                        </div>
                        <div class="stat-item">
                            <span>Man√° disponible:</span>
                            <span class="stat-value" id="current-arcane-mana">0/0</span>
                        </div>
                    </div>
                </div>
                
                <div class="ability-group divine" id="divine-casting" style="display: none;">
                    <h4 style="color: #4caf50;">üôè Lanzamiento Divino</h4>
                    <div class="casting-stats">
                        <div class="stat-item">
                            <span>Habilidad clave:</span>
                            <span class="stat-value">Sabidur√≠a</span>
                        </div>
                        <div class="stat-item">
                            <span>Nivel m√°ximo de conjuro:</span>
                            <span class="stat-value" id="max-divine-level">1</span>
                        </div>
                        <div class="stat-item">
                            <span>Man√° disponible:</span>
                            <span class="stat-value" id="current-divine-mana">0/0</span>
                        </div>
                    </div>
                </div>
                
                <div class="ability-group psionic" id="psionic-casting" style="display: none;">
                    <h4 style="color: #e91e63;">üß† Poderes Psi√≥nicos</h4>
                    <div class="casting-stats">
                        <div class="stat-item">
                            <span>Pool PSP:</span>
                            <span class="stat-value" id="current-psp">0/0</span>
                        </div>
                        <div class="stat-item">
                            <span>Disciplinas conocidas:</span>
                            <span class="stat-value" id="known-disciplines">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Espacios de Conjuro -->
    <div class="spells-section" id="spell-slots-section" style="display: none;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üìú Espacios de Conjuro</h3>
        
        <div class="spell-system-toggle">
            <label>
                <input type="radio" name="spell-system" value="slots" checked onchange="toggleSpellSystem()">
                Sistema Cl√°sico (Slots)
            </label>
            <label>
                <input type="radio" name="spell-system" value="mana" onchange="toggleSpellSystem()">
                Sistema de Man√°
            </label>
        </div>
        
        <div id="slots-display" class="slots-container">
            <!-- Arcane Slots -->
            <div class="spell-type-slots" id="arcane-slots" style="display: none;">
                <h4 style="color: #9c27b0;">Conjuros Arcanos</h4>
                <div class="spell-levels-grid" id="arcane-levels-grid">
                    <!-- Se generan din√°micamente -->
                </div>
            </div>
            
            <!-- Divine Slots -->
            <div class="spell-type-slots" id="divine-slots" style="display: none;">
                <h4 style="color: #4caf50;">Conjuros Divinos</h4>
                <div class="spell-levels-grid" id="divine-levels-grid">
                    <!-- Se generan din√°micamente -->
                </div>
            </div>
        </div>
        
        <div id="mana-display" class="mana-container" style="display: none;">
            <div class="mana-pools">
                <div class="mana-pool arcane" id="arcane-mana-pool" style="display: none;">
                    <h4 style="color: #9c27b0;">Man√° Arcano</h4>
                    <div class="mana-bar">
                        <div class="mana-current" id="arcane-mana-current"></div>
                        <span class="mana-text" id="arcane-mana-text">0/0</span>
                    </div>
                    <div class="mana-controls">
                        <button onclick="adjustMana('arcane', -1)">-1</button>
                        <button onclick="adjustMana('arcane', -5)">-5</button>
                        <button onclick="restoreMana('arcane')">Restaurar</button>
                        <button onclick="adjustMana('arcane', 5)">+5</button>
                        <button onclick="adjustMana('arcane', 1)">+1</button>
                    </div>
                </div>
                
                <div class="mana-pool divine" id="divine-mana-pool" style="display: none;">
                    <h4 style="color: #4caf50;">Man√° Divino</h4>
                    <div class="mana-bar">
                        <div class="mana-current" id="divine-mana-current"></div>
                        <span class="mana-text" id="divine-mana-text">0/0</span>
                    </div>
                    <div class="mana-controls">
                        <button onclick="adjustMana('divine', -1)">-1</button>
                        <button onclick="adjustMana('divine', -5)">-5</button>
                        <button onclick="restoreMana('divine')">Restaurar</button>
                        <button onclick="adjustMana('divine', 5)">+5</button>
                        <button onclick="adjustMana('divine', 1)">+1</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grimorio / Lista de Conjuros -->
    <div class="spells-section" id="spellbook-section" style="display: none;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üìö Grimorio</h3>
        
        <div class="spellbook-controls">
            <div class="spell-filters">
                <select id="spell-type-filter" onchange="filterSpells()">
                    <option value="all">Todos los tipos</option>
                    <option value="arcane">Arcanos</option>
                    <option value="divine">Divinos</option>
                    <option value="psionic">Psi√≥nicos</option>
                </select>
                
                <select id="spell-level-filter" onchange="filterSpells()">
                    <option value="all">Todos los niveles</option>
                    <option value="0">Trucos (Nivel 0)</option>
                    <option value="1">Nivel 1</option>
                    <option value="2">Nivel 2</option>
                    <option value="3">Nivel 3</option>
                    <option value="4">Nivel 4</option>
                    <option value="5">Nivel 5</option>
                    <option value="6">Nivel 6</option>
                    <option value="7">Nivel 7</option>
                    <option value="8">Nivel 8</option>
                    <option value="9">Nivel 9</option>
                </select>
                
                <select id="spell-school-filter" onchange="filterSpells()">
                    <option value="all">Todas las escuelas</option>
                    <option value="Abjuration">Abjuraci√≥n</option>
                    <option value="Alteration">Alteraci√≥n</option>
                    <option value="Conjuration">Conjuraci√≥n</option>
                    <option value="Divination">Adivinaci√≥n</option>
                    <option value="Enchantment">Encantamiento</option>
                    <option value="Evocation">Evocaci√≥n</option>
                    <option value="Illusion">Ilusi√≥n</option>
                    <option value="Necromancy">Nigromancia</option>
                </select>
                
                <input type="text" id="spell-search" placeholder="üîç Buscar conjuro..." 
                       oninput="filterSpells()">
            </div>
            
            <div class="spellbook-actions">
                <button class="btn btn-primary" onclick="addCustomSpell()">‚ûï A√±adir Conjuro</button>
                <button class="btn btn-secondary" onclick="importSpellList()">üìÅ Importar Lista</button>
                <button class="btn btn-secondary" onclick="exportSpellbook()">üíæ Exportar</button>
            </div>
        </div>
        
        <div class="known-spells-container">
            <div class="spells-by-level" id="spells-by-level">
                <!-- Se organizan por nivel autom√°ticamente -->
            </div>
        </div>
    </div>

    <!-- Biblioteca de Conjuros -->
    <div class="spells-section">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üèõÔ∏è Biblioteca de Conjuros</h3>
        
        <div class="spell-library-controls">
            <div class="library-tabs">
                <button class="library-tab active" onclick="showLibraryTab('common')" id="tab-common">
                    Conjuros Comunes
                </button>
                <button class="library-tab" onclick="showLibraryTab('advanced')" id="tab-advanced">
                    Conjuros Avanzados
                </button>
                <button class="library-tab" onclick="showLibraryTab('psionic')" id="tab-psionic">
                    Poderes Psi√≥nicos
                </button>
            </div>
            
            <div class="library-search">
                <input type="text" id="library-search" placeholder="üîç Buscar en biblioteca..." 
                       oninput="filterLibrary()">
            </div>
        </div>
        
        <div class="spell-library-content">
            <div class="library-tab-content active" id="common-spells">
                <div class="spells-grid" id="common-spells-grid">
                    <!-- Conjuros comunes -->
                </div>
            </div>
            
            <div class="library-tab-content" id="advanced-spells">
                <div class="spells-grid" id="advanced-spells-grid">
                    <!-- Conjuros avanzados -->
                </div>
            </div>
            
            <div class="library-tab-content" id="psionic-powers">
                <div class="spells-grid" id="psionic-powers-grid">
                    <!-- Poderes psi√≥nicos -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para detalles de conjuro -->
    <div class="spell-modal" id="spell-modal" style="display: none;">
        <div class="spell-modal-content">
            <span class="close-btn" onclick="closeSpellModal()">&times;</span>
            <div class="spell-detail" id="spell-detail">
                <!-- Contenido del conjuro seleccionado -->
            </div>
        </div>
    </div>

</div>

<style>
/* Estilos para el Tab Conjuros */
.spells-section {
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    position: relative;
}

.spells-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #9c27b0, #ffd700, #9c27b0);
    border-radius: 12px 12px 0 0;
}

/* Sistema de Lanzamiento */
.caster-detection {
    text-align: center;
    padding: 1rem;
}

.casting-abilities {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.ability-group {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 1.5rem;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.ability-group.arcane {
    border-color: rgba(156, 39, 176, 0.4);
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(156, 39, 176, 0.05));
}

.ability-group.divine {
    border-color: rgba(76, 175, 80, 0.4);
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
}

.ability-group.psionic {
    border-color: rgba(233, 30, 99, 0.4);
    background: linear-gradient(135deg, rgba(233, 30, 99, 0.1), rgba(233, 30, 99, 0.05));
}

.casting-stats {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    margin-top: 1rem;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    color: #e5e5e5;
    font-size: 0.9rem;
}

.stat-value {
    color: #ffd700;
    font-weight: bold;
}

/* Sistema de Conjuros */
.spell-system-toggle {
    display: flex;
    gap: 2rem;
    margin-bottom: 2rem;
    justify-content: center;
}

.spell-system-toggle label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #e5e5e5;
    cursor: pointer;
    padding: 0.8rem 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.spell-system-toggle label:hover {
    background: rgba(255, 215, 0, 0.1);
    border-color: rgba(255, 215, 0, 0.4);
}

.spell-system-toggle input[type="radio"]:checked + label {
    background: rgba(255, 215, 0, 0.2);
    border-color: #ffd700;
    color: #ffd700;
}

/* Slots de Conjuro */
.slots-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.spell-type-slots h4 {
    margin-bottom: 1rem;
    text-align: center;
}

.spell-levels-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.spell-level-group {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.spell-level-header {
    text-align: center;
    color: #ffd700;
    font-weight: bold;
    margin-bottom: 0.8rem;
    font-size: 0.9rem;
}

.spell-slots-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    justify-content: center;
}

.spell-slot {
    width: 30px;
    height: 30px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.8rem;
    font-weight: bold;
    position: relative;
}

.spell-slot.available {
    background: rgba(76, 175, 80, 0.2);
    border-color: #4caf50;
    color: #4caf50;
}

.spell-slot.used {
    background: rgba(244, 67, 54, 0.2);
    border-color: #f44336;
    color: #f44336;
}

.spell-slot:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
}

/* Sistema de Man√° */
.mana-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.mana-pool {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 1.5rem;
    border: 2px solid transparent;
}

.mana-pool.arcane {
    border-color: rgba(156, 39, 176, 0.4);
}

.mana-pool.divine {
    border-color: rgba(76, 175, 80, 0.4);
}

.mana-bar {
    position: relative;
    height: 30px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 15px;
    margin: 1rem 0;
    overflow: hidden;
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.mana-current {
    height: 100%;
    background: linear-gradient(90deg, #4caf50, #8bc34a);
    border-radius: 15px;
    transition: width 0.3s ease;
    min-width: 0;
}

.mana-current.arcane {
    background: linear-gradient(90deg, #9c27b0, #e91e63);
}

.mana-current.divine {
    background: linear-gradient(90deg, #4caf50, #8bc34a);
}

.mana-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    z-index: 1;
}

.mana-controls {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
}

.mana-controls button {
    padding: 0.5rem 1rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.1);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.85rem;
}

.mana-controls button:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.2);
    color: #ffd700;
}

/* Grimorio */
.spellbook-controls {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.spell-filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    flex: 1;
}

.spellbook-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.known-spells-container {
    max-height: 500px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 1rem;
}

.spells-by-level {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.spell-level-section {
    border-left: 4px solid #ffd700;
    padding-left: 1rem;
}

.spell-level-title {
    color: #ffd700;
    font-weight: bold;
    font-size: 1.1rem;
    margin-bottom: 0.8rem;
}

.spells-list {
    display: grid;
    gap: 0.8rem;
}

.spell-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.spell-item:hover {
    background: rgba(255, 215, 0, 0.1);
    border-color: rgba(255, 215, 0, 0.3);
    transform: translateX(4px);
}

.spell-item.arcane {
    border-left: 4px solid #9c27b0;
}

.spell-item.divine {
    border-left: 4px solid #4caf50;
}

.spell-item.psionic {
    border-left: 4px solid #e91e63;
}

.spell-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
}

.spell-name {
    color: #ffd700;
    font-weight: bold;
    font-size: 1rem;
    flex: 1;
}

.spell-level {
    background: rgba(255, 255, 255, 0.15);
    color: #e5e5e5;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    margin-left: 0.5rem;
}

.spell-school {
    background: rgba(156, 39, 176, 0.3);
    color: #e1bee7;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    margin-left: 0.3rem;
}

.spell-description {
    color: #b0b0b0;
    font-size: 0.85rem;
    line-height: 1.4;
    margin-top: 0.5rem;
}

.spell-actions {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    display: flex;
    gap: 0.3rem;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.spell-item:hover .spell-actions {
    opacity: 1;
}

.spell-action-btn {
    width: 24px;
    height: 24px;
    border: none;
    background: rgba(255, 255, 255, 0.2);
    color: #e5e5e5;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.7rem;
    transition: all 0.2s ease;
}

.spell-action-btn:hover {
    background: rgba(255, 215, 0, 0.3);
    color: #ffd700;
}

/* Biblioteca de Conjuros */
.spell-library-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.library-tabs {
    display: flex;
    gap: 0.5rem;
}

.library-tab {
    padding: 0.8rem 1.5rem;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.library-tab:hover {
    border-color: rgba(255, 215, 0, 0.4);
    background: rgba(255, 215, 0, 0.1);
}

.library-tab.active {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.2);
    color: #ffd700;
}

.library-search {
    flex: 1;
    max-width: 300px;
}

.library-tab-content {
    display: none;
    max-height: 400px;
    overflow-y: auto;
}

.library-tab-content.active {
    display: block;
}

.spells-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
}

.library-spell-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.library-spell-item:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 215, 0, 0.4);
}

.add-spell-btn {
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    padding: 0.4rem 0.8rem;
    background: rgba(76, 175, 80, 0.2);
    border: 1px solid #4caf50;
    border-radius: 6px;
    color: #4caf50;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.2s ease;
    opacity: 0;
}

.library-spell-item:hover .add-spell-btn {
    opacity: 1;
}

.add-spell-btn:hover {
    background: rgba(76, 175, 80, 0.3);
}

/* Modal de Conjuro */
.spell-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    backdrop-filter: blur(3px);
}

.spell-modal-content {
    background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(30, 33, 62, 0.95));
    border: 2px solid #ffd700;
    border-radius: 16px;
    padding: 2rem;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
}

.close-btn {
    position: absolute;
    top: 1rem;
    right: 1.5rem;
    color: #ffd700;
    font-size: 2rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.close-btn:hover {
    color: #ffed4e;
    transform: scale(1.2);
}

.spell-detail {
    color: #e5e5e5;
    line-height: 1.6;
}

.spell-detail h3 {
    color: #ffd700;
    margin-bottom: 1rem;
    font-size: 1.5rem;
}

.spell-detail .spell-meta {
    background: rgba(255, 255, 255, 0.05);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    border-left: 4px solid #9c27b0;
}

.spell-detail .spell-components {
    margin: 1rem 0;
    font-family: monospace;
    background: rgba(0, 0, 0, 0.3);
    padding: 0.8rem;
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Responsive Design */
@media (max-width: 1024px) {
    .casting-abilities {
        grid-template-columns: 1fr;
    }
    
    .spell-levels-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
    
    .spellbook-controls {
        flex-direction: column;
        align-items: stretch;
    }
    
    .spell-filters {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .spell-system-toggle {
        flex-direction: column;
        align-items: center;
        gap: 1rem;
    }
    
    .spell-filters {
        grid-template-columns: 1fr;
    }
    
    .library-tabs {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .spells-grid {
        grid-template-columns: 1fr;
    }
    
    .spell-modal-content {
        margin: 1rem;
        max-width: calc(100% - 2rem);
        max-height: calc(100vh - 2rem);
    }
    
    .mana-controls {
        flex-wrap: wrap;
    }
}

/* Animaciones especiales */
@keyframes spell-cast {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
}

.spell-slot.casting {
    animation: spell-cast 0.6s ease;
}

@keyframes mana-drain {
    0% { background: linear-gradient(90deg, #4caf50, #8bc34a); }
    50% { background: linear-gradient(90deg, #ff9800, #ffc107); }
    100% { background: linear-gradient(90deg, #4caf50, #8bc34a); }
}

.mana-current.draining {
    animation: mana-drain 1s ease;
}

/* Estados especiales */
.spells-section.no-caster {
    opacity: 0.6;
    pointer-events: none;
}

.spell-item.memorized {
    border-color: #4caf50;
    background: rgba(76, 175, 80, 0.1);
}

.spell-item.prepared {
    border-color: #ff9800;
    background: rgba(255, 152, 0, 0.1);
}

.spell-item.cant-cast {
    opacity: 0.4;
    filter: grayscale(50%);
}

/* Tooltips para conjuros */
.spell-tooltip {
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    padding: 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    white-space: nowrap;
    z-index: 1000;
    pointer-events: none;
    transform: translateY(-100%);
    opacity: 0;
    transition: opacity 0.3s;
}

.spell-item:hover .spell-tooltip {
    opacity: 1;
}
</style>

<!-- Equipment Tab -->
<div id="equipment-tab" class="tab-content">
    <h2 style="color: #ffd700; margin-bottom: 2rem;">üéí Equipo del Personaje</h2>
    
    <!-- Quick Equipment Actions -->
    <div class="equipment-actions">
        <div class="quick-equip-buttons">
            <button class="quick-equip-btn" onclick="quickEquipSet('fighter')">‚öîÔ∏è Guerrero</button>
            <button class="quick-equip-btn" onclick="quickEquipSet('wizard')">üîÆ Mago</button>
            <button class="quick-equip-btn" onclick="quickEquipSet('rogue')">üó°Ô∏è P√≠caro</button>
            <button class="quick-equip-btn" onclick="quickEquipSet('cleric')">üõ°Ô∏è Cl√©rigo</button>
            <button class="quick-equip-btn" onclick="quickEquipSet('ranger')">üèπ Ranger</button>
            <button class="quick-equip-btn clear" onclick="clearAllEquipment()">üßπ Limpiar Todo</button>
        </div>
        
        <div class="equipment-management">
            <button class="equipment-btn" onclick="showInventoryManager()">üì¶ Gestionar Inventario</button>
            <button class="equipment-btn" onclick="exportEquipment()">üíæ Exportar Equipo</button>
            <button class="equipment-btn" onclick="importEquipment()">üìÅ Importar Equipo</button>
        </div>
    </div>

    <!-- Head & Neck Equipment -->
    <div class="equipment-section">
        <h3>üëë Cabeza y Cuello</h3>
        <div class="equipment-grid">
            <div class="equipment-slot head-slot" id="helmet-slot" onclick="openItemSelector('helmet')">
                <div class="slot-label">Casco/Yelmo</div>
                <div class="slot-item slot-empty" id="helmet-display">Vac√≠o</div>
                <div class="item-stats" id="helmet-stats"></div>
            </div>
            <div class="equipment-slot head-slot" id="crown-slot" onclick="openItemSelector('crown')">
                <div class="slot-label">Corona/Tiara</div>
                <div class="slot-item slot-empty" id="crown-display">Vac√≠o</div>
                <div class="item-stats" id="crown-stats"></div>
            </div>
            <div class="equipment-slot neck-slot" id="neck-slot" onclick="openItemSelector('neck')">
                <div class="slot-label">Cuello</div>
                <div class="slot-item slot-empty" id="neck-display">Vac√≠o</div>
                <div class="item-stats" id="neck-stats"></div>
            </div>
            <div class="equipment-slot back-slot" id="cloak-slot" onclick="openItemSelector('cloak')">
                <div class="slot-label">Capa/Manto</div>
                <div class="slot-item slot-empty" id="cloak-display">Vac√≠o</div>
                <div class="item-stats" id="cloak-stats"></div>
            </div>
        </div>
    </div>

    <!-- Arms & Hands Equipment -->
    <div class="equipment-section">
        <h3>ü§≤ Brazos y Manos</h3>
        <div class="equipment-grid">
            <div class="equipment-slot arms-slot" id="bracers-slot" onclick="openItemSelector('bracers')">
                <div class="slot-label">Brazales</div>
                <div class="slot-item slot-empty" id="bracers-display">Vac√≠o</div>
                <div class="item-stats" id="bracers-stats"></div>
            </div>
            <div class="equipment-slot hands-slot" id="gauntlets-slot" onclick="openItemSelector('gauntlets')">
                <div class="slot-label">Guanteletes</div>
                <div class="slot-item slot-empty" id="gauntlets-display">Vac√≠o</div>
                <div class="item-stats" id="gauntlets-stats"></div>
            </div>
            <div class="equipment-slot ring-slot" id="ring1-slot" onclick="openItemSelector('ring1')">
                <div class="slot-label">Anillo 1</div>
                <div class="slot-item slot-empty" id="ring1-display">Vac√≠o</div>
                <div class="item-stats" id="ring1-stats"></div>
            </div>
            <div class="equipment-slot ring-slot" id="ring2-slot" onclick="openItemSelector('ring2')">
                <div class="slot-label">Anillo 2</div>
                <div class="slot-item slot-empty" id="ring2-display">Vac√≠o</div>
                <div class="item-stats" id="ring2-stats"></div>
            </div>
        </div>
    </div>

    <!-- Body & Feet Equipment -->
    <div class="equipment-section">
        <h3>üëï Cuerpo y Pies</h3>
        <div class="equipment-grid">
            <div class="equipment-slot armor-slot" id="armor-slot" onclick="openItemSelector('armor')">
                <div class="slot-label">Armadura</div>
                <div class="slot-item slot-empty" id="armor-display">Sin Armadura</div>
                <div class="item-stats" id="armor-stats"></div>
            </div>
            <div class="equipment-slot shield-slot" id="shield-slot" onclick="openItemSelector('shield')">
                <div class="slot-label">Escudo</div>
                <div class="slot-item slot-empty" id="shield-display">Sin Escudo</div>
                <div class="item-stats" id="shield-stats"></div>
            </div>
            <div class="equipment-slot feet-slot" id="boots-slot" onclick="openItemSelector('boots')">
                <div class="slot-label">Botas</div>
                <div class="slot-item slot-empty" id="boots-display">Vac√≠o</div>
                <div class="item-stats" id="boots-stats"></div>
            </div>
            <div class="equipment-slot waist-slot" id="belt-slot" onclick="openItemSelector('belt')">
                <div class="slot-label">Cintur√≥n</div>
                <div class="slot-item slot-empty" id="belt-display">Vac√≠o</div>
                <div class="item-stats" id="belt-stats"></div>
            </div>
        </div>
    </div>

    <!-- Weapons Section -->
    <div class="equipment-section weapons-section">
        <h3>‚öîÔ∏è Armas</h3>
        <div class="weapons-grid">
            <div class="equipment-slot weapon-slot primary" id="weapon1-slot" onclick="openWeaponSelector('weapon1')">
                <div class="slot-label">üó°Ô∏è Arma Principal</div>
                <div class="slot-item slot-empty" id="weapon1-display">Pu√±os</div>
                <div class="weapon-stats" id="weapon1-stats">
                    <span>Da√±o: 1d2</span>
                    <span>GACO: 20</span>
                </div>
            </div>
            <div class="equipment-slot weapon-slot secondary" id="weapon2-slot" onclick="openWeaponSelector('weapon2')">
                <div class="slot-label">‚öîÔ∏è Arma Secundaria</div>
                <div class="slot-item slot-empty" id="weapon2-display">Vac√≠o</div>
                <div class="weapon-stats" id="weapon2-stats"></div>
            </div>
            <div class="equipment-slot weapon-slot ranged" id="weapon3-slot" onclick="openWeaponSelector('weapon3')">
                <div class="slot-label">üèπ Arma a Distancia</div>
                <div class="slot-item slot-empty" id="weapon3-display">Vac√≠o</div>
                <div class="weapon-stats" id="weapon3-stats"></div>
            </div>
            <div class="equipment-slot weapon-slot backup" id="weapon4-slot" onclick="openWeaponSelector('weapon4')">
                <div class="slot-label">üî™ Arma de Reserva</div>
                <div class="slot-item slot-empty" id="weapon4-display">Vac√≠o</div>
                <div class="weapon-stats" id="weapon4-stats"></div>
            </div>
        </div>
    </div>

    <!-- Equipment Statistics -->
    <div class="equipment-section">
        <h3>üìä Estad√≠sticas de Protecci√≥n</h3>
        <div class="protection-stats">
            <div class="stat-group armor-class-group">
                <h4>üõ°Ô∏è Clase de Armadura</h4>
                <div class="ac-breakdown">
                    <div class="ac-main">
                        <span class="ac-value" id="total-ac">10</span>
                        <span class="ac-label">CA Total</span>
                    </div>
                    <div class="ac-details">
                        <div class="ac-component">
                            <span>Base:</span>
                            <span id="ac-base">10</span>
                        </div>
                        <div class="ac-component">
                            <span>Armadura:</span>
                            <span id="ac-armor">0</span>
                        </div>
                        <div class="ac-component">
                            <span>Escudo:</span>
                            <span id="ac-shield">0</span>
                        </div>
                        <div class="ac-component">
                            <span>Destreza:</span>
                            <span id="ac-dexterity">0</span>
                        </div>
                        <div class="ac-component">
                            <span>M√°gico:</span>
                            <span id="ac-magic">0</span>
                        </div>
                        <div class="ac-component">
                            <span>Otros:</span>
                            <span id="ac-other">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="stat-group encumbrance-group">
                <h4>‚öñÔ∏è Carga</h4>
                <div class="encumbrance-info">
                    <div class="weight-display">
                        <span class="weight-current" id="current-weight">0</span>
                        <span class="weight-separator">/</span>
                        <span class="weight-limit" id="weight-limit">50</span>
                        <span class="weight-unit">kg</span>
                    </div>
                    <div class="weight-bar">
                        <div class="weight-fill" id="weight-fill" style="width: 0%"></div>
                    </div>
                    <div class="encumbrance-level" id="encumbrance-level">Sin carga</div>
                </div>
            </div>
            
            <div class="stat-group movement-group">
                <h4>üèÉ Movimiento</h4>
                <div class="movement-stats">
                    <div class="movement-item">
                        <span>Base:</span>
                        <span id="base-movement">12</span>
                    </div>
                    <div class="movement-item">
                        <span>Con armadura:</span>
                        <span id="armored-movement">12</span>
                    </div>
                    <div class="movement-item">
                        <span>Con carga:</span>
                        <span id="encumbered-movement">12</span>
                    </div>
                    <div class="movement-item total">
                        <span><strong>Efectivo:</strong></span>
                        <span id="effective-movement"><strong>12</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Money & Additional Items -->
    <div class="equipment-section">
        <h3>üí∞ Dinero e Inventario</h3>
        
        <div class="money-management">
            <div class="money-grid">
                <div class="money-input-group">
                    <label class="money-label">Oro (MO)</label>
                    <input type="number" class="money-input" id="gold" value="0" min="0" 
                           onchange="updateMoney()" oninput="updateMoney()">
                </div>
                <div class="money-input-group">
                    <label class="money-label">Plata (MP)</label>
                    <input type="number" class="money-input" id="silver" value="0" min="0" 
                           onchange="updateMoney()" oninput="updateMoney()">
                </div>
                <div class="money-input-group">
                    <label class="money-label">Cobre (MC)</label>
                    <input type="number" class="money-input" id="copper" value="0" min="0" 
                           onchange="updateMoney()" oninput="updateMoney()">
                </div>
                <div class="money-total-group">
                    <label class="money-label">Total</label>
                    <div class="money-total" id="total-money-value">0 MO</div>
                </div>
            </div>
            
            <div class="money-converter">
                <button class="converter-btn" onclick="convertMoney('up')">‚¨ÜÔ∏è Convertir a Superior</button>
                <button class="converter-btn" onclick="convertMoney('down')">‚¨áÔ∏è Convertir a Inferior</button>
            </div>
        </div>
        
        <div class="additional-inventory">
            <div class="inventory-categories">
                <div class="inventory-category">
                    <h5>üéí Equipamiento de Aventura</h5>
                    <textarea class="inventory-textarea" id="adventure-gear" rows="3" 
                              placeholder="Ej: Cuerda de c√°√±amo (15m), Kit de ladr√≥n, Antorcha x5..."></textarea>
                </div>
                
                <div class="inventory-category">
                    <h5>üß™ Pociones y Consumibles</h5>
                    <textarea class="inventory-textarea" id="consumables" rows="3" 
                              placeholder="Ej: Poci√≥n de curaci√≥n x2, Pergamino de Misiles M√°gicos..."></textarea>
                </div>
                
                <div class="inventory-category">
                    <h5>üíé Objetos Valiosos</h5>
                    <textarea class="inventory-textarea" id="valuables" rows="3" 
                              placeholder="Ej: Gemas, joyas, obras de arte, objetos √∫nicos..."></textarea>
                </div>
                
                <div class="inventory-category">
                    <h5>üìú Objetos Varios</h5>
                    <textarea class="inventory-textarea" id="miscellaneous" rows="3" 
                              placeholder="Ej: Provisiones, herramientas, componentes de conjuros..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Equipment Summary -->
    <div class="equipment-section">
        <h3>üìã Resumen de Equipo</h3>
        
        <div class="equipment-summary">
            <div class="summary-column">
                <h5>‚öîÔ∏è Armas Equipadas</h5>
                <div class="equipped-weapons-list" id="equipped-weapons-summary">
                    <p class="summary-item">Principal: Pu√±os</p>
                    <p class="summary-item">Secundaria: Ninguna</p>
                    <p class="summary-item">Distancia: Ninguna</p>
                </div>
            </div>
            
            <div class="summary-column">
                <h5>üõ°Ô∏è Protecci√≥n</h5>
                <div class="protection-summary" id="protection-summary">
                    <p class="summary-item">CA: <span class="summary-value">10</span></p>
                    <p class="summary-item">Resistencia m√°gica: <span class="summary-value">0%</span></p>
                    <p class="summary-item">Velocidad: <span class="summary-value">12</span></p>
                </div>
            </div>
            
            <div class="summary-column">
                <h5>‚ú® Objetos M√°gicos</h5>
                <div class="magic-items-list" id="magic-items-summary">
                    <p class="summary-item no-magic">Ning√∫n objeto m√°gico equipado</p>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Item Selection Modal -->
<div class="item-modal" id="item-selection-modal" style="display: none;">
    <div class="item-modal-content">
        <div class="modal-header">
            <h3 id="modal-title">Seleccionar Item</h3>
            <span class="close-modal" onclick="closeItemModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="item-search">
                <input type="text" id="item-search-input" placeholder="üîç Buscar item..." 
                       oninput="filterModalItems()">
            </div>
            <div class="items-list" id="modal-items-list">
                <!-- Items will be populated here -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn remove" onclick="removeCurrentItem()">‚ùå Quitar Item</button>
            <button class="modal-btn cancel" onclick="closeItemModal()">Cancelar</button>
        </div>
    </div>
</div>

<style>
/* Equipment Tab Styles */
.equipment-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    flex-wrap: wrap;
    gap: 1rem;
}

.quick-equip-buttons {
    display: flex;
    gap: 0.8rem;
    flex-wrap: wrap;
}

.quick-equip-btn {
    padding: 0.8rem 1.2rem;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: 600;
}

.quick-equip-btn:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.15);
    color: #ffd700;
    transform: translateY(-2px);
}

.quick-equip-btn.clear {
    border-color: rgba(255, 107, 107, 0.4);
    background: rgba(255, 107, 107, 0.1);
    color: #ff6b6b;
}

.quick-equip-btn.clear:hover {
    border-color: #ff6b6b;
    background: rgba(255, 107, 107, 0.2);
}

.equipment-management {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.equipment-btn {
    padding: 0.6rem 1rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.85rem;
}

.equipment-btn:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.1);
    color: #ffd700;
}

.equipment-section {
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    position: relative;
}

.equipment-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #ffd700, #ffed4e, #ffd700);
    border-radius: 12px 12px 0 0;
}

.equipment-section h3 {
    color: #ffd700;
    margin-bottom: 1.5rem;
    font-size: 1.3rem;
    text-align: center;
}

.equipment-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.weapons-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.equipment-slot {
    background: rgba(0, 0, 0, 0.4);
    border: 2px dashed rgba(255, 255, 255, 0.25);
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.equipment-slot:hover {
    border-color: rgba(255, 215, 0, 0.6);
    background: rgba(255, 215, 0, 0.08);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.2);
}

.equipment-slot.occupied {
    border-style: solid;
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.15);
}

.equipment-slot.magical {
    border-color: #9c27b0;
    background: rgba(156, 39, 176, 0.15);
    animation: magical-glow 2s infinite alternate;
}

@keyframes magical-glow {
    from { box-shadow: 0 0 15px rgba(156, 39, 176, 0.3); }
    to { box-shadow: 0 0 25px rgba(156, 39, 176, 0.6); }
}

.slot-label {
    color: #b0b0b0;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.8rem;
    font-weight: 600;
}

.slot-item {
    color: #ffd700;
    font-weight: bold;
    font-size: 1rem;
    margin-bottom: 0.8rem;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
}

.slot-item.slot-empty {
    color: #666;
    font-style: italic;
    font-weight: normal;
}

.item-stats, .weapon-stats {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    font-size: 0.8rem;
    color: #e5e5e5;
}

.item-stats span, .weapon-stats span {
    background: rgba(255, 255, 255, 0.05);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    border-left: 2px solid #ffd700;
}

/* Equipment Statistics */
.protection-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.stat-group {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.stat-group h4 {
    color: #ffd700;
    margin-bottom: 1rem;
    text-align: center;
    font-size: 1.1rem;
}

.ac-breakdown {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.ac-main {
    text-align: center;
}

.ac-value {
    font-size: 3rem;
    font-weight: bold;
    color: #ffd700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
}

.ac-label {
    display: block;
    color: #b0b0b0;
    font-size: 0.9rem;
    margin-top: 0.5rem;
}

.ac-details {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.ac-component {
    display: flex;
    justify-content: space-between;
    color: #e5e5e5;
    font-size: 0.9rem;
    padding: 0.3rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.encumbrance-info {
    text-align: center;
}

.weight-display {
    font-size: 1.5rem;
    color: #ffd700;
    margin-bottom: 1rem;
}

.weight-bar {
    width: 100%;
    height: 20px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 1rem;
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.weight-fill {
    height: 100%;
    background: linear-gradient(90deg, #4caf50, #8bc34a);
    transition: all 0.3s ease;
}

.weight-fill.heavy {
    background: linear-gradient(90deg, #ff9800, #ffc107);
}

.weight-fill.overloaded {
    background: linear-gradient(90deg, #f44336, #e57373);
}

.encumbrance-level {
    color: #4caf50;
    font-weight: bold;
}

.encumbrance-level.heavy {
    color: #ff9800;
}

.encumbrance-level.overloaded {
    color: #f44336;
}

.movement-stats {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.movement-item {
    display: flex;
    justify-content: space-between;
    color: #e5e5e5;
    font-size: 0.9rem;
    padding: 0.3rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.movement-item.total {
    border-top: 2px solid rgba(255, 215, 0, 0.3);
    border-bottom: none;
    padding-top: 0.8rem;
    margin-top: 0.5rem;
    color: #ffd700;
}

/* Money Management */
.money-management {
    margin-bottom: 2rem;
}

.money-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
}

.money-input-group {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.money-label {
    color: #ffd700;
    font-size: 0.9rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.money-input {
    width: 80px;
    padding: 0.8rem;
    text-align: center;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: #e5e5e5;
    font-size: 1rem;
    font-weight: bold;
}

.money-input:focus {
    outline: none;
    border-color: #ffd700;
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}

.money-total-group {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.money-total {
    padding: 0.8rem;
    background: rgba(255, 215, 0, 0.2);
    border: 2px solid rgba(255, 215, 0, 0.4);
    border-radius: 8px;
    color: #ffd700;
    font-size: 1.1rem;
    font-weight: bold;
    min-width: 100px;
    text-align: center;
}

.money-converter {
    display: flex;
    justify-content: center;
    gap: 1rem;
}

.converter-btn {
    padding: 0.6rem 1.2rem;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.85rem;
}

.converter-btn:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.1);
    color: #ffd700;
}

/* Additional Inventory */
.additional-inventory {
    margin-top: 2rem;
}

.inventory-categories {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.inventory-category {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.inventory-category h5 {
    color: #ffd700;
    margin-bottom: 0.8rem;
    font-size: 1rem;
    text-align: center;
}

.inventory-textarea {
    width: 100%;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    color: #e5e5e5;
    padding: 0.8rem;
    font-size: 0.9rem;
    line-height: 1.4;
    resize: vertical;
    font-family: inherit;
}

.inventory-textarea:focus {
    outline: none;
    border-color: #ffd700;
    background: rgba(255, 255, 255, 0.08);
}

.inventory-textarea::placeholder {
    color: #666;
    font-style: italic;
}

/* Equipment Summary */
.equipment-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
}

.summary-column {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.summary-column h5 {
    color: #ffd700;
    margin-bottom: 1rem;
    text-align: center;
    font-size: 1rem;
}

.summary-item {
    margin: 0.5rem 0;
    color: #e5e5e5;
    font-size: 0.9rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.summary-item.no-magic {
    color: #666;
    font-style: italic;
    text-align: center;
    justify-content: center;
}

.summary-value {
    color: #ffd700;
    font-weight: bold;
}

/* Item Selection Modal */
.item-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    backdrop-filter: blur(3px);
}

.item-modal-content {
    background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(30, 33, 62, 0.95));
    border: 2px solid #ffd700;
    border-radius: 16px;
    max-width: 800px;
    max-height: 90vh;
    width: 90%;
    display: flex;
    flex-direction: column;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    color: #ffd700;
    margin: 0;
}

.close-modal {
    color: #ffd700;
    font-size: 2rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.close-modal:hover {
    color: #ffed4e;
    transform: scale(1.2);
}

.modal-body {
    padding: 1.5rem;
    flex: 1;
    overflow-y: auto;
}

.item-search {
    margin-bottom: 1.5rem;
}

.item-search input {
    width: 100%;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: #e5e5e5;
    font-size: 1rem;
}

.item-search input:focus {
    outline: none;
    border-color: #ffd700;
    background: rgba(255, 255, 255, 0.1);
}

.items-list {
    display: grid;
    gap: 1rem;
    max-height: 400px;
    overflow-y: auto;
}

.modal-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.modal-item:hover {
    background: rgba(255, 215, 0, 0.1);
    border-color: rgba(255, 215, 0, 0.4);
}

.modal-item.magical {
    border-left: 4px solid #9c27b0;
    background: rgba(156, 39, 176, 0.05);
}

.modal-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.modal-item-name {
    color: #ffd700;
    font-weight: bold;
    font-size: 1rem;
}

.modal-item-type {
    background: rgba(255, 255, 255, 0.1);
    color: #b0b0b0;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
}

.modal-item-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.modal-item-stat {
    background: rgba(255, 255, 255, 0.05);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    color: #e5e5e5;
}

.modal-footer {
    padding: 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    gap: 1rem;
}

.modal-btn {
    padding: 0.8rem 1.5rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: bold;
}

.modal-btn:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.15);
    color: #ffd700;
}

.modal-btn.remove {
    border-color: rgba(255, 107, 107, 0.4);
    background: rgba(255, 107, 107, 0.1);
    color: #ff6b6b;
}

.modal-btn.remove:hover {
    border-color: #ff6b6b;
    background: rgba(255, 107, 107, 0.2);
}

/* Specific equipment slot styling */
.head-slot.occupied {
    border-color: #9c27b0;
    background: rgba(156, 39, 176, 0.1);
}

.neck-slot.occupied {
    border-color: #4caf50;
    background: rgba(76, 175, 80, 0.1);
}

.back-slot.occupied {
    border-color: #2196f3;
    background: rgba(33, 150, 243, 0.1);
}

.arms-slot.occupied, .hands-slot.occupied {
    border-color: #ff9800;
    background: rgba(255, 152, 0, 0.1);
}

.ring-slot.occupied {
    border-color: #e91e63;
    background: rgba(233, 30, 99, 0.1);
}

.armor-slot.occupied {
    border-color: #795548;
    background: rgba(121, 85, 72, 0.1);
}

.shield-slot.occupied {
    border-color: #607d8b;
    background: rgba(96, 125, 139, 0.1);
}

.feet-slot.occupied, .waist-slot.occupied {
    border-color: #8bc34a;
    background: rgba(139, 195, 74, 0.1);
}

.weapon-slot.occupied {
    border-color: #f44336;
    background: rgba(244, 67, 54, 0.1);
}

.weapon-slot.primary.occupied {
    border-color: #ff6b6b;
    box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
}

/* Responsive Design */
@media (max-width: 1024px) {
    .equipment-actions {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
    }
    
    .protection-stats {
        grid-template-columns: 1fr;
    }
    
    .equipment-summary {
        grid-template-columns: 1fr;
    }
    
    .inventory-categories {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .equipment-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .weapons-grid {
        grid-template-columns: 1fr;
    }
    
    .money-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .item-modal-content {
        width: 95%;
        margin: 1rem;
    }
    
    .modal-footer {
        flex-direction: column;
    }
}

@media (max-width: 480px) {
    .equipment-grid {
        grid-template-columns: 1fr;
    }
    
    .quick-equip-buttons {
        justify-content: center;
    }
    
    .money-grid {
        grid-template-columns: 1fr;
    }
}

/* Loading and transition states */
.equipment-slot.loading {
    opacity: 0.6;
    pointer-events: none;
}

.equipment-slot.loading::after {
    content: '‚öôÔ∏è';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: translate(-50%, -50%) rotate(0deg); }
    to { transform: translate(-50%, -50%) rotate(360deg); }
}

.transition-highlight {
    animation: highlight-flash 1s ease;
}

@keyframes highlight-flash {
    0%, 100% { background: rgba(255, 215, 0, 0.15); }
    50% { background: rgba(255, 215, 0, 0.4); }
}
</style>

// ===========================================
// CONTINUACI√ìN SCRIPTS COMPLETOS AD&D 2.PANDUNK
// ===========================================

function calculateWeaponSlots() {
    const classGroup = getCurrentClassGroup();
    const level = getCurrentLevel();
    let slots = 0;
    
    switch (classGroup) {
        case 'luchador':
            slots = 4 + Math.floor((level - 1) / 3);
            break;
        case 'sacerdote':
        case 'bribon':
            slots = 2 + Math.floor((level - 1) / 4);
            break;
        case 'hechicero':
            slots = 1 + Math.floor((level - 1) / 6);
            break;
    }
    
    return slots;
}

function calculateNonWeaponSlots() {
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    const level = getCurrentLevel();
    const classGroup = getCurrentClassGroup();
    
    let baseSlots = 4; // Base para todos
    let levelBonus = Math.floor((level - 1) / 3); // +1 cada 3 niveles
    let wisdomBonus = Math.max(0, Math.floor((wisdom - 15) / 2)); // +1 por cada 2 de Sabidur√≠a sobre 15
    
    return baseSlots + levelBonus + wisdomBonus;
}

function filterWeaponProficiencies() {
    const searchTerm = document.getElementById('weapon-search')?.value.toLowerCase() || '';
    const categoryFilter = document.getElementById('weapon-category-filter')?.value || 'all';
    
    let filteredWeapons = WEAPONS_DATABASE.filter(weapon => {
        const matchesSearch = weapon.name.toLowerCase().includes(searchTerm);
        const matchesCategory = categoryFilter === 'all' || weapon.category === categoryFilter;
        return matchesSearch && matchesCategory;
    });
    
    displayWeaponProficiencies(filteredWeapons);
}

function displayWeaponProficiencies(weapons) {
    const container = document.getElementById('weapons-proficiency-grid');
    if (!container) return;
    
    container.innerHTML = weapons.map(weapon => `
        <div class="weapon-item" id="weapon-${weapon.name.replace(/\s/g, '')}" data-weapon="${weapon.name}">
            <div class="item-header">
                <div class="item-name">${weapon.name}</div>
                <div class="item-group">${weapon.category}</div>
            </div>
            <div class="item-details">
                <span class="item-characteristic">Da√±o: ${weapon.damage}</span>
                <span class="item-characteristic">Velocidad: ${weapon.speed}</span>
                <span class="item-characteristic">Tipo: ${weapon.type}</span>
            </div>
            <div class="proficiency-controls">
                <div class="proficiency-level">
                    <button class="level-btn" data-level="0" onclick="adjustWeaponProficiency('${weapon.name}', 0)">0</button>
                    <button class="level-btn" data-level="1" onclick="adjustWeaponProficiency('${weapon.name}', 1)">1</button>
                    <button class="level-btn" data-level="2" onclick="adjustWeaponProficiency('${weapon.name}', 2)">2</button>
                    <button class="level-btn" data-level="3" onclick="adjustWeaponProficiency('${weapon.name}', 3)">3</button>
                    <button class="level-btn" data-level="4" onclick="adjustWeaponProficiency('${weapon.name}', 4)">4</button>
                </div>
                <div class="slots-required">1 slot</div>
            </div>
            <div class="mastery-info" id="mastery-${weapon.name.replace(/\s/g, '')}">
                <!-- Efectos de maestr√≠a se muestran aqu√≠ -->
            </div>
        </div>
    `).join('');
    
    updateWeaponSlotsCounter();
}

function adjustWeaponProficiency(weaponName, level) {
    const currentSlots = calculateWeaponSlots();
    const usedSlots = getTotalUsedWeaponSlots();
    
    if (level > 0 && usedSlots >= currentSlots) {
        showNotification('No tienes suficientes casillas de armas');
        return;
    }
    
    characterData.skills.weapons[weaponName] = level;
    
    const weaponElement = document.getElementById(`weapon-${weaponName.replace(/\s/g, '')}`);
    if (weaponElement) {
        // Actualizar clase visual del elemento
        weaponElement.className = 'weapon-item';
        if (level > 0) weaponElement.classList.add('has-proficiency');
        if (level >= 2) weaponElement.classList.add('specialized');
        if (level >= 4) weaponElement.classList.add('mastered');
        
        // Actualizar botones
        const buttons = weaponElement.querySelectorAll('.level-btn');
        buttons.forEach((btn, index) => {
            btn.classList.toggle('active', index === level);
        });
        
        // Mostrar/ocultar informaci√≥n de maestr√≠a
        const masteryInfo = document.getElementById(`mastery-${weaponName.replace(/\s/g, '')}`);
        if (masteryInfo) {
            if (level >= 2) {
                masteryInfo.classList.add('show');
                masteryInfo.innerHTML = getWeaponMasteryEffects(level);
            } else {
                masteryInfo.classList.remove('show');
            }
        }
    }
    
    updateWeaponSlotsCounter();
    updateSkillsSummary();
    updateSpecializations();
}

function getWeaponMasteryEffects(level) {
    const effects = {
        1: 'Competente: Sin penalizadores',
        2: 'Especialista: +1 ataque, +2 da√±o',
        3: 'Experto: +2 ataque, +3 da√±o, +0.5 ataques/ronda',
        4: 'Maestro: +3 ataque, +4 da√±o, +1 ataque/ronda',
        5: 'Gran Maestro: +4 ataque, +5 da√±o, +1.5 ataques/ronda'
    };
    
    return `<strong>Nivel ${level}:</strong> ${effects[level] || 'Desconocido'}`;
}

function getTotalUsedWeaponSlots() {
    let total = 0;
    for (const weapon in characterData.skills.weapons) {
        const level = characterData.skills.weapons[weapon];
        if (level > 0) total += level;
    }
    return total;
}

function updateWeaponSlotsCounter() {
    const currentSlots = calculateWeaponSlots();
    const usedSlots = getTotalUsedWeaponSlots();
    
    const counter = document.getElementById('weapon-slots-counter');
    if (counter) {
        counter.textContent = `${usedSlots}/${currentSlots} casillas`;
    }
}

function filterNonWeaponProficiencies() {
    const searchTerm = document.getElementById('skill-search')?.value.toLowerCase() || '';
    const groupFilter = document.getElementById('skill-group-filter')?.value || 'all';
    
    let filteredSkills = NONWEAPON_SKILLS_DATABASE.filter(skill => {
        const matchesSearch = skill.name.toLowerCase().includes(searchTerm);
        const matchesGroup = groupFilter === 'all' || skill.group === groupFilter;
        return matchesSearch && matchesGroup;
    });
    
    displayNonWeaponProficiencies(filteredSkills);
}

function displayNonWeaponProficiencies(skills) {
    const container = document.getElementById('nonweapon-skills-grid');
    if (!container) return;
    
    container.innerHTML = skills.map(skill => `
        <div class="skill-item" id="skill-${skill.name.replace(/\s/g, '')}" data-skill="${skill.name}">
            <div class="item-header">
                <div class="item-name">${skill.name}</div>
                <div class="item-group">${skill.group}</div>
            </div>
            <div class="item-details">
                <span class="item-characteristic">Habilidad: ${skill.ability}</span>
                <span class="item-modifier">Mod: ${skill.modifier >= 0 ? '+' + skill.modifier : skill.modifier}</span>
            </div>
            <div class="proficiency-controls">
                <div class="proficiency-level">
                    <button class="level-btn" data-level="0" onclick="adjustNonWeaponProficiency('${skill.name}', 0)">0</button>
                    <button class="level-btn active" data-level="1" onclick="adjustNonWeaponProficiency('${skill.name}', 1)">1</button>
                    <button class="level-btn" data-level="2" onclick="adjustNonWeaponProficiency('${skill.name}', 2)">2</button>
                    <button class="level-btn" data-level="3" onclick="adjustNonWeaponProficiency('${skill.name}', 3)">3</button>
                </div>
                <div class="slots-required">${skill.slots} slot${skill.slots > 1 ? 's' : ''}</div>
            </div>
            <div class="mastery-info" id="skill-mastery-${skill.name.replace(/\s/g, '')}">
                Modificador total: ${calculateSkillModifier(skill, characterData)}
            </div>
        </div>
    `).join('');
    
    updateNonWeaponSlotsCounter();
}

function adjustNonWeaponProficiency(skillName, level) {
    const skill = NONWEAPON_SKILLS_DATABASE.find(s => s.name === skillName);
    if (!skill) return;
    
    const currentSlots = calculateNonWeaponSlots();
    const usedSlots = getTotalUsedNonWeaponSlots();
    const requiredSlots = skill.slots * level;
    
    if (level > 0 && usedSlots + requiredSlots > currentSlots) {
        showNotification('No tienes suficientes casillas de pericias');
        return;
    }
    
    characterData.skills.nonweapons[skillName] = level;
    
    const skillElement = document.getElementById(`skill-${skillName.replace(/\s/g, '')}`);
    if (skillElement) {
        skillElement.className = 'skill-item';
        if (level > 0) skillElement.classList.add('has-proficiency');
        if (level >= 2) skillElement.classList.add('specialized');
        
        // Actualizar botones
        const buttons = skillElement.querySelectorAll('.level-btn');
        buttons.forEach((btn, index) => {
            btn.classList.toggle('active', index === level);
        });
        
        // Actualizar informaci√≥n de maestr√≠a
        const masteryInfo = document.getElementById(`skill-mastery-${skillName.replace(/\s/g, '')}`);
        if (masteryInfo) {
            const modifier = calculateSkillModifier(skill, characterData);
            masteryInfo.innerHTML = `Modificador total: ${modifier >= 0 ? '+' + modifier : modifier}`;
        }
    }
    
    updateNonWeaponSlotsCounter();
    updateSkillsSummary();
}

function calculateSkillModifier(skill, character) {
    const abilityScore = character.abilities[skill.ability.toLowerCase()] || 10;
    let modifier = skill.modifier;
    
    // Modificador por grupo (penalizador si no es de tu clase)
    const characterClass = getCurrentClassGroup();
    const groupPenalty = getGroupPenalty(skill.group, characterClass);
    modifier += groupPenalty;
    
    // Modificador por armadura para habilidades de Destreza
    if (skill.ability === 'Des') {
        const armorPenalty = getArmorDestroyPenalty();
        modifier += armorPenalty;
    }
    
    return modifier;
}

function getGroupPenalty(skillGroup, characterClass) {
    const CLASS_GROUP_MAP = {
        'luchador': ['Luc'],
        'sacerdote': ['Sac'],
        'hechicero': ['Hec'],
        'bribon': ['Bri']
    };
    
    const allowedGroups = CLASS_GROUP_MAP[characterClass] || [];
    allowedGroups.push('Gen'); // General siempre est√° permitido
    
    return allowedGroups.includes(skillGroup) ? 0 : -3;
}

function getArmorDestroyPenalty() {
    const equippedArmor = getEquippedArmor();
    if (!equippedArmor || equippedArmor.name === 'Sin armadura') return 0;
    
    // Penalizadores simplificados por tipo de armadura
    if (equippedArmor.name.includes('Cuero')) return -2;
    if (equippedArmor.name.includes('Cota') || equippedArmor.name.includes('Escamas')) return -4;
    if (equippedArmor.name.includes('Placas') || equippedArmor.name.includes('Campo')) return -6;
    
    return 0;
}

function getTotalUsedNonWeaponSlots() {
    let total = 0;
    for (const skillName in characterData.skills.nonweapons) {
        const level = characterData.skills.nonweapons[skillName];
        const skill = NONWEAPON_SKILLS_DATABASE.find(s => s.name === skillName);
        if (skill && level > 0) {
            total += skill.slots * level;
        }
    }
    return total;
}

function updateNonWeaponSlotsCounter() {
    const currentSlots = calculateNonWeaponSlots();
    const usedSlots = getTotalUsedNonWeaponSlots();
    
    const counter = document.getElementById('nonweapon-slots-counter');
    if (counter) {
        counter.textContent = `${usedSlots}/${currentSlots} casillas`;
    }
}

function showCombatStyles() {
    const container = document.getElementById('combat-styles-container');
    const classGroup = getCurrentClassGroup();
    
    // Solo los luchadores pueden aprender estilos de combate
    if (classGroup !== 'luchador') {
        container.innerHTML = `
            <div class="no-styles-message">
                <p>Los estilos de combate solo est√°n disponibles para clases de <strong>Luchador</strong></p>
                <small>Clases v√°lidas: B√°rbaro, Ranger, Guerrero, Palad√≠n, Samur√°i</small>
            </div>
        `;
        return;
    }
    
    container.innerHTML = Object.entries(COMBAT_STYLES).map(([styleId, style]) => `
        <div class="combat-style-card" id="style-${styleId}">
            <div class="style-header">
                <div class="style-name">${style.name}</div>
                <div class="style-cost">Requiere especializaci√≥n en arma</div>
            </div>
            <div class="style-description">${style.description}</div>
            <div class="style-levels">
                ${Object.entries(style.levels).map(([levelId, levelData]) => `
                    <div class="style-level" id="style-${styleId}-${levelId}">
                        <div class="style-level-name">${levelData.name}</div>
                        <div class="style-level-effect">${levelData.effects}</div>
                        <button class="style-level-btn" onclick="purchaseCombatStyle('${styleId}', '${levelId}')">
                            Aprender (${levelData.cost} slot${levelData.cost > 1 ? 's' : ''})
                        </button>
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('');
}

function purchaseCombatStyle(styleId, levelId) {
    const style = COMBAT_STYLES[styleId];
    const level = style.levels[levelId];
    
    const currentSlots = calculateWeaponSlots();
    const usedSlots = getTotalUsedWeaponSlots();
    
    if (usedSlots + level.cost > currentSlots) {
        showNotification('No tienes suficientes casillas de armas para este estilo');
        return;
    }
    
    if (!characterData.skills.combatStyles) {
        characterData.skills.combatStyles = {};
    }
    
    if (!characterData.skills.combatStyles[styleId]) {
        characterData.skills.combatStyles[styleId] = {};
    }
    
    characterData.skills.combatStyles[styleId][levelId] = true;
    
    // Actualizar interfaz
    const levelElement = document.getElementById(`style-${styleId}-${levelId}`);
    if (levelElement) {
        levelElement.classList.add('purchased');
        const button = levelElement.querySelector('.style-level-btn');
        if (button) {
            button.textContent = '‚úì Aprendido';
            button.classList.add('purchased');
            button.disabled = true;
        }
    }
    
    updateSkillsSummary();
    showNotification(`Estilo ${style.name} (${level.name}) aprendido`);
}

function updateSkillsSummary() {
    updateMasteredWeaponsList();
    updateNotableSkillsList();
    updateActiveStylesList();
}

function updateMasteredWeaponsList() {
    const masteredWeapons = [];
    
    for (const weaponName in characterData.skills.weapons) {
        const level = characterData.skills.weapons[weaponName];
        if (level >= 2) {
            const levelNames = ['', 'Competente', 'Especialista', 'Experto', 'Maestro', 'Gran Maestro'];
            masteredWeapons.push(`${weaponName}: ${levelNames[level] || 'Desconocido'}`);
        }
    }
    
    const container = document.getElementById('mastered-weapons-list');
    if (container) {
        if (masteredWeapons.length > 0) {
            container.innerHTML = masteredWeapons.map(weapon => 
                `<p class="summary-item">${weapon}</p>`
            ).join('');
        } else {
            container.innerHTML = '<p style="color: #b0b0b0; font-style: italic;">Ninguna todav√≠a</p>';
        }
    }
}

function updateNotableSkillsList() {
    const notableSkills = [];
    
    for (const skillName in characterData.skills.nonweapons) {
        const level = characterData.skills.nonweapons[skillName];
        if (level >= 2) {
            notableSkills.push(`${skillName}: Nivel ${level}`);
        }
    }
    
    const container = document.getElementById('notable-skills-list');
    if (container) {
        if (notableSkills.length > 0) {
            container.innerHTML = notableSkills.map(skill => 
                `<p class="summary-item">${skill}</p>`
            ).join('');
        } else {
            container.innerHTML = '<p style="color: #b0b0b0; font-style: italic;">Ninguna todav√≠a</p>';
        }
    }
}

function updateActiveStylesList() {
    const activeStyles = [];
    
    for (const styleId in characterData.skills.combatStyles || {}) {
        const style = COMBAT_STYLES[styleId];
        const purchasedLevels = characterData.skills.combatStyles[styleId];
        
        for (const levelId in purchasedLevels) {
            if (purchasedLevels[levelId]) {
                const levelData = style.levels[levelId];
                activeStyles.push(`${style.name}: ${levelData.name}`);
            }
        }
    }
    
    const container = document.getElementById('active-styles-list');
    if (container) {
        if (activeStyles.length > 0) {
            container.innerHTML = activeStyles.map(styleLevel => 
                `<p class="summary-item">${styleLevel}</p>`
            ).join('');
        } else {
            container.innerHTML = '<p style="color: #b0b0b0; font-style: italic;">Ninguno todav√≠a</p>';
        }
    }
}

function updateSpecializations() {
    // Actualizar especializations mostradas en el tab de combate
    const container = document.getElementById('active-specializations');
    if (!container) return;
    
    const specializedWeapons = [];
    for (const weaponName in characterData.skills.weapons) {
        const level = characterData.skills.weapons[weaponName];
        if (level >= 2) {
            const levelNames = ['', 'Competente', 'Especialista', 'Experto', 'Maestro', 'Gran Maestro'];
            specializedWeapons.push({
                name: weaponName,
                level: levelNames[level] || 'Desconocido',
                effects: getWeaponMasteryEffects(level)
            });
        }
    }
    
    if (specializedWeapons.length > 0) {
        container.innerHTML = specializedWeapons.map(weapon => `
            <div class="specialization-item">
                <div class="spec-weapon-name">${weapon.name}</div>
                <div class="spec-level">${weapon.level}</div>
                <div class="spec-effects">${weapon.effects}</div>
            </div>
        `).join('');
    } else {
        container.innerHTML = `
            <div class="no-specializations">
                <p style="color: #b0b0b0; font-style: italic; text-align: center;">
                    No hay especializaciones activas.<br>
                    Ve al tab de Pericias para especializar en armas.
                </p>
            </div>
        `;
    }
}

// ===========================================
// TAB CONJUROS - FUNCIONES
// ===========================================

function detectCasterAbilities() {
    const activeClasses = getActiveClasses();
    const casterInfo = document.getElementById('caster-info');
    const castingAbilities = document.getElementById('casting-abilities');
    
    let hasArcane = false;
    let hasDivine = false;
    let hasPsionic = false;
    
    // Detectar tipos de lanzadores
    activeClasses.forEach(className => {
        if (['mago', 'hechicero', 'bruja', 'art√≠fice'].includes(className)) hasArcane = true;
        if (['cl√©rigo', 'druida', 'cham√°n'].includes(className)) hasDivine = true;
        if (['psi√≥nico'].includes(className)) hasPsionic = true;
    });
    
    if (!hasArcane && !hasDivine && !hasPsionic) {
        casterInfo.innerHTML = `
            <p style="color: #b0b0b0; font-style: italic; text-align: center;">
                Este personaje no puede lanzar conjuros ni usar poderes psi√≥nicos.
            </p>
        `;
        castingAbilities.style.display = 'none';
        hideSpellSections();
        return;
    }
    
    // Mostrar capacidades detectadas
    casterInfo.innerHTML = `
        <p style="color: #4caf50; text-align: center;">
            <strong>¬°Capacidades m√°gicas detectadas!</strong><br>
            Este personaje puede lanzar conjuros.
        </p>
    `;
    
    castingAbilities.style.display = 'grid';
    
    // Configurar cada tipo de lanzamiento
    if (hasArcane) {
        setupArcaneCasting();
        document.getElementById('arcane-casting').style.display = 'block';
    }
    
    if (hasDivine) {
        setupDivineCasting();
        document.getElementById('divine-casting').style.display = 'block';
    }
    
    if (hasPsionic) {
        setupPsionicCasting();
        document.getElementById('psionic-casting').style.display = 'block';
    }
    
    showSpellSections();
}

function setupArcaneCasting() {
    const intelligence = parseInt(document.getElementById('intelligence')?.value) || 10;
    const level = getCurrentLevel();
    
    const maxLevel = Math.min(9, Math.max(0, Math.floor((intelligence - 8) / 2)));
    const currentMana = characterData.spells.mana.arcane || 0;
    const maxMana = level * (intelligence + 1);
    
    document.getElementById('max-arcane-level').textContent = maxLevel;
    document.getElementById('current-arcane-mana').textContent = `${currentMana}/${maxMana}`;
}

function setupDivineCasting() {
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    const level = getCurrentLevel();
    
    const maxLevel = Math.min(7, Math.max(0, Math.floor((wisdom - 8) / 2)));
    const currentMana = characterData.spells.mana.divine || 0;
    const maxMana = level * (wisdom + 1);
    
    document.getElementById('max-divine-level').textContent = maxLevel;
    document.getElementById('current-divine-mana').textContent = `${currentMana}/${maxMana}`;
}

function setupPsionicCasting() {
    const currentPSP = characterData.spells.psp || 0;
    const maxPSP = calculateMaxPSP();
    
    document.getElementById('current-psp').textContent = `${currentPSP}/${maxPSP}`;
    document.getElementById('known-disciplines').textContent = Math.floor(getCurrentLevel() / 3) + 1;
}

function calculateMaxPSP() {
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    const constitution = parseInt(document.getElementById('constitution')?.value) || 10;
    const intelligence = parseInt(document.getElementById('intelligence')?.value) || 10;
    const level = getCurrentLevel();
    
    const basePSP = wisdom + Math.floor(constitution / 4) + Math.floor(intelligence / 4);
    return basePSP + (level - 1) * (10 + Math.floor((wisdom - 10) / 2));
}

function hideSpellSections() {
    document.getElementById('spell-slots-section').style.display = 'none';
    document.getElementById('spellbook-section').style.display = 'none';
}

function showSpellSections() {
    document.getElementById('spell-slots-section').style.display = 'block';
    document.getElementById('spellbook-section').style.display = 'block';
    generateSpellSlots();
}

function toggleSpellSystem() {
    const selectedSystem = document.querySelector('input[name="spell-system"]:checked')?.value;
    
    if (selectedSystem === 'slots') {
        document.getElementById('slots-display').style.display = 'block';
        document.getElementById('mana-display').style.display = 'none';
    } else {
        document.getElementById('slots-display').style.display = 'none';
        document.getElementById('mana-display').style.display = 'block';
        setupManaDisplay();
    }
}

function generateSpellSlots() {
    const hasArcane = hasClassInGroup('hechicero');
    const hasDivine = hasClassInGroup('sacerdote');
    
    if (hasArcane) {
        generateArcaneSlots();
        document.getElementById('arcane-slots').style.display = 'block';
        document.getElementById('arcane-mana-pool').style.display = 'block';
    }
    
    if (hasDivine) {
        generateDivineSlots();
        document.getElementById('divine-slots').style.display = 'block';
        document.getElementById('divine-mana-pool').style.display = 'block';
    }
}

function generateArcaneSlots() {
    const level = getCurrentLevel();
    const intelligence = parseInt(document.getElementById('intelligence')?.value) || 10;
    
    // Tabla simplificada de slots por nivel de hechicero
    const slotsTable = {
        1: [1, 0, 0, 0, 0, 0, 0, 0, 0],
        2: [2, 0, 0, 0, 0, 0, 0, 0, 0],
        3: [2, 1, 0, 0, 0, 0, 0, 0, 0],
        4: [3, 2, 0, 0, 0, 0, 0, 0, 0],
        5: [4, 2, 1, 0, 0, 0, 0, 0, 0],
        6: [4, 2, 2, 0, 0, 0, 0, 0, 0],
        7: [4, 3, 2, 1, 0, 0, 0, 0, 0],
        8: [4, 3, 3, 2, 0, 0, 0, 0, 0],
        9: [4, 3, 3, 2, 1, 0, 0, 0, 0],
        10: [4, 4, 3, 2, 2, 0, 0, 0, 0]
    };
    
    const slots = slotsTable[Math.min(level, 10)] || slotsTable[1];
    const maxSpellLevel = Math.min(9, Math.max(0, Math.floor((intelligence - 8) / 2)));
    
    let html = '';
    for (let spellLevel = 1; spellLevel <= maxSpellLevel && spellLevel <= 9; spellLevel++) {
        const slotCount = slots[spellLevel - 1] || 0;
        if (slotCount > 0) {
            html += `
                <div class="spell-level-group">
                    <div class="spell-level-header">Nivel ${spellLevel}</div>
                    <div class="spell-slots-row">
                        ${Array(slotCount).fill().map((_, i) => 
                            `<div class="spell-slot available" onclick="toggleSpellSlot('arcane', ${spellLevel}, ${i})" id="arcane-${spellLevel}-${i}">${i + 1}</div>`
                        ).join('')}
                    </div>
                </div>
            `;
        }
    }
    
    document.getElementById('arcane-levels-grid').innerHTML = html;
}

function generateDivineSlots() {
    const level = getCurrentLevel();
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    
    // Tabla simplificada para sacerdotes
    const slotsTable = {
        1: [1, 0, 0, 0, 0, 0, 0],
        2: [2, 0, 0, 0, 0, 0, 0],
        3: [2, 1, 0, 0, 0, 0, 0],
        4: [3, 2, 0, 0, 0, 0, 0],
        5: [3, 3, 1, 0, 0, 0, 0],
        6: [3, 3, 2, 0, 0, 0, 0],
        7: [3, 3, 2, 1, 0, 0, 0],
        8: [3, 3, 3, 2, 0, 0, 0],
        9: [4, 4, 3, 2, 1, 0, 0],
        10: [4, 4, 3, 3, 2, 0, 0]
    };
    
    const slots = slotsTable[Math.min(level, 10)] || slotsTable[1];
    const maxSpellLevel = Math.min(7, Math.max(0, Math.floor((wisdom - 8) / 2)));
    
    let html = '';
    for (let spellLevel = 1; spellLevel <= maxSpellLevel && spellLevel <= 7; spellLevel++) {
        const slotCount = slots[spellLevel - 1] || 0;
        if (slotCount > 0) {
            html += `
                <div class="spell-level-group">
                    <div class="spell-level-header">Nivel ${spellLevel}</div>
                    <div class="spell-slots-row">
                        ${Array(slotCount).fill().map((_, i) => 
                            `<div class="spell-slot available" onclick="toggleSpellSlot('divine', ${spellLevel}, ${i})" id="divine-${spellLevel}-${i}">${i + 1}</div>`
                        ).join('')}
                    </div>
                </div>
            `;
        }
    }
    
    document.getElementById('divine-levels-grid').innerHTML = html;
}

function toggleSpellSlot(type, level, slot) {
    const slotElement = document.getElementById(`${type}-${level}-${slot}`);
    if (!slotElement) return;
    
    if (slotElement.classList.contains('available')) {
        slotElement.classList.remove('available');
        slotElement.classList.add('used');
    } else {
        slotElement.classList.remove('used');
        slotElement.classList.add('available');
    }
}

function setupManaDisplay() {
    const hasArcane = hasClassInGroup('hechicero');
    const hasDivine = hasClassInGroup('sacerdote');
    
    if (hasArcane) {
        const currentMana = characterData.spells.mana.arcane || 0;
        const maxMana = calculateMaxArcaneMana();
        updateManaBar('arcane', currentMana, maxMana);
        characterData.spells.mana.arcane = maxMana; // Reset to full
    }
    
    if (hasDivine) {
        const currentMana = characterData.spells.mana.divine || 0;
        const maxMana = calculateMaxDivineMana();
        updateManaBar('divine', currentMana, maxMana);
        characterData.spells.mana.divine = maxMana; // Reset to full
    }
}

function calculateMaxArcaneMana() {
    const intelligence = parseInt(document.getElementById('intelligence')?.value) || 10;
    const level = getCurrentLevel();
    return level * (intelligence + 1);
}

function calculateMaxDivineMana() {
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    const level = getCurrentLevel();
    return level * (wisdom + 1);
}

function adjustMana(type, amount) {
    const maxMana = type === 'arcane' ? calculateMaxArcaneMana() : calculateMaxDivineMana();
    let currentMana = characterData.spells.mana[type] || maxMana;
    
    currentMana = Math.max(0, Math.min(maxMana, currentMana + amount));
    characterData.spells.mana[type] = currentMana;
    
    updateManaBar(type, currentMana, maxMana);
    
    if (amount < 0) {
        showNotification(`${amount * -1} puntos de man√° ${type} gastados`);
    }
}

function restoreMana(type) {
    const maxMana = type === 'arcane' ? calculateMaxArcaneMana() : calculateMaxDivineMana();
    characterData.spells.mana[type] = maxMana;
    updateManaBar(type, maxMana, maxMana);
    showNotification(`Man√° ${type} completamente restaurado`);
}

function updateManaBar(type, current, max) {
    const percentage = max > 0 ? (current / max) * 100 : 0;
    
    const manaBar = document.getElementById(`${type}-mana-current`);
    const manaText = document.getElementById(`${type}-mana-text`);
    
    if (manaBar) {
        manaBar.style.width = `${percentage}%`;
        manaBar.classList.add(type);
        
        if (percentage < 25) {
            manaBar.classList.add('draining');
        } else {
            manaBar.classList.remove('draining');
        }
    }
    
    if (manaText) {
        manaText.textContent = `${current}/${max}`;
    }
}

// Base de datos de conjuros
const SPELLS_DATABASE = {
    common: [
        // Conjuros Arcanos Nivel 1
        { name: 'Misiles M√°gicos', level: 1, type: 'arcane', school: 'Evocation', description: 'Proyectiles de energ√≠a que impactan autom√°ticamente' },
        { name: 'Luz', level: 1, type: 'arcane', school: 'Alteration', description: 'Crea luz brillante en un objeto' },
        { name: 'Detectar Magia', level: 1, type: 'arcane', school: 'Divination', description: 'Revela auras m√°gicas' },
        { name: 'Armadura', level: 1, type: 'arcane', school: 'Conjuration', description: 'CA 6 + mod Destreza' },
        { name: 'Escudo', level: 1, type: 'arcane', school: 'Evocation', description: 'Protecci√≥n contra proyectiles' },
        
        // Conjuros Divinos Nivel 1
        { name: 'Curar Heridas Leves', level: 1, type: 'divine', school: 'Necromancy', description: 'Cura 1d8 puntos de da√±o' },
        { name: 'Bendecir', level: 1, type: 'divine', school: 'Conjuration', description: '+1 ataque y moral' },
        { name: 'Protecci√≥n contra el Mal', level: 1, type: 'divine', school: 'Abjuration', description: 'Barrera contra criaturas malvadas' },
        { name: 'Detectar Mal', level: 1, type: 'divine', school: 'Divination', description: 'Revela intenciones malvadas' },
        { name: 'Crear Agua', level: 1, type: 'divine', school: 'Alteration', description: 'Genera agua potable' }
    ],
    
    advanced: [
        // Conjuros de nivel superior
        { name: 'Bola de Fuego', level: 3, type: 'arcane', school: 'Evocation', description: 'Explosi√≥n de fuego 1d6/nivel' },
        { name: 'Rayo', level: 3, type: 'arcane', school: 'Evocation', description: 'Rayo el√©ctrico 1d6/nivel' },
        { name: 'Volar', level: 3, type: 'arcane', school: 'Alteration', description: 'Permite volar durante 1 turno/nivel' },
        { name: 'Invisibilidad', level: 2, type: 'arcane', school: 'Illusion', description: 'Vuelve invisible al objetivo' },
        { name: 'Curar Heridas Graves', level: 3, type: 'divine', school: 'Necromancy', description: 'Cura 3d8+3 puntos de da√±o' },
        { name: 'Disipar Magia', level: 3, type: 'divine', school: 'Abjuration', description: 'Elimina efectos m√°gicos' },
        { name: 'Palabra de Poder: Aturdir', level: 7, type: 'arcane', school: 'Conjuration', description: 'Aturde criaturas con PG bajos' }
    ],
    
    psionic: [
        // Poderes Psi√≥nicos
        { name: 'Telepat√≠a', level: 1, type: 'psionic', school: 'Telepathy', description: 'Comunicaci√≥n mental' },
        { name: 'Telequinesis', level: 2, type: 'psionic', school: 'Psychokinesis', description: 'Mover objetos con la mente' },
        { name: 'Clarividencia', level: 1, type: 'psionic', school: 'Clairsentience', description: 'Ver lugares remotos' },
        { name: 'Dominaci√≥n', level: 3, type: 'psionic', school: 'Telepathy', description: 'Control mental' },
        { name: 'Barrera Mental', level: 1, type: 'psionic', school: 'Telepathy', description: 'Protecci√≥n psi√≥nica' }
    ]
};

function loadSpellLibrary() {
    loadLibraryTab('common');
    loadLibraryTab('advanced');
    loadLibraryTab('psionic');
}

function showLibraryTab(tabName) {
    // Cambiar pesta√±as activas
    document.querySelectorAll('.library-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.getElementById(`tab-${tabName}`).classList.add('active');
    
    // Cambiar contenido activo
    document.querySelectorAll('.library-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`${tabName}-spells`).classList.add('active');
    
    loadLibraryTab(tabName);
}

function loadLibraryTab(tabName) {
    const spells = SPELLS_DATABASE[tabName] || [];
    const container = document.getElementById(`${tabName}-spells-grid`);
    
    if (!container) return;
    
    container.innerHTML = spells.map(spell => `
        <div class="library-spell-item ${spell.type}" onclick="showSpellModal('${spell.name}')">
            <div class="spell-header">
                <div class="spell-name">${spell.name}</div>
                <div class="spell-level">Niv ${spell.level}</div>
                <div class="spell-school">${spell.school}</div>
            </div>
            <div class="spell-description">${spell.description}</div>
            <button class="add-spell-btn" onclick="addSpellToGrimoire('${spell.name}'); event.stopPropagation();">
                + A√±adir
            </button>
        </div>
    `).join('');
}

function addSpellToGrimoire(spellName) {
    const spell = findSpellByName(spellName);
    if (!spell) return;
    
    // Verificar si ya lo tiene
    if (characterData.spells.known.find(s => s.name === spellName)) {
        showNotification('Ya conoces este conjuro');
        return;
    }
    
    characterData.spells.known.push(spell);
    organizeSpellsByLevel();
    showNotification(`${spellName} a√±adido al grimorio`);
}

function findSpellByName(name) {
    for (const category in SPELLS_DATABASE) {
        const spell = SPELLS_DATABASE[category].find(s => s.name === name);
        if (spell) return spell;
    }
    return null;
}

function organizeSpellsByLevel() {
    const container = document.getElementById('spells-by-level');
    if (!container) return;
    
    const spellsByLevel = {};
    
    characterData.spells.known.forEach(spell => {
        if (!spellsByLevel[spell.level]) {
            spellsByLevel[spell.level] = [];
        }
        spellsByLevel[spell.level].push(spell);
    });
    
    let html = '';
    for (let level = 0; level <= 9; level++) {
        const spells = spellsByLevel[level] || [];
        if (spells.length > 0) {
            html += `
                <div class="spell-level-section">
                    <div class="spell-level-title">
                        ${level === 0 ? 'Trucos' : `Nivel ${level}`} (${spells.length})
                    </div>
                    <div class="spells-list">
                        ${spells.map(spell => `
                            <div class="spell-item ${spell.type}" onclick="showSpellModal('${spell.name}')">
                                <div class="spell-header">
                                    <div class="spell-name">${spell.name}</div>
                                    <div class="spell-level">Niv ${spell.level}</div>
                                    <div class="spell-school">${spell.school}</div>
                                </div>
                                <div class="spell-description">${spell.description}</div>
                                <div class="spell-actions">
                                    <button class="spell-action-btn" onclick="castSpell('${spell.name}'); event.stopPropagation();" title="Lanzar">‚ö°</button>
                                    <button class="spell-action-btn" onclick="removeSpellFromGrimoire('${spell.name}'); event.stopPropagation();" title="Eliminar">‚úï</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
    }
    
    container.innerHTML = html || '<p style="text-align: center; color: #666;">No hay conjuros en el grimorio</p>';
}

function removeSpellFromGrimoire(spellName) {
    characterData.spells.known = characterData.spells.known.filter(spell => spell.name !== spellName);
    organizeSpellsByLevel();
    showNotification(`${spellName} eliminado del grimorio`);
}

function castSpell(spellName) {
    const spell = characterData.spells.known.find(s => s.name === spellName);
    if (!spell) return;
    
    const manaCost = spell.level * 2 + 1;
    const manaType = spell.type === 'arcane' ? 'arcane' : spell.type === 'divine' ? 'divine' : null;
    
    if (spell.type === 'psionic') {
        if (characterData.spells.psp < manaCost) {
            showNotification('PSP insuficiente para usar este poder');
            return;
        }
        characterData.spells.psp -= manaCost;
        showNotification(`${spellName} activado (${manaCost} PSP)`);
    } else if (manaType) {
        if (characterData.spells.mana[manaType] < manaCost) {
            showNotification(`Man√° ${manaType} insuficiente`);
            return;
        }
        adjustMana(manaType, -manaCost);
        showNotification(`${spellName} lanzado`);
    }
}

function showSpellModal(spellName) {
    const spell = findSpellByName(spellName) || characterData.spells.known.find(s => s.name === spellName);
    if (!spell) return;
    
    const modal = document.getElementById('spell-modal');
    const detail = document.getElementById('spell-detail');
    
    if (!modal || !detail) return;
    
    detail.innerHTML = `
        <h3>${spell.name}</h3>
        <div class="spell-meta">
            <strong>Nivel:</strong> ${spell.level}<br>
            <strong>Tipo:</strong> ${spell.type}<br>
            <strong>Escuela:</strong> ${spell.school}
        </div>
        <div class="spell-components">
            <strong>Componentes:</strong> V, S, M<br>
            <strong>Tiempo de lanzamiento:</strong> ${spell.level} segmentos<br>
            <strong>Alcance:</strong> ${spell.level * 10} metros<br>
            <strong>Duraci√≥n:</strong> ${spell.level} turnos
        </div>
        <p><strong>Descripci√≥n:</strong></p>
        <p>${spell.description}</p>
    `;
    
    modal.style.display = 'flex';
}

function closeSpellModal() {
    const modal = document.getElementById('spell-modal');
    if (modal) modal.style.display = 'none';
}

function filterSpells() {
    // Implementar filtros para el grimorio
    const typeFilter = document.getElementById('spell-type-filter')?.value || 'all';
    const levelFilter = document.getElementById('spell-level-filter')?.value || 'all';
    const schoolFilter = document.getElementById('spell-school-filter')?.value || 'all';
    const searchTerm = document.getElementById('spell-search')?.value.toLowerCase() || '';
    
    let filteredSpells = characterData.spells.known.filter(spell => {
        const matchesType = typeFilter === 'all' || spell.type === typeFilter;
        const matchesLevel = levelFilter === 'all' || spell.level.toString() === levelFilter;
        const matchesSchool = schoolFilter === 'all' || spell.school === schoolFilter;
        const matchesSearch = spell.name.toLowerCase().includes(searchTerm);
        
        return matchesType && matchesLevel && matchesSchool && matchesSearch;
    });
    
    // Reorganizar con spells filtrados temporalmente
    const originalSpells = [...characterData.spells.known];
    characterData.spells.known = filteredSpells;
    organizeSpellsByLevel();
    characterData.spells.known = originalSpells;
}

function filterLibrary() {
    const searchTerm = document.getElementById('library-search')?.value.toLowerCase() || '';
    const activeTab = document.querySelector('.library-tab.active')?.id.replace('tab-', '');
    
    if (!activeTab) return;
    
    const allSpells = SPELLS_DATABASE[activeTab] || [];
    const filteredSpells = allSpells.filter(spell => 
        spell.name.toLowerCase().includes(searchTerm) ||
        spell.description.toLowerCase().includes(searchTerm)
    );
    
    const container = document.getElementById(`${activeTab}-spells-grid`);
    if (!container) return;
    
    container.innerHTML = filteredSpells.map(spell => `
        <div class="library-spell-item ${spell.type}" onclick="showSpellModal('${spell.name}')">
            <div class="spell-header">
                <div class="spell-name">${spell.name}</div>
                <div class="spell-level">Niv ${spell.level}</div>
                <div class="spell-school">${spell.school}</div>
            </div>
            <div class="spell-description">${spell.description}</div>
            <button class="add-spell-btn" onclick="addSpellToGrimoire('${spell.name}'); event.stopPropagation();">
                + A√±adir
            </button>
        </div>
    `).join('');
}

function exportSpellbook() {
    const spellbook = {
        character: characterData.basicInfo.name || 'Personaje Sin Nombre',
        spells: characterData.spells.known,
        mana: characterData.spells.mana,
        psp: characterData.spells.psp,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(spellbook, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `grimorio_${spellbook.character.replace(/\s/g, '_')}.json`;
    link.click();
    URL.revokeObjectURL(url);
    
    showNotification('Grimorio exportado');
}

// ===========================================
// TAB EQUIPO - FUNCIONES
// ===========================================

// Base de datos de equipamiento
const EQUIPMENT_DATABASE = {
    helmet: [
        { name: 'Yelmo de Acero', ac: 0, weight: 5, type: 'armor', magical: false },
        { name: 'Corona Dorada', ac: 0, weight: 1, type: 'jewelry', magical: false },
        { name: 'Casco de Cuero', ac: 0, weight: 2, type: 'armor', magical: false },
        { name: 'Yelmo +1', ac: 1, weight: 5, type: 'armor', magical: true }
    ],
    
    armor: [
        { name: 'Sin Armadura', ac: 10, weight: 0, type: 'none', dexLimit: 99, speed: 12 },
        { name: 'Armadura de Cuero', ac: 8, weight: 15, type: 'light', dexLimit: 6, speed: 12 },
        { name: 'Armadura de Cuero Tachonado', ac: 7, weight: 20, type: 'light', dexLimit: 5, speed: 11 },
        { name: 'Cota de Mallas', ac: 5, weight: 40, type: 'medium', dexLimit: 2, speed: 9 },
        { name: 'Armadura de Escamas', ac: 6, weight: 45, type: 'medium', dexLimit: 1, speed: 8 },
        { name: 'Armadura de Placas', ac: 3, weight: 60, type: 'heavy', dexLimit: 0, speed: 6 },
        { name: 'Armadura de Campo', ac: 2, weight: 70, type: 'heavy', dexLimit: 0, speed: 5 },
        { name: 'Armadura de Placas +1', ac: 2, weight: 55, type: 'heavy', dexLimit: 1, speed: 7, magical: true }
    ],
    
    shield: [
        { name: 'Sin Escudo', ac: 0, weight: 0, attacks: 0, type: 'none' },
        { name: 'Escudo Peque√±o', ac: 1, weight: 3, attacks: 0, type: 'light' },
        { name: 'Escudo Mediano', ac: 1, weight: 8, attacks: -1, type: 'medium' },
        { name: 'Escudo Grande', ac: 2, weight: 15, attacks: -2, type: 'heavy' },
        { name: 'Escudo +1', ac: 2, weight: 6, attacks: 0, type: 'medium', magical: true }
    ],
    
    weapon: WEAPONS_DATABASE, // Reutilizar la base de datos de armas
    
    boots: [
        { name: 'Botas de Cuero', ac: 0, weight: 3, speed: 0, type: 'normal' },
        { name: 'Botas de Velocidad', ac: 0, weight: 2, speed: 3, type: 'magical', magical: true },
        { name: 'Botas de Sigilo', ac: 0, weight: 1, stealth: 2, type: 'magical', magical: true }
    ],
    
    ring: [
        { name: 'Anillo Simple', ac: 0, weight: 0, type: 'jewelry' },
        { name: 'Anillo de Protecci√≥n +1', ac: 1, weight: 0, type: 'magical', magical: true },
        { name: 'Anillo de Regeneraci√≥n', healing: 1, weight: 0, type: 'magical', magical: true },
        { name: 'Anillo de Invisibilidad', invisibility: true, weight: 0, type: 'magical', magical: true }
    ]
};

// Quick-equip sets por clase
const QUICK_EQUIP_SETS = {
    fighter: {
        armor: 'Cota de Mallas',
        shield: 'Escudo Mediano', 
        weapon1: 'Espada Larga',
        helmet: 'Yelmo de Acero',
        boots: 'Botas de Cuero'
    },
    
    wizard: {
        armor: 'Sin Armadura',
        weapon1: 'Daga',
        boots: 'Botas de Cuero'
    },
    
    rogue: {
        armor: 'Armadura de Cuero',
        weapon1: 'Espada Corta',
        weapon3: 'Arco Corto',
        boots: 'Botas de Cuero'
    },
    
    cleric: {
        armor: 'Cota de Mallas',
        shield: 'Escudo Mediano',
        weapon1: 'Maza',
        helmet: 'Yelmo de Acero',
        boots: 'Botas de Cuero'
    },
    
    ranger: {
        armor: 'Armadura de Cuero Tachonado',
        weapon1: 'Espada Larga',
        weapon3: 'Arco Largo',
        boots: 'Botas de Cuero'
    }
};

function quickEquipSet(setType) {
    const set = QUICK_EQUIP_SETS[setType];
    if (!set) return;
    
    let itemsEquipped = 0;
    
    Object.entries(set).forEach(([slot, itemName]) => {
        if (equipItemByName(slot, itemName)) {
            itemsEquipped++;
        }
    });
    
    updateEquipmentStats();
    showNotification(`Set ${setType} equipado (${itemsEquipped} objetos)`);
}

function clearAllEquipment() {
    const equipmentSlots = [
        'helmet', 'crown', 'neck', 'cloak', 'bracers', 'gauntlets', 
        'ring1', 'ring2', 'armor', 'shield', 'boots', 'belt',
        'weapon1', 'weapon2', 'weapon3', 'weapon4'
    ];
    
    equipmentSlots.forEach(slot => {
        characterData.equipment[slot] = null;
        updateSlotDisplay(slot);
    });
    
    updateEquipmentStats();
    showNotification('Todo el equipo ha sido retirado');
}

function equipItemByName(slot, itemName) {
    const category = getSlotCategory(slot);
    const items = EQUIPMENT_DATABASE[category];
    
    if (!items) return false;
    
    const item = items.find(i => i.name === itemName);
    if (!item) return false;
    
    characterData.equipment[slot] = item;
    updateSlotDisplay(slot);
    return true;
}

function getSlotCategory(slot) {
    const categoryMap = {
        'helmet': 'helmet', 'crown': 'helmet',
        'armor': 'armor', 'shield': 'shield',
        'weapon1': 'weapon', 'weapon2': 'weapon', 'weapon3': 'weapon', 'weapon4': 'weapon',
        'boots': 'boots', 'ring1': 'ring', 'ring2': 'ring'
    };
    
    return categoryMap[slot] || 'helmet';
}

function openItemSelector(slot) {
    const modal = document.getElementById('item-selection-modal');
    const title = document.getElementById('modal-title');
    const itemsList = document.getElementById('modal-items-list');
    
    if (!modal || !title || !itemsList) return;
    
    const category = getSlotCategory(slot);
    const items = EQUIPMENT_DATABASE[category] || [];
    
    // Configurar modal
    title.textContent = `Seleccionar para ${slot}`;
    modal.dataset.currentSlot = slot;
    
    // Llenar lista de items
    itemsList.innerHTML = items.map(item => `
        <div class="modal-item ${item.magical ? 'magical' : ''}" onclick="selectItem('${item.name}')">
            <div class="modal-item-header">
                <div class="modal-item-name">${item.name}</div>
                <div class="modal-item-type">${item.type || category}</div>
            </div>
            <div class="modal-item-stats">
                ${item.ac !== undefined ? `<span class="modal-item-stat">CA: ${item.ac}</span>` : ''}
                ${item.damage ? `<span class="modal-item-stat">Da√±o: ${item.damage}</span>` : ''}
                ${item.weight ? `<span class="modal-item-stat">Peso: ${item.weight} kg</span>` : ''}
                ${item.speed !== undefined ? `<span class="modal-item-stat">Velocidad: ${item.speed}</span>` : ''}
                ${item.magical ? `<span class="modal-item-stat magical">M√°gico</span>` : '

<!-- Barra de Navegaci√≥n Actualizada -->
<div class="tab-navigation">
    <button class="tab-button active" onclick="showTab('basic')">
        üìã B√°sico
    </button>
    <button class="tab-button" onclick="showTab('abilities')">
        üí™ Habilidades
    </button>
    <button class="tab-button" onclick="showTab('categories')">
        üèõÔ∏è Categor√≠as
    </button>
    <button class="tab-button" onclick="showTab('combat')">
        ‚öîÔ∏è Combate
    </button>
    <button class="tab-button" onclick="showTab('skills')">
        üéØ Pericias
    </button>
    <button class="tab-button" onclick="showTab('spells')">
        ‚ú® Conjuros
    </button>
    <button class="tab-button" onclick="showTab('equipment')">
        üéí Equipo
    </button>
    <button class="tab-button" onclick="showTab('companions')">
        üêæ Compa√±eros
    </button>
</div>

<style>
/* Actualizaci√≥n de estilos para la navegaci√≥n expandida */
.tab-navigation {
    display: flex;
    gap: 0.5rem;
    background: rgba(0, 0, 0, 0.8);
    padding: 1rem;
    border-radius: 0 0 15px 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow-x: auto;
    scroll-behavior: smooth;
    flex-wrap: nowrap;
    min-height: 60px;
    align-items: center;
}

.tab-button {
    padding: 0.8rem 1.2rem;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    color: #e5e5e5;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
    font-size: 0.9rem;
    font-weight: 600;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    min-width: 120px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.tab-button:hover {
    border-color: rgba(255, 215, 0, 0.6);
    background: rgba(255, 215, 0, 0.15);
    color: #ffd700;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
}

.tab-button.active {
    border-color: #ffd700;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.2));
    color: #ffd700;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
}

.tab-button.active::before {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #ffd700, #ffed4e, #ffd700);
    border-radius: 0 0 8px 8px;
}

/* Indicador visual para tabs nuevos */
.tab-button[onclick="showTab('categories')"]::after,
.tab-button[onclick="showTab('companions')"]::after {
    content: '‚óè';
    position: absolute;
    top: 5px;
    right: 5px;
    color: #4CAF50;
    font-size: 0.7rem;
    animation: pulse-new 2s infinite;
}

@keyframes pulse-new {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

/* Responsive mejorado */
@media (max-width: 1024px) {
    .tab-navigation {
        gap: 0.3rem;
        padding: 0.8rem;
    }
    
    .tab-button {
        padding: 0.6rem 0.9rem;
        font-size: 0.8rem;
        min-width: 100px;
    }
}

@media (max-width: 768px) {
    .tab-navigation {
        flex-wrap: nowrap;
        overflow-x: auto;
        scrollbar-width: thin;
        scrollbar-color: #ffd700 rgba(0, 0, 0, 0.3);
    }
    
    .tab-navigation::-webkit-scrollbar {
        height: 6px;
    }
    
    .tab-navigation::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 3px;
    }
    
    .tab-navigation::-webkit-scrollbar-thumb {
        background: #ffd700;
        border-radius: 3px;
    }
    
    .tab-button {
        padding: 0.7rem 1rem;
        min-width: 90px;
        font-size: 0.75rem;
    }
}

@media (max-width: 480px) {
    .tab-button {
        padding: 0.6rem 0.8rem;
        min-width: 80px;
        font-size: 0.7rem;
    }
    
    /* Ocultar texto en m√≥viles muy peque√±os, solo mostrar emojis */
    .tab-button {
        flex-direction: column;
        gap: 0.2rem;
        line-height: 1.2;
    }
}

/* Efectos especiales para tabs espec√≠ficos */
.tab-button[onclick="showTab('categories')"] {
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(233, 30, 99, 0.1));
    border-color: rgba(156, 39, 176, 0.3);
}

.tab-button[onclick="showTab('categories')"].active {
    background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), rgba(233, 30, 99, 0.2));
    border-color: #9c27b0;
    color: #e1bee7;
    box-shadow: 0 0 20px rgba(156, 39, 176, 0.4);
}

.tab-button[onclick="showTab('companions')"] {
    background: linear-gradient(135deg, rgba(139, 195, 74, 0.1), rgba(76, 175, 80, 0.1));
    border-color: rgba(139, 195, 74, 0.3);
}

.tab-button[onclick="showTab('companions')"].active {
    background: linear-gradient(135deg, rgba(139, 195, 74, 0.2), rgba(76, 175, 80, 0.2));
    border-color: #8BC34A;
    color: #C8E6C9;
    box-shadow: 0 0 20px rgba(139, 195, 74, 0.4);
}

/* Animaci√≥n sutil al cargar */
.tab-button {
    animation: fadeInUp 0.5s ease forwards;
}

.tab-button:nth-child(1) { animation-delay: 0.1s; }
.tab-button:nth-child(2) { animation-delay: 0.2s; }
.tab-button:nth-child(3) { animation-delay: 0.3s; }
.tab-button:nth-child(4) { animation-delay: 0.4s; }
.tab-button:nth-child(5) { animation-delay: 0.5s; }
.tab-button:nth-child(6) { animation-delay: 0.6s; }
.tab-button:nth-child(7) { animation-delay: 0.7s; }
.tab-button:nth-child(8) { animation-delay: 0.8s; }

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Mejora para accesibilidad */
.tab-button:focus {
    outline: 2px solid #ffd700;
    outline-offset: 2px;
}

/* Indicador de contenido activo */
.tab-button.has-content::before {
    content: '';
    position: absolute;
    top: -2px;
    right: -2px;
    width: 8px;
    height: 8px;
    background: #4CAF50;
    border-radius: 50%;
    border: 2px solid #1a1a2e;
}
/* Estilos para controles de habilidades */
.abilities-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.control-group {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.debug-toggle {
    color: #b0b0b0;
    font-size: 0.85rem;
}

.debug-toggle input[type="checkbox"] {
    margin-right: 0.5rem;
}

/* Estilos para stats mejorados */
.stat-value-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.stat-detail {
    font-size: 0.8rem;
    color: #b0b0b0;
    text-align: center;
    min-height: 20px;
    font-weight: 500;
}

.manual-bonus-input {
    width: 70px;
    padding: 0.3rem;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    color: #e5e5e5;
    font-size: 0.8rem;
    text-align: center;
    margin-top: 0.3rem;
}

.manual-bonus-input:focus {
    outline: none;
    border-color: #ffd700;
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 8px rgba(255, 215, 0, 0.2);
}

.manual-bonus-input::placeholder {
    color: #666;
    font-size: 0.7rem;
}

.mana-card {
    border: 2px solid rgba(138, 43, 226, 0.4);
    background: linear-gradient(135deg, rgba(75, 0, 130, 0.15), rgba(138, 43, 226, 0.15));
}

.psp-card {
    border: 2px solid rgba(199, 21, 133, 0.4);
    background: linear-gradient(135deg, rgba(255, 20, 147, 0.15), rgba(199, 21, 133, 0.15));
}

</style>

<script>
// Script para inicializar los tabs adicionales cuando se carga la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    // Delay para asegurar que otros scripts est√©n cargados
    setTimeout(() => {
        if (typeof initializeAdditionalTabs === 'function') {
            initializeAdditionalTabs();
        } else if (window.addPandunkAdditional?.initializeAdditionalTabs) {
            window.addPandunkAdditional.initializeAdditionalTabs();
        }
        
        // Marcar tabs que tienen contenido
        updateTabContentIndicators();
    }, 1000);
});

function updateTabContentIndicators() {
    // Marcar tab de categor√≠as si hay modificadores aplicados
    const categoriesTab = document.querySelector('[onclick="showTab(\'categories\')"]');
    if (categoriesTab && window.addPandunkAdditional?.appliedRaceModifiers) {
        categoriesTab.classList.add('has-content');
    }
    
    // Marcar tab de compa√±eros si hay compa√±eros
    const companionsTab = document.querySelector('[onclick="showTab(\'companions\')"]');
    if (companionsTab && window.addPandunkAdditional?.companionsList?.length > 0) {
        companionsTab.classList.add('has-content');
    }
}

// Actualizar indicadores peri√≥dicamente
setInterval(updateTabContentIndicators, 5000);
</script>

// ===========================================
// CONTINUACI√ìN SCRIPTS COMPLETOS AD&D 2.PANDUNK
// ===========================================

function calculateWeaponSlots() {
    const classGroup = getCurrentClassGroup();
    const level = getCurrentLevel();
    let slots = 0;
    
    switch (classGroup) {
        case 'luchador':
            slots = 4 + Math.floor((level - 1) / 3);
            break;
        case 'sacerdote':
        case 'bribon':
            slots = 2 + Math.floor((level - 1) / 4);
            break;
        case 'hechicero':
            slots = 1 + Math.floor((level - 1) / 6);
            break;
    }
    
    return slots;
}

function calculateNonWeaponSlots() {
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    const level = getCurrentLevel();
    const classGroup = getCurrentClassGroup();
    
    let baseSlots = 4; // Base para todos
    let levelBonus = Math.floor((level - 1) / 3); // +1 cada 3 niveles
    let wisdomBonus = Math.max(0, Math.floor((wisdom - 15) / 2)); // +1 por cada 2 de Sabidur√≠a sobre 15
    
    return baseSlots + levelBonus + wisdomBonus;
}

function filterWeaponProficiencies() {
    const searchTerm = document.getElementById('weapon-search')?.value.toLowerCase() || '';
    const categoryFilter = document.getElementById('weapon-category-filter')?.value || 'all';
    
    let filteredWeapons = WEAPONS_DATABASE.filter(weapon => {
        const matchesSearch = weapon.name.toLowerCase().includes(searchTerm);
        const matchesCategory = categoryFilter === 'all' || weapon.category === categoryFilter;
        return matchesSearch && matchesCategory;
    });
    
    displayWeaponProficiencies(filteredWeapons);
}

function displayWeaponProficiencies(weapons) {
    const container = document.getElementById('weapons-proficiency-grid');
    if (!container) return;
    
    container.innerHTML = weapons.map(weapon => `
        <div class="weapon-item" id="weapon-${weapon.name.replace(/\s/g, '')}" data-weapon="${weapon.name}">
            <div class="item-header">
                <div class="item-name">${weapon.name}</div>
                <div class="item-group">${weapon.category}</div>
            </div>
            <div class="item-details">
                <span class="item-characteristic">Da√±o: ${weapon.damage}</span>
                <span class="item-characteristic">Velocidad: ${weapon.speed}</span>
                <span class="item-characteristic">Tipo: ${weapon.type}</span>
            </div>
            <div class="proficiency-controls">
                <div class="proficiency-level">
                    <button class="level-btn" data-level="0" onclick="adjustWeaponProficiency('${weapon.name}', 0)">0</button>
                    <button class="level-btn" data-level="1" onclick="adjustWeaponProficiency('${weapon.name}', 1)">1</button>
                    <button class="level-btn" data-level="2" onclick="adjustWeaponProficiency('${weapon.name}', 2)">2</button>
                    <button class="level-btn" data-level="3" onclick="adjustWeaponProficiency('${weapon.name}', 3)">3</button>
                    <button class="level-btn" data-level="4" onclick="adjustWeaponProficiency('${weapon.name}', 4)">4</button>
                </div>
                <div class="slots-required">1 slot</div>
            </div>
            <div class="mastery-info" id="mastery-${weapon.name.replace(/\s/g, '')}">
                <!-- Efectos de maestr√≠a se muestran aqu√≠ -->
            </div>
        </div>
    `).join('');
    
    updateWeaponSlotsCounter();
}

function adjustWeaponProficiency(weaponName, level) {
    const currentSlots = calculateWeaponSlots();
    const usedSlots = getTotalUsedWeaponSlots();
    
    if (level > 0 && usedSlots >= currentSlots) {
        showNotification('No tienes suficientes casillas de armas');
        return;
    }
    
    characterData.skills.weapons[weaponName] = level;
    
    const weaponElement = document.getElementById(`weapon-${weaponName.replace(/\s/g, '')}`);
    if (weaponElement) {
        // Actualizar clase visual del elemento
        weaponElement.className = 'weapon-item';
        if (level > 0) weaponElement.classList.add('has-proficiency');
        if (level >= 2) weaponElement.classList.add('specialized');
        if (level >= 4) weaponElement.classList.add('mastered');
        
        // Actualizar botones
        const buttons = weaponElement.querySelectorAll('.level-btn');
        buttons.forEach((btn, index) => {
            btn.classList.toggle('active', index === level);
        });
        
        // Mostrar/ocultar informaci√≥n de maestr√≠a
        const masteryInfo = document.getElementById(`mastery-${weaponName.replace(/\s/g, '')}`);
        if (masteryInfo) {
            if (level >= 2) {
                masteryInfo.classList.add('show');
                masteryInfo.innerHTML = getWeaponMasteryEffects(level);
            } else {
                masteryInfo.classList.remove('show');
            }
        }
    }
    
    updateWeaponSlotsCounter();
    updateSkillsSummary();
    updateSpecializations();
}

function getWeaponMasteryEffects(level) {
    const effects = {
        1: 'Competente: Sin penalizadores',
        2: 'Especialista: +1 ataque, +2 da√±o',
        3: 'Experto: +2 ataque, +3 da√±o, +0.5 ataques/ronda',
        4: 'Maestro: +3 ataque, +4 da√±o, +1 ataque/ronda',
        5: 'Gran Maestro: +4 ataque, +5 da√±o, +1.5 ataques/ronda'
    };
    
    return `<strong>Nivel ${level}:</strong> ${effects[level] || 'Desconocido'}`;
}

function getTotalUsedWeaponSlots() {
    let total = 0;
    for (const weapon in characterData.skills.weapons) {
        const level = characterData.skills.weapons[weapon];
        if (level > 0) total += level;
    }
    return total;
}

function updateWeaponSlotsCounter() {
    const currentSlots = calculateWeaponSlots();
    const usedSlots = getTotalUsedWeaponSlots();
    
    const counter = document.getElementById('weapon-slots-counter');
    if (counter) {
        counter.textContent = `${usedSlots}/${currentSlots} casillas`;
    }
}

function filterNonWeaponProficiencies() {
    const searchTerm = document.getElementById('skill-search')?.value.toLowerCase() || '';
    const groupFilter = document.getElementById('skill-group-filter')?.value || 'all';
    
    let filteredSkills = NONWEAPON_SKILLS_DATABASE.filter(skill => {
        const matchesSearch = skill.name.toLowerCase().includes(searchTerm);
        const matchesGroup = groupFilter === 'all' || skill.group === groupFilter;
        return matchesSearch && matchesGroup;
    });
    
    displayNonWeaponProficiencies(filteredSkills);
}

function displayNonWeaponProficiencies(skills) {
    const container = document.getElementById('nonweapon-skills-grid');
    if (!container) return;
    
    container.innerHTML = skills.map(skill => `
        <div class="skill-item" id="skill-${skill.name.replace(/\s/g, '')}" data-skill="${skill.name}">
            <div class="item-header">
                <div class="item-name">${skill.name}</div>
                <div class="item-group">${skill.group}</div>
            </div>
            <div class="item-details">
                <span class="item-characteristic">Habilidad: ${skill.ability}</span>
                <span class="item-modifier">Mod: ${skill.modifier >= 0 ? '+' + skill.modifier : skill.modifier}</span>
            </div>
            <div class="proficiency-controls">
                <div class="proficiency-level">
                    <button class="level-btn" data-level="0" onclick="adjustNonWeaponProficiency('${skill.name}', 0)">0</button>
                    <button class="level-btn active" data-level="1" onclick="adjustNonWeaponProficiency('${skill.name}', 1)">1</button>
                    <button class="level-btn" data-level="2" onclick="adjustNonWeaponProficiency('${skill.name}', 2)">2</button>
                    <button class="level-btn" data-level="3" onclick="adjustNonWeaponProficiency('${skill.name}', 3)">3</button>
                </div>
                <div class="slots-required">${skill.slots} slot${skill.slots > 1 ? 's' : ''}</div>
            </div>
            <div class="mastery-info" id="skill-mastery-${skill.name.replace(/\s/g, '')}">
                Modificador total: ${calculateSkillModifier(skill, characterData)}
            </div>
        </div>
    `).join('');
    
    updateNonWeaponSlotsCounter();
}

function adjustNonWeaponProficiency(skillName, level) {
    const skill = NONWEAPON_SKILLS_DATABASE.find(s => s.name === skillName);
    if (!skill) return;
    
    const currentSlots = calculateNonWeaponSlots();
    const usedSlots = getTotalUsedNonWeaponSlots();
    const requiredSlots = skill.slots * level;
    
    if (level > 0 && usedSlots + requiredSlots > currentSlots) {
        showNotification('No tienes suficientes casillas de pericias');
        return;
    }
    
    characterData.skills.nonweapons[skillName] = level;
    
    const skillElement = document.getElementById(`skill-${skillName.replace(/\s/g, '')}`);
    if (skillElement) {
        skillElement.className = 'skill-item';
        if (level > 0) skillElement.classList.add('has-proficiency');
        if (level >= 2) skillElement.classList.add('specialized');
        
        // Actualizar botones
        const buttons = skillElement.querySelectorAll('.level-btn');
        buttons.forEach((btn, index) => {
            btn.classList.toggle('active', index === level);
        });
        
        // Actualizar informaci√≥n de maestr√≠a
        const masteryInfo = document.getElementById(`skill-mastery-${skillName.replace(/\s/g, '')}`);
        if (masteryInfo) {
            const modifier = calculateSkillModifier(skill, characterData);
            masteryInfo.innerHTML = `Modificador total: ${modifier >= 0 ? '+' + modifier : modifier}`;
        }
    }
    
    updateNonWeaponSlotsCounter();
    updateSkillsSummary();
}

function calculateSkillModifier(skill, character) {
    const abilityScore = character.abilities[skill.ability.toLowerCase()] || 10;
    let modifier = skill.modifier;
    
    // Modificador por grupo (penalizador si no es de tu clase)
    const characterClass = getCurrentClassGroup();
    const groupPenalty = getGroupPenalty(skill.group, characterClass);
    modifier += groupPenalty;
    
    // Modificador por armadura para habilidades de Destreza
    if (skill.ability === 'Des') {
        const armorPenalty = getArmorDestroyPenalty();
        modifier += armorPenalty;
    }
    
    return modifier;
}

function getGroupPenalty(skillGroup, characterClass) {
    const CLASS_GROUP_MAP = {
        'luchador': ['Luc'],
        'sacerdote': ['Sac'],
        'hechicero': ['Hec'],
        'bribon': ['Bri']
    };
    
    const allowedGroups = CLASS_GROUP_MAP[characterClass] || [];
    allowedGroups.push('Gen'); // General siempre est√° permitido
    
    return allowedGroups.includes(skillGroup) ? 0 : -3;
}

function getArmorDestroyPenalty() {
    const equippedArmor = getEquippedArmor();
    if (!equippedArmor || equippedArmor.name === 'Sin armadura') return 0;
    
    // Penalizadores simplificados por tipo de armadura
    if (equippedArmor.name.includes('Cuero')) return -2;
    if (equippedArmor.name.includes('Cota') || equippedArmor.name.includes('Escamas')) return -4;
    if (equippedArmor.name.includes('Placas') || equippedArmor.name.includes('Campo')) return -6;
    
    return 0;
}

function getTotalUsedNonWeaponSlots() {
    let total = 0;
    for (const skillName in characterData.skills.nonweapons) {
        const level = characterData.skills.nonweapons[skillName];
        const skill = NONWEAPON_SKILLS_DATABASE.find(s => s.name === skillName);
        if (skill && level > 0) {
            total += skill.slots * level;
        }
    }
    return total;
}

function updateNonWeaponSlotsCounter() {
    const currentSlots = calculateNonWeaponSlots();
    const usedSlots = getTotalUsedNonWeaponSlots();
    
    const counter = document.getElementById('nonweapon-slots-counter');
    if (counter) {
        counter.textContent = `${usedSlots}/${currentSlots} casillas`;
    }
}

function showCombatStyles() {
    const container = document.getElementById('combat-styles-container');
    const classGroup = getCurrentClassGroup();
    
    // Solo los luchadores pueden aprender estilos de combate
    if (classGroup !== 'luchador') {
        container.innerHTML = `
            <div class="no-styles-message">
                <p>Los estilos de combate solo est√°n disponibles para clases de <strong>Luchador</strong></p>
                <small>Clases v√°lidas: B√°rbaro, Ranger, Guerrero, Palad√≠n, Samur√°i</small>
            </div>
        `;
        return;
    }
    
    container.innerHTML = Object.entries(COMBAT_STYLES).map(([styleId, style]) => `
        <div class="combat-style-card" id="style-${styleId}">
            <div class="style-header">
                <div class="style-name">${style.name}</div>
                <div class="style-cost">Requiere especializaci√≥n en arma</div>
            </div>
            <div class="style-description">${style.description}</div>
            <div class="style-levels">
                ${Object.entries(style.levels).map(([levelId, levelData]) => `
                    <div class="style-level" id="style-${styleId}-${levelId}">
                        <div class="style-level-name">${levelData.name}</div>
                        <div class="style-level-effect">${levelData.effects}</div>
                        <button class="style-level-btn" onclick="purchaseCombatStyle('${styleId}', '${levelId}')">
                            Aprender (${levelData.cost} slot${levelData.cost > 1 ? 's' : ''})
                        </button>
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('');
}

function purchaseCombatStyle(styleId, levelId) {
    const style = COMBAT_STYLES[styleId];
    const level = style.levels[levelId];
    
    const currentSlots = calculateWeaponSlots();
    const usedSlots = getTotalUsedWeaponSlots();
    
    if (usedSlots + level.cost > currentSlots) {
        showNotification('No tienes suficientes casillas de armas para este estilo');
        return;
    }
    
    if (!characterData.skills.combatStyles) {
        characterData.skills.combatStyles = {};
    }
    
    if (!characterData.skills.combatStyles[styleId]) {
        characterData.skills.combatStyles[styleId] = {};
    }
    
    characterData.skills.combatStyles[styleId][levelId] = true;
    
    // Actualizar interfaz
    const levelElement = document.getElementById(`style-${styleId}-${levelId}`);
    if (levelElement) {
        levelElement.classList.add('purchased');
        const button = levelElement.querySelector('.style-level-btn');
        if (button) {
            button.textContent = '‚úì Aprendido';
            button.classList.add('purchased');
            button.disabled = true;
        }
    }
    
    updateSkillsSummary();
    showNotification(`Estilo ${style.name} (${level.name}) aprendido`);
}

function updateSkillsSummary() {
    updateMasteredWeaponsList();
    updateNotableSkillsList();
    updateActiveStylesList();
}

function updateMasteredWeaponsList() {
    const masteredWeapons = [];
    
    for (const weaponName in characterData.skills.weapons) {
        const level = characterData.skills.weapons[weaponName];
        if (level >= 2) {
            const levelNames = ['', 'Competente', 'Especialista', 'Experto', 'Maestro', 'Gran Maestro'];
            masteredWeapons.push(`${weaponName}: ${levelNames[level] || 'Desconocido'}`);
        }
    }
    
    const container = document.getElementById('mastered-weapons-list');
    if (container) {
        if (masteredWeapons.length > 0) {
            container.innerHTML = masteredWeapons.map(weapon => 
                `<p class="summary-item">${weapon}</p>`
            ).join('');
        } else {
            container.innerHTML = '<p style="color: #b0b0b0; font-style: italic;">Ninguna todav√≠a</p>';
        }
    }
}

function updateNotableSkillsList() {
    const notableSkills = [];
    
    for (const skillName in characterData.skills.nonweapons) {
        const level = characterData.skills.nonweapons[skillName];
        if (level >= 2) {
            notableSkills.push(`${skillName}: Nivel ${level}`);
        }
    }
    
    const container = document.getElementById('notable-skills-list');
    if (container) {
        if (notableSkills.length > 0) {
            container.innerHTML = notableSkills.map(skill => 
                `<p class="summary-item">${skill}</p>`
            ).join('');
        } else {
            container.innerHTML = '<p style="color: #b0b0b0; font-style: italic;">Ninguna todav√≠a</p>';
        }
    }
}

function updateActiveStylesList() {
    const activeStyles = [];
    
    for (const styleId in characterData.skills.combatStyles || {}) {
        const style = COMBAT_STYLES[styleId];
        const purchasedLevels = characterData.skills.combatStyles[styleId];
        
        for (const levelId in purchasedLevels) {
            if (purchasedLevels[levelId]) {
                const levelData = style.levels[levelId];
                activeStyles.push(`${style.name}: ${levelData.name}`);
            }
        }
    }
    
    const container = document.getElementById('active-styles-list');
    if (container) {
        if (activeStyles.length > 0) {
            container.innerHTML = activeStyles.map(styleLevel => 
                `<p class="summary-item">${styleLevel}</p>`
            ).join('');
        } else {
            container.innerHTML = '<p style="color: #b0b0b0; font-style: italic;">Ninguno todav√≠a</p>';
        }
    }
}

function updateSpecializations() {
    // Actualizar especializations mostradas en el tab de combate
    const container = document.getElementById('active-specializations');
    if (!container) return;
    
    const specializedWeapons = [];
    for (const weaponName in characterData.skills.weapons) {
        const level = characterData.skills.weapons[weaponName];
        if (level >= 2) {
            const levelNames = ['', 'Competente', 'Especialista', 'Experto', 'Maestro', 'Gran Maestro'];
            specializedWeapons.push({
                name: weaponName,
                level: levelNames[level] || 'Desconocido',
                effects: getWeaponMasteryEffects(level)
            });
        }
    }
    
    if (specializedWeapons.length > 0) {
        container.innerHTML = specializedWeapons.map(weapon => `
            <div class="specialization-item">
                <div class="spec-weapon-name">${weapon.name}</div>
                <div class="spec-level">${weapon.level}</div>
                <div class="spec-effects">${weapon.effects}</div>
            </div>
        `).join('');
    } else {
        container.innerHTML = `
            <div class="no-specializations">
                <p style="color: #b0b0b0; font-style: italic; text-align: center;">
                    No hay especializaciones activas.<br>
                    Ve al tab de Pericias para especializar en armas.
                </p>
            </div>
        `;
    }
}

// ===========================================
// TAB CONJUROS - FUNCIONES
// ===========================================

function detectCasterAbilities() {
    const activeClasses = getActiveClasses();
    const casterInfo = document.getElementById('caster-info');
    const castingAbilities = document.getElementById('casting-abilities');
    
    let hasArcane = false;
    let hasDivine = false;
    let hasPsionic = false;
    
    // Detectar tipos de lanzadores
    activeClasses.forEach(className => {
        if (['mago', 'hechicero', 'bruja', 'art√≠fice'].includes(className)) hasArcane = true;
        if (['cl√©rigo', 'druida', 'cham√°n'].includes(className)) hasDivine = true;
        if (['psi√≥nico'].includes(className)) hasPsionic = true;
    });
    
    if (!hasArcane && !hasDivine && !hasPsionic) {
        casterInfo.innerHTML = `
            <p style="color: #b0b0b0; font-style: italic; text-align: center;">
                Este personaje no puede lanzar conjuros ni usar poderes psi√≥nicos.
            </p>
        `;
        castingAbilities.style.display = 'none';
        hideSpellSections();
        return;
    }
    
    // Mostrar capacidades detectadas
    casterInfo.innerHTML = `
        <p style="color: #4caf50; text-align: center;">
            <strong>¬°Capacidades m√°gicas detectadas!</strong><br>
            Este personaje puede lanzar conjuros.
        </p>
    `;
    
    castingAbilities.style.display = 'grid';
    
    // Configurar cada tipo de lanzamiento
    if (hasArcane) {
        setupArcaneCasting();
        document.getElementById('arcane-casting').style.display = 'block';
    }
    
    if (hasDivine) {
        setupDivineCasting();
        document.getElementById('divine-casting').style.display = 'block';
    }
    
    if (hasPsionic) {
        setupPsionicCasting();
        document.getElementById('psionic-casting').style.display = 'block';
    }
    
    showSpellSections();
}

function setupArcaneCasting() {
    const intelligence = parseInt(document.getElementById('intelligence')?.value) || 10;
    const level = getCurrentLevel();
    
    const maxLevel = Math.min(9, Math.max(0, Math.floor((intelligence - 8) / 2)));
    const currentMana = characterData.spells.mana.arcane || 0;
    const maxMana = level * (intelligence + 1);
    
    document.getElementById('max-arcane-level').textContent = maxLevel;
    document.getElementById('current-arcane-mana').textContent = `${currentMana}/${maxMana}`;
}

function setupDivineCasting() {
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    const level = getCurrentLevel();
    
    const maxLevel = Math.min(7, Math.max(0, Math.floor((wisdom - 8) / 2)));
    const currentMana = characterData.spells.mana.divine || 0;
    const maxMana = level * (wisdom + 1);
    
    document.getElementById('max-divine-level').textContent = maxLevel;
    document.getElementById('current-divine-mana').textContent = `${currentMana}/${maxMana}`;
}

function setupPsionicCasting() {
    const currentPSP = characterData.spells.psp || 0;
    const maxPSP = calculateMaxPSP();
    
    document.getElementById('current-psp').textContent = `${currentPSP}/${maxPSP}`;
    document.getElementById('known-disciplines').textContent = Math.floor(getCurrentLevel() / 3) + 1;
}

function calculateMaxPSP() {
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    const constitution = parseInt(document.getElementById('constitution')?.value) || 10;
    const intelligence = parseInt(document.getElementById('intelligence')?.value) || 10;
    const level = getCurrentLevel();
    
    const basePSP = wisdom + Math.floor(constitution / 4) + Math.floor(intelligence / 4);
    return basePSP + (level - 1) * (10 + Math.floor((wisdom - 10) / 2));
}

function hideSpellSections() {
    document.getElementById('spell-slots-section').style.display = 'none';
    document.getElementById('spellbook-section').style.display = 'none';
}

function showSpellSections() {
    document.getElementById('spell-slots-section').style.display = 'block';
    document.getElementById('spellbook-section').style.display = 'block';
    generateSpellSlots();
}

function toggleSpellSystem() {
    const selectedSystem = document.querySelector('input[name="spell-system"]:checked')?.value;
    
    if (selectedSystem === 'slots') {
        document.getElementById('slots-display').style.display = 'block';
        document.getElementById('mana-display').style.display = 'none';
    } else {
        document.getElementById('slots-display').style.display = 'none';
        document.getElementById('mana-display').style.display = 'block';
        setupManaDisplay();
    }
}

function generateSpellSlots() {
    const hasArcane = hasClassInGroup('hechicero');
    const hasDivine = hasClassInGroup('sacerdote');
    
    if (hasArcane) {
        generateArcaneSlots();
        document.getElementById('arcane-slots').style.display = 'block';
        document.getElementById('arcane-mana-pool').style.display = 'block';
    }
    
    if (hasDivine) {
        generateDivineSlots();
        document.getElementById('divine-slots').style.display = 'block';
        document.getElementById('divine-mana-pool').style.display = 'block';
    }
}

function generateArcaneSlots() {
    const level = getCurrentLevel();
    const intelligence = parseInt(document.getElementById('intelligence')?.value) || 10;
    
    // Tabla simplificada de slots por nivel de hechicero
    const slotsTable = {
        1: [1, 0, 0, 0, 0, 0, 0, 0, 0],
        2: [2, 0, 0, 0, 0, 0, 0, 0, 0],
        3: [2, 1, 0, 0, 0, 0, 0, 0, 0],
        4: [3, 2, 0, 0, 0, 0, 0, 0, 0],
        5: [4, 2, 1, 0, 0, 0, 0, 0, 0],
        6: [4, 2, 2, 0, 0, 0, 0, 0, 0],
        7: [4, 3, 2, 1, 0, 0, 0, 0, 0],
        8: [4, 3, 3, 2, 0, 0, 0, 0, 0],
        9: [4, 3, 3, 2, 1, 0, 0, 0, 0],
        10: [4, 4, 3, 2, 2, 0, 0, 0, 0]
    };
    
    const slots = slotsTable[Math.min(level, 10)] || slotsTable[1];
    const maxSpellLevel = Math.min(9, Math.max(0, Math.floor((intelligence - 8) / 2)));
    
    let html = '';
    for (let spellLevel = 1; spellLevel <= maxSpellLevel && spellLevel <= 9; spellLevel++) {
        const slotCount = slots[spellLevel - 1] || 0;
        if (slotCount > 0) {
            html += `
                <div class="spell-level-group">
                    <div class="spell-level-header">Nivel ${spellLevel}</div>
                    <div class="spell-slots-row">
                        ${Array(slotCount).fill().map((_, i) => 
                            `<div class="spell-slot available" onclick="toggleSpellSlot('arcane', ${spellLevel}, ${i})" id="arcane-${spellLevel}-${i}">${i + 1}</div>`
                        ).join('')}
                    </div>
                </div>
            `;
        }
    }
    
    document.getElementById('arcane-levels-grid').innerHTML = html;
}

function generateDivineSlots() {
    const level = getCurrentLevel();
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    
    // Tabla simplificada para sacerdotes
    const slotsTable = {
        1: [1, 0, 0, 0, 0, 0, 0],
        2: [2, 0, 0, 0, 0, 0, 0],
        3: [2, 1, 0, 0, 0, 0, 0],
        4: [3, 2, 0, 0, 0, 0, 0],
        5: [3, 3, 1, 0, 0, 0, 0],
        6: [3, 3, 2, 0, 0, 0, 0],
        7: [3, 3, 2, 1, 0, 0, 0],
        8: [3, 3, 3, 2, 0, 0, 0],
        9: [4, 4, 3, 2, 1, 0, 0],
        10: [4, 4, 3, 3, 2, 0, 0]
    };
    
    const slots = slotsTable[Math.min(level, 10)] || slotsTable[1];
    const maxSpellLevel = Math.min(7, Math.max(0, Math.floor((wisdom - 8) / 2)));
    
    let html = '';
    for (let spellLevel = 1; spellLevel <= maxSpellLevel && spellLevel <= 7; spellLevel++) {
        const slotCount = slots[spellLevel - 1] || 0;
        if (slotCount > 0) {
            html += `
                <div class="spell-level-group">
                    <div class="spell-level-header">Nivel ${spellLevel}</div>
                    <div class="spell-slots-row">
                        ${Array(slotCount).fill().map((_, i) => 
                            `<div class="spell-slot available" onclick="toggleSpellSlot('divine', ${spellLevel}, ${i})" id="divine-${spellLevel}-${i}">${i + 1}</div>`
                        ).join('')}
                    </div>
                </div>
            `;
        }
    }
    
    document.getElementById('divine-levels-grid').innerHTML = html;
}

function toggleSpellSlot(type, level, slot) {
    const slotElement = document.getElementById(`${type}-${level}-${slot}`);
    if (!slotElement) return;
    
    if (slotElement.classList.contains('available')) {
        slotElement.classList.remove('available');
        slotElement.classList.add('used');
    } else {
        slotElement.classList.remove('used');
        slotElement.classList.add('available');
    }
}

function setupManaDisplay() {
    const hasArcane = hasClassInGroup('hechicero');
    const hasDivine = hasClassInGroup('sacerdote');
    
    if (hasArcane) {
        const currentMana = characterData.spells.mana.arcane || 0;
        const maxMana = calculateMaxArcaneMana();
        updateManaBar('arcane', currentMana, maxMana);
        characterData.spells.mana.arcane = maxMana; // Reset to full
    }
    
    if (hasDivine) {
        const currentMana = characterData.spells.mana.divine || 0;
        const maxMana = calculateMaxDivineMana();
        updateManaBar('divine', currentMana, maxMana);
        characterData.spells.mana.divine = maxMana; // Reset to full
    }
}

function calculateMaxArcaneMana() {
    const intelligence = parseInt(document.getElementById('intelligence')?.value) || 10;
    const level = getCurrentLevel();
    return level * (intelligence + 1);
}

function calculateMaxDivineMana() {
    const wisdom = parseInt(document.getElementById('wisdom')?.value) || 10;
    const level = getCurrentLevel();
    return level * (wisdom + 1);
}

function adjustMana(type, amount) {
    const maxMana = type === 'arcane' ? calculateMaxArcaneMana() : calculateMaxDivineMana();
    let currentMana = characterData.spells.mana[type] || maxMana;
    
    currentMana = Math.max(0, Math.min(maxMana, currentMana + amount));
    characterData.spells.mana[type] = currentMana;
    
    updateManaBar(type, currentMana, maxMana);
    
    if (amount < 0) {
        showNotification(`${amount * -1} puntos de man√° ${type} gastados`);
    }
}

function restoreMana(type) {
    const maxMana = type === 'arcane' ? calculateMaxArcaneMana() : calculateMaxDivineMana();
    characterData.spells.mana[type] = maxMana;
    updateManaBar(type, maxMana, maxMana);
    showNotification(`Man√° ${type} completamente restaurado`);
}

function updateManaBar(type, current, max) {
    const percentage = max > 0 ? (current / max) * 100 : 0;
    
    const manaBar = document.getElementById(`${type}-mana-current`);
    const manaText = document.getElementById(`${type}-mana-text`);
    
    if (manaBar) {
        manaBar.style.width = `${percentage}%`;
        manaBar.classList.add(type);
        
        if (percentage < 25) {
            manaBar.classList.add('draining');
        } else {
            manaBar.classList.remove('draining');
        }
    }
    
    if (manaText) {
        manaText.textContent = `${current}/${max}`;
    }
}

// Base de datos de conjuros
const SPELLS_DATABASE = {
    common: [
        // Conjuros Arcanos Nivel 1
        { name: 'Misiles M√°gicos', level: 1, type: 'arcane', school: 'Evocation', description: 'Proyectiles de energ√≠a que impactan autom√°ticamente' },
        { name: 'Luz', level: 1, type: 'arcane', school: 'Alteration', description: 'Crea luz brillante en un objeto' },
        { name: 'Detectar Magia', level: 1, type: 'arcane', school: 'Divination', description: 'Revela auras m√°gicas' },
        { name: 'Armadura', level: 1, type: 'arcane', school: 'Conjuration', description: 'CA 6 + mod Destreza' },
        { name: 'Escudo', level: 1, type: 'arcane', school: 'Evocation', description: 'Protecci√≥n contra proyectiles' },
        
        // Conjuros Divinos Nivel 1
        { name: 'Curar Heridas Leves', level: 1, type: 'divine', school: 'Necromancy', description: 'Cura 1d8 puntos de da√±o' },
        { name: 'Bendecir', level: 1, type: 'divine', school: 'Conjuration', description: '+1 ataque y moral' },
        { name: 'Protecci√≥n contra el Mal', level: 1, type: 'divine', school: 'Abjuration', description: 'Barrera contra criaturas malvadas' },
        { name: 'Detectar Mal', level: 1, type: 'divine', school: 'Divination', description: 'Revela intenciones malvadas' },
        { name: 'Crear Agua', level: 1, type: 'divine', school: 'Alteration', description: 'Genera agua potable' }
    ],
    
    advanced: [
        // Conjuros de nivel superior
        { name: 'Bola de Fuego', level: 3, type: 'arcane', school: 'Evocation', description: 'Explosi√≥n de fuego 1d6/nivel' },
        { name: 'Rayo', level: 3, type: 'arcane', school: 'Evocation', description: 'Rayo el√©ctrico 1d6/nivel' },
        { name: 'Volar', level: 3, type: 'arcane', school: 'Alteration', description: 'Permite volar durante 1 turno/nivel' },
        { name: 'Invisibilidad', level: 2, type: 'arcane', school: 'Illusion', description: 'Vuelve invisible al objetivo' },
        { name: 'Curar Heridas Graves', level: 3, type: 'divine', school: 'Necromancy', description: 'Cura 3d8+3 puntos de da√±o' },
        { name: 'Disipar Magia', level: 3, type: 'divine', school: 'Abjuration', description: 'Elimina efectos m√°gicos' },
        { name: 'Palabra de Poder: Aturdir', level: 7, type: 'arcane', school: 'Conjuration', description: 'Aturde criaturas con PG bajos' }
    ],
    
    psionic: [
        // Poderes Psi√≥nicos
        { name: 'Telepat√≠a', level: 1, type: 'psionic', school: 'Telepathy', description: 'Comunicaci√≥n mental' },
        { name: 'Telequinesis', level: 2, type: 'psionic', school: 'Psychokinesis', description: 'Mover objetos con la mente' },
        { name: 'Clarividencia', level: 1, type: 'psionic', school: 'Clairsentience', description: 'Ver lugares remotos' },
        { name: 'Dominaci√≥n', level: 3, type: 'psionic', school: 'Telepathy', description: 'Control mental' },
        { name: 'Barrera Mental', level: 1, type: 'psionic', school: 'Telepathy', description: 'Protecci√≥n psi√≥nica' }
    ]
};

function loadSpellLibrary() {
    loadLibraryTab('common');
    loadLibraryTab('advanced');
    loadLibraryTab('psionic');
}

function showLibraryTab(tabName) {
    // Cambiar pesta√±as activas
    document.querySelectorAll('.library-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.getElementById(`tab-${tabName}`).classList.add('active');
    
    // Cambiar contenido activo
    document.querySelectorAll('.library-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`${tabName}-spells`).classList.add('active');
    
    loadLibraryTab(tabName);
}

function loadLibraryTab(tabName) {
    const spells = SPELLS_DATABASE[tabName] || [];
    const container = document.getElementById(`${tabName}-spells-grid`);
    
    if (!container) return;
    
    container.innerHTML = spells.map(spell => `
        <div class="library-spell-item ${spell.type}" onclick="showSpellModal('${spell.name}')">
            <div class="spell-header">
                <div class="spell-name">${spell.name}</div>
                <div class="spell-level">Niv ${spell.level}</div>
                <div class="spell-school">${spell.school}</div>
            </div>
            <div class="spell-description">${spell.description}</div>
            <button class="add-spell-btn" onclick="addSpellToGrimoire('${spell.name}'); event.stopPropagation();">
                + A√±adir
            </button>
        </div>
    `).join('');
}

function addSpellToGrimoire(spellName) {
    const spell = findSpellByName(spellName);
    if (!spell) return;
    
    // Verificar si ya lo tiene
    if (characterData.spells.known.find(s => s.name === spellName)) {
        showNotification('Ya conoces este conjuro');
        return;
    }
    
    characterData.spells.known.push(spell);
    organizeSpellsByLevel();
    showNotification(`${spellName} a√±adido al grimorio`);
}

function findSpellByName(name) {
    for (const category in SPELLS_DATABASE) {
        const spell = SPELLS_DATABASE[category].find(s => s.name === name);
        if (spell) return spell;
    }
    return null;
}

function organizeSpellsByLevel() {
    const container = document.getElementById('spells-by-level');
    if (!container) return;
    
    const spellsByLevel = {};
    
    characterData.spells.known.forEach(spell => {
        if (!spellsByLevel[spell.level]) {
            spellsByLevel[spell.level] = [];
        }
        spellsByLevel[spell.level].push(spell);
    });
    
    let html = '';
    for (let level = 0; level <= 9; level++) {
        const spells = spellsByLevel[level] || [];
        if (spells.length > 0) {
            html += `
                <div class="spell-level-section">
                    <div class="spell-level-title">
                        ${level === 0 ? 'Trucos' : `Nivel ${level}`} (${spells.length})
                    </div>
                    <div class="spells-list">
                        ${spells.map(spell => `
                            <div class="spell-item ${spell.type}" onclick="showSpellModal('${spell.name}')">
                                <div class="spell-header">
                                    <div class="spell-name">${spell.name}</div>
                                    <div class="spell-level">Niv ${spell.level}</div>
                                    <div class="spell-school">${spell.school}</div>
                                </div>
                                <div class="spell-description">${spell.description}</div>
                                <div class="spell-actions">
                                    <button class="spell-action-btn" onclick="castSpell('${spell.name}'); event.stopPropagation();" title="Lanzar">‚ö°</button>
                                    <button class="spell-action-btn" onclick="removeSpellFromGrimoire('${spell.name}'); event.stopPropagation();" title="Eliminar">‚úï</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
    }
    
    container.innerHTML = html || '<p style="text-align: center; color: #666;">No hay conjuros en el grimorio</p>';
}

function removeSpellFromGrimoire(spellName) {
    characterData.spells.known = characterData.spells.known.filter(spell => spell.name !== spellName);
    organizeSpellsByLevel();
    showNotification(`${spellName} eliminado del grimorio`);
}

function castSpell(spellName) {
    const spell = characterData.spells.known.find(s => s.name === spellName);
    if (!spell) return;
    
    const manaCost = spell.level * 2 + 1;
    const manaType = spell.type === 'arcane' ? 'arcane' : spell.type === 'divine' ? 'divine' : null;
    
    if (spell.type === 'psionic') {
        if (characterData.spells.psp < manaCost) {
            showNotification('PSP insuficiente para usar este poder');
            return;
        }
        characterData.spells.psp -= manaCost;
        showNotification(`${spellName} activado (${manaCost} PSP)`);
    } else if (manaType) {
        if (characterData.spells.mana[manaType] < manaCost) {
            showNotification(`Man√° ${manaType} insuficiente`);
            return;
        }
        adjustMana(manaType, -manaCost);
        showNotification(`${spellName} lanzado`);
    }
}

function showSpellModal(spellName) {
    const spell = findSpellByName(spellName) || characterData.spells.known.find(s => s.name === spellName);
    if (!spell) return;
    
    const modal = document.getElementById('spell-modal');
    const detail = document.getElementById('spell-detail');
    
    if (!modal || !detail) return;
    
    detail.innerHTML = `
        <h3>${spell.name}</h3>
        <div class="spell-meta">
            <strong>Nivel:</strong> ${spell.level}<br>
            <strong>Tipo:</strong> ${spell.type}<br>
            <strong>Escuela:</strong> ${spell.school}
        </div>
        <div class="spell-components">
            <strong>Componentes:</strong> V, S, M<br>
            <strong>Tiempo de lanzamiento:</strong> ${spell.level} segmentos<br>
            <strong>Alcance:</strong> ${spell.level * 10} metros<br>
            <strong>Duraci√≥n:</strong> ${spell.level} turnos
        </div>
        <p><strong>Descripci√≥n:</strong></p>
        <p>${spell.description}</p>
    `;
    
    modal.style.display = 'flex';
}

function closeSpellModal() {
    const modal = document.getElementById('spell-modal');
    if (modal) modal.style.display = 'none';
}

function filterSpells() {
    // Implementar filtros para el grimorio
    const typeFilter = document.getElementById('spell-type-filter')?.value || 'all';
    const levelFilter = document.getElementById('spell-level-filter')?.value || 'all';
    const schoolFilter = document.getElementById('spell-school-filter')?.value || 'all';
    const searchTerm = document.getElementById('spell-search')?.value.toLowerCase() || '';
    
    let filteredSpells = characterData.spells.known.filter(spell => {
        const matchesType = typeFilter === 'all' || spell.type === typeFilter;
        const matchesLevel = levelFilter === 'all' || spell.level.toString() === levelFilter;
        const matchesSchool = schoolFilter === 'all' || spell.school === schoolFilter;
        const matchesSearch = spell.name.toLowerCase().includes(searchTerm);
        
        return matchesType && matchesLevel && matchesSchool && matchesSearch;
    });
    
    // Reorganizar con spells filtrados temporalmente
    const originalSpells = [...characterData.spells.known];
    characterData.spells.known = filteredSpells;
    organizeSpellsByLevel();
    characterData.spells.known = originalSpells;
}

function filterLibrary() {
    const searchTerm = document.getElementById('library-search')?.value.toLowerCase() || '';
    const activeTab = document.querySelector('.library-tab.active')?.id.replace('tab-', '');
    
    if (!activeTab) return;
    
    const allSpells = SPELLS_DATABASE[activeTab] || [];
    const filteredSpells = allSpells.filter(spell => 
        spell.name.toLowerCase().includes(searchTerm) ||
        spell.description.toLowerCase().includes(searchTerm)
    );
    
    const container = document.getElementById(`${activeTab}-spells-grid`);
    if (!container) return;
    
    container.innerHTML = filteredSpells.map(spell => `
        <div class="library-spell-item ${spell.type}" onclick="showSpellModal('${spell.name}')">
            <div class="spell-header">
                <div class="spell-name">${spell.name}</div>
                <div class="spell-level">Niv ${spell.level}</div>
                <div class="spell-school">${spell.school}</div>
            </div>
            <div class="spell-description">${spell.description}</div>
            <button class="add-spell-btn" onclick="addSpellToGrimoire('${spell.name}'); event.stopPropagation();">
                + A√±adir
            </button>
        </div>
    `).join('');
}

function exportSpellbook() {
    const spellbook = {
        character: characterData.basicInfo.name || 'Personaje Sin Nombre',
        spells: characterData.spells.known,
        mana: characterData.spells.mana,
        psp: characterData.spells.psp,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(spellbook, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `grimorio_${spellbook.character.replace(/\s/g, '_')}.json`;
    link.click();
    URL.revokeObjectURL(url);
    
    showNotification('Grimorio exportado');
}

// ===========================================
// TAB EQUIPO - FUNCIONES
// ===========================================

// Base de datos de equipamiento
const EQUIPMENT_DATABASE = {
    helmet: [
        { name: 'Yelmo de Acero', ac: 0, weight: 5, type: 'armor', magical: false },
        { name: 'Corona Dorada', ac: 0, weight: 1, type: 'jewelry', magical: false },
        { name: 'Casco de Cuero', ac: 0, weight: 2, type: 'armor', magical: false },
        { name: 'Yelmo +1', ac: 1, weight: 5, type: 'armor', magical: true }
    ],
    
    armor: [
        { name: 'Sin Armadura', ac: 10, weight: 0, type: 'none', dexLimit: 99, speed: 12 },
        { name: 'Armadura de Cuero', ac: 8, weight: 15, type: 'light', dexLimit: 6, speed: 12 },
        { name: 'Armadura de Cuero Tachonado', ac: 7, weight: 20, type: 'light', dexLimit: 5, speed: 11 },
        { name: 'Cota de Mallas', ac: 5, weight: 40, type: 'medium', dexLimit: 2, speed: 9 },
        { name: 'Armadura de Escamas', ac: 6, weight: 45, type: 'medium', dexLimit: 1, speed: 8 },
        { name: 'Armadura de Placas', ac: 3, weight: 60, type: 'heavy', dexLimit: 0, speed: 6 },
        { name: 'Armadura de Campo', ac: 2, weight: 70, type: 'heavy', dexLimit: 0, speed: 5 },
        { name: 'Armadura de Placas +1', ac: 2, weight: 55, type: 'heavy', dexLimit: 1, speed: 7, magical: true }
    ],
    
    shield: [
        { name: 'Sin Escudo', ac: 0, weight: 0, attacks: 0, type: 'none' },
        { name: 'Escudo Peque√±o', ac: 1, weight: 3, attacks: 0, type: 'light' },
        { name: 'Escudo Mediano', ac: 1, weight: 8, attacks: -1, type: 'medium' },
        { name: 'Escudo Grande', ac: 2, weight: 15, attacks: -2, type: 'heavy' },
        { name: 'Escudo +1', ac: 2, weight: 6, attacks: 0, type: 'medium', magical: true }
    ],
    
    weapon: WEAPONS_DATABASE, // Reutilizar la base de datos de armas
    
    boots: [
        { name: 'Botas de Cuero', ac: 0, weight: 3, speed: 0, type: 'normal' },
        { name: 'Botas de Velocidad', ac: 0, weight: 2, speed: 3, type: 'magical', magical: true },
        { name: 'Botas de Sigilo', ac: 0, weight: 1, stealth: 2, type: 'magical', magical: true }
    ],
    
    ring: [
        { name: 'Anillo Simple', ac: 0, weight: 0, type: 'jewelry' },
        { name: 'Anillo de Protecci√≥n +1', ac: 1, weight: 0, type: 'magical', magical: true },
        { name: 'Anillo de Regeneraci√≥n', healing: 1, weight: 0, type: 'magical', magical: true },
        { name: 'Anillo de Invisibilidad', invisibility: true, weight: 0, type: 'magical', magical: true }
    ]
};

// Quick-equip sets por clase
const QUICK_EQUIP_SETS = {
    fighter: {
        armor: 'Cota de Mallas',
        shield: 'Escudo Mediano', 
        weapon1: 'Espada Larga',
        helmet: 'Yelmo de Acero',
        boots: 'Botas de Cuero'
    },
    
    wizard: {
        armor: 'Sin Armadura',
        weapon1: 'Daga',
        boots: 'Botas de Cuero'
    },
    
    rogue: {
        armor: 'Armadura de Cuero',
        weapon1: 'Espada Corta',
        weapon3: 'Arco Corto',
        boots: 'Botas de Cuero'
    },
    
    cleric: {
        armor: 'Cota de Mallas',
        shield: 'Escudo Mediano',
        weapon1: 'Maza',
        helmet: 'Yelmo de Acero',
        boots: 'Botas de Cuero'
    },
    
    ranger: {
        armor: 'Armadura de Cuero Tachonado',
        weapon1: 'Espada Larga',
        weapon3: 'Arco Largo',
        boots: 'Botas de Cuero'
    }
};

function quickEquipSet(setType) {
    const set = QUICK_EQUIP_SETS[setType];
    if (!set) return;
    
    let itemsEquipped = 0;
    
    Object.entries(set).forEach(([slot, itemName]) => {
        if (equipItemByName(slot, itemName)) {
            itemsEquipped++;
        }
    });
    
    updateEquipmentStats();
    showNotification(`Set ${setType} equipado (${itemsEquipped} objetos)`);
}

function clearAllEquipment() {
    const equipmentSlots = [
        'helmet', 'crown', 'neck', 'cloak', 'bracers', 'gauntlets', 
        'ring1', 'ring2', 'armor', 'shield', 'boots', 'belt',
        'weapon1', 'weapon2', 'weapon3', 'weapon4'
    ];
    
    equipmentSlots.forEach(slot => {
        characterData.equipment[slot] = null;
        updateSlotDisplay(slot);
    });
    
    updateEquipmentStats();
    showNotification('Todo el equipo ha sido retirado');
}

function equipItemByName(slot, itemName) {
    const category = getSlotCategory(slot);
    const items = EQUIPMENT_DATABASE[category];
    
    if (!items) return false;
    
    const item = items.find(i => i.name === itemName);
    if (!item) return false;
    
    characterData.equipment[slot] = item;
    updateSlotDisplay(slot);
    return true;
}

function getSlotCategory(slot) {
    const categoryMap = {
        'helmet': 'helmet', 'crown': 'helmet',
        'armor': 'armor', 'shield': 'shield',
        'weapon1': 'weapon', 'weapon2': 'weapon', 'weapon3': 'weapon', 'weapon4': 'weapon',
        'boots': 'boots', 'ring1': 'ring', 'ring2': 'ring'
    };
    
    return categoryMap[slot] || 'helmet';
}

function openItemSelector(slot) {
    const modal = document.getElementById('item-selection-modal');
    const title = document.getElementById('modal-title');
    const itemsList = document.getElementById('modal-items-list');
    
    if (!modal || !title || !itemsList) return;
    
    const category = getSlotCategory(slot);
    const items = EQUIPMENT_DATABASE[category] || [];
    
    // Configurar modal
    title.textContent = `Seleccionar para ${slot}`;
    modal.dataset.currentSlot = slot;
    
    // Llenar lista de items
    itemsList.innerHTML = items.map(item => `
        <div class="modal-item ${item.magical ? 'magical' : ''}" onclick="selectItem('${item.name}')">
            <div class="modal-item-header">
                <div class="modal-item-name">${item.name}</div>
                <div class="modal-item-type">${item.type || category}</div>
            </div>
            <div class="modal-item-stats">
                ${item.ac !== undefined ? `<span class="modal-item-stat">CA: ${item.ac}</span>` : ''}
                ${item.damage ? `<span class="modal-item-stat">Da√±o: ${item.damage}</span>` : ''}
                ${item.weight ? `<span class="modal-item-stat">Peso: ${item.weight} kg</span>` : ''}
                ${item.speed !== undefined ? `<span class="modal-item-stat">Velocidad: ${item.speed}</span>` : ''}
                ${item.magical ? `<span class="modal-item-stat magical">M√°gico</span>` : '
