<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AD&D 2e Pandunk</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e, #16213e);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #1a202c, #2d3748);
            border-bottom: 2px solid #4a5568;
            padding: 0.8rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #f7fafc;
        }

        .logo i {
            color: #f6ad55;
            font-size: 1.8rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .header-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }

        .header-btn.save { background: linear-gradient(135deg, #48bb78, #38a169); }
        .header-btn.export { background: linear-gradient(135deg, #ed8936, #dd6b20); }

        /* Main Layout */
        .main-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, #1a202c, #2d3748);
            border-right: 2px solid #4a5568;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .character-card {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f6ad55, #ed8936);
            margin: 0 auto 1rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .character-name {
            color: #f7fafc;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .character-level {
            color: #cbd5e0;
            font-size: 0.9rem;
        }

        .dropdown-section {
            margin-bottom: 1.5rem;
        }

        .dropdown-header {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            padding: 0.8rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .dropdown-header:hover {
            background: linear-gradient(135deg, #718096, #4a5568);
            transform: translateX(4px);
        }

        .dropdown-header.primary { border-left: 4px solid #f6ad55; }
        .dropdown-header.secondary { border-left: 4px solid #4299e1; }
        .dropdown-header.tertiary { border-left: 4px solid #9f7aea; }
        .dropdown-header.background { border-left: 4px solid #48bb78; }

        .dropdown-content {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            padding: 0.5rem;
            display: none;
        }

        .dropdown-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .dropdown-item {
            padding: 0.6rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 0.3rem;
            transition: all 0.3s ease;
            color: #cbd5e0;
        }

        .dropdown-item:hover {
            background: rgba(66, 153, 225, 0.2);
            color: #e2e8f0;
            transform: translateX(4px);
        }

        .dropdown-item.selected {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            font-weight: bold;
        }

        /* Main Content */
        .main-content {
            background: linear-gradient(180deg, #16213e, #1a1a2e);
            padding: 1.5rem;
            overflow-y: auto;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            color: #cbd5e0;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: fit-content;
        }

        .tab-btn:hover {
            background: rgba(66, 153, 225, 0.2);
            color: #e2e8f0;
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            box-shadow: 0 4px 8px rgba(66, 153, 225, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            color: #e2e8f0;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 0.8rem;
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 2px solid #4a5568;
            }
            
            .header {
                padding: 0.5rem 1rem;
            }
            
            .header-actions {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .tab-navigation {
                flex-wrap: wrap;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-primary { color: #4299e1; }
        .text-success { color: #48bb78; }
        .text-warning { color: #ed8936; }
        .text-danger { color: #f56565; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .hidden { display: none; }
        .visible { display: block; }

        /* Notification Animations */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-dice-d20"></i>
            <span>AD&D 2e Pandunk</span>
        </div>
        <div class="header-actions">
            <button class="header-btn save" onclick="saveCharacter()">
                <i class="fas fa-save"></i>
                Guardar
            </button>
            <button class="header-btn" onclick="rollStats()">
                <i class="fas fa-dice"></i>
                Roll Stats
            </button>
            <button class="header-btn" onclick="rollHP()">
                <i class="fas fa-heart"></i>
                Roll HP
            </button>
            <button class="header-btn export" onclick="exportCharacter()">
                <i class="fas fa-download"></i>
                Exportar
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Character Card -->
            <div class="character-card">
                <div class="character-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="character-name" id="character-display-name">Nuevo Personaje</div>
                <div class="character-level" id="character-display-info">Selecciona una clase ‚Ä¢ Nivel 1</div>
            </div>

            <!-- Class Dropdowns -->
            <div class="dropdown-section">
                <div class="dropdown-header primary" id="primary-dropdown-header" onclick="toggleDropdown('primary-dropdown')">
                    <span>üèõÔ∏è Categor√≠a Principal</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-content" id="primary-dropdown">
                    <div class="dropdown-item" onclick="selectClass('primary', 'Guerrero')">‚öîÔ∏è Guerrero</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'B√°rbaro')">ü™ì B√°rbaro</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Palad√≠n')">‚õ™ Palad√≠n</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Ranger')">üèπ Ranger</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Cl√©rigo')">üõ°Ô∏è Cl√©rigo</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Druida')">üåø Druida</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Mago')">üßô Mago</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Hechicero')">‚ú® Hechicero</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Ladr√≥n')">ü•∑ Ladr√≥n</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Bardo')">üé≠ Bardo</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Psi√≥nico')">üß† Psi√≥nico</div>
                </div>
            </div>

            <div class="dropdown-section">
                <div class="dropdown-header secondary" id="secondary-dropdown-header" onclick="toggleDropdown('secondary-dropdown')">
                    <span>‚ö° Categor√≠a Secundaria</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-content" id="secondary-dropdown">
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Ninguna')">‚ùå Ninguna</div>
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Guerrero')">‚öîÔ∏è Guerrero</div>
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Ladr√≥n')">ü•∑ Ladr√≥n</div>
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Mago')">üßô Mago</div>
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Cl√©rigo')">üõ°Ô∏è Cl√©rigo</div>
                </div>
            </div>

            <div class="dropdown-section">
                <div class="dropdown-header tertiary" id="tertiary-dropdown-header" onclick="toggleDropdown('tertiary-dropdown')">
                    <span>‚≠ê Categor√≠a Terciaria</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-content" id="tertiary-dropdown">
                    <div class="dropdown-item" onclick="selectClass('tertiary', 'Ninguna')">‚ùå Ninguna</div>
                    <div class="dropdown-item" onclick="selectClass('tertiary', 'Guerrero')">‚öîÔ∏è Guerrero</div>
                    <div class="dropdown-item" onclick="selectClass('tertiary', 'Ladr√≥n')">ü•∑ Ladr√≥n</div>
                    <div class="dropdown-item" onclick="selectClass('tertiary', 'Mago')">üßô Mago</div>
                </div>
            </div>

            <div class="dropdown-section">
                <div class="dropdown-header background" id="background-dropdown-header" onclick="toggleDropdown('background-dropdown')">
                    <span>üè∞ Trasfondos</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-content" id="background-dropdown">
                    <div class="dropdown-item" onclick="selectBackground('Soldado')">üõ°Ô∏è Soldado</div>
                    <div class="dropdown-item" onclick="selectBackground('Noble')">üëë Noble</div>
                    <div class="dropdown-item" onclick="selectBackground('Erudito')">üìö Erudito</div>
                    <div class="dropdown-item" onclick="selectBackground('Artesano')">üî® Artesano</div>
                    <div class="dropdown-item" onclick="selectBackground('Explorador')">üó∫Ô∏è Explorador</div>
                    <div class="dropdown-item" onclick="selectBackground('Mercader')">üí∞ Mercader</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Tab Navigation -->
            <nav class="tab-navigation">
                <button class="tab-btn active" onclick="showTab('basic', this)">
                    <i class="fas fa-user"></i>
                    B√°sico
                </button>
                <button class="tab-btn" onclick="showTab('abilities', this)">
                    <i class="fas fa-fist-raised"></i>
                    Habilidades
                </button>
                <button class="tab-btn" onclick="showTab('categories', this)">
                    <i class="fas fa-scroll"></i>
                    Categor√≠as
                </button>
                <button class="tab-btn" onclick="showTab('combat', this)">
                    <i class="fas fa-sword"></i>
                    Combate
                </button>
                <button class="tab-btn" onclick="showTab('skills', this)">
                    <i class="fas fa-tools"></i>
                    Pericias
                </button>
                <button class="tab-btn" onclick="showTab('spells', this)">
                    <i class="fas fa-magic"></i>
                    Conjuros
                </button>
                <button class="tab-btn" onclick="showTab('companions', this)">
                    <i class="fas fa-paw"></i>
                    Compa√±eros
                </button>
                <button class="tab-btn" onclick="showTab('equipment', this)">
                    <i class="fas fa-backpack"></i>
                    Equipo
                </button>
            </nav>

            <!-- AQU√ç VAN LOS 8 TABS - Placeholder por ahora -->
            <div id="basic-tab" class="tab-content active">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-user text-primary"></i>
                    Tab B√°sico - PLACEHOLDER
                </h2>
                <p style="text-align: center; color: #cbd5e0;">
                    Copia aqu√≠ el contenido del Tab B√°sico de tu archivo original
                </p>
            </div>

            <div id="abilities-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-fist-raised text-primary"></i>
                    Tab Habilidades - PLACEHOLDER
                </h2>
                <p style="text-align: center; color: #cbd5e0;">
                    Copia aqu√≠ el contenido del Tab Habilidades de tu archivo original
                </p>
            </div>

            <div id="categories-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-scroll text-primary"></i>
                    Tab Categor√≠as - PLACEHOLDER
                </h2>
                <p style="text-align: center; color: #cbd5e0;">
                    Copia aqu√≠ el contenido del Tab Categor√≠as de tu archivo original
                </p>
            </div>

            <div id="combat-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-sword text-primary"></i>
                    Tab Combate - PLACEHOLDER
                </h2>
                <p style="text-align: center; color: #cbd5e0;">
                    Copia aqu√≠ el contenido del Tab Combate de tu archivo original
                </p>
            </div>

            <div id="skills-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-tools text-primary"></i>
                    Tab Pericias - PLACEHOLDER
                </h2>
                <p style="text-align: center; color: #cbd5e0;">
                    Copia aqu√≠ el contenido del Tab Pericias de tu archivo original
                </p>
            </div>

            <div id="spells-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-magic text-primary"></i>
                    Tab Conjuros - PLACEHOLDER
                </h2>
                <p style="text-align: center; color: #cbd5e0;">
                    Copia aqu√≠ el contenido del Tab Conjuros de tu archivo original
                </p>
            </div>

            <div id="companions-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-paw text-primary"></i>
                    Tab Compa√±eros - PLACEHOLDER
                </h2>
                <p style="text-align: center; color: #cbd5e0;">
                    Copia aqu√≠ el contenido del Tab Compa√±eros de tu archivo original
                </p>
            </div>

            <div id="equipment-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-backpack text-primary"></i>
                    Tab Equipo - PLACEHOLDER
                </h2>
                <p style="text-align: center; color: #cbd5e0;">
                    Copia aqu√≠ el contenido del Tab Equipo de tu archivo original
                </p>
            </div>
        </main>
    </div>

    <script>
        // Global character data
        let characterData = {
            basic: {
                name: '',
                player: '',
                race: '',
                alignment: 'Neutral Aut√©ntico',
                height: 175,
                religion: '',
                experience: 0,
                level: 1
            },
            abilities: {
                strength: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                dexterity: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                constitution: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                intelligence: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                wisdom: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                charisma: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' }
            },
            classes: {
                primary: '',
                secondary: '',
                tertiary: ''
            },
            background: '',
            savingThrows: {
                death: { base: 14, mod1: 0, mod2: 0, total: 14 },
                wands: { base: 16, mod1: 0, mod2: 0, total: 16 },
                petrification: { base: 12, mod1: 0, mod2: 0, total: 12 },
                breath: { base: 17, mod1: 0, mod2: 0, total: 17 },
                spells: { base: 17, mod1: 0, mod2: 0, total: 17 }
            }
        };

        // Racial modifiers (AD&D 2e)
        const racialModifiers = {
            'Humano': { str: 0, dex: 0, con: 0, int: 0, wis: 0, cha: 0 },
            'Elfo': { str: 0, dex: 1, con: -1, int: 0, wis: 0, cha: 0 },
            'Enano': { str: 0, dex: 0, con: 1, int: 0, wis: 0, cha: -1 },
            'Halfling': { str: -1, dex: 1, con: 0, int: 0, wis: 0, cha: 0 },
            'Gnomo': { str: 0, dex: 0, con: 1, int: 0, wis: 0, cha: 0 },
            'Semielfos': { str: 0, dex: 0, con: 0, int: 0, wis: 0, cha: 0 },
            'Semiorcos': { str: 1, dex: 0, con: 1, int: -1, wis: 0, cha: -2 }
        };

        // Background modifiers
        const backgroundModifiers = {
            'Soldado': { str: 1, dex: 0, con: 1, int: 0, wis: 0, cha: 0 },
            'Noble': { str: 0, dex: 0, con: 0, int: 1, wis: 0, cha: 1 },
            'Erudito': { str: 0, dex: 0, con: 0, int: 2, wis: 0, cha: 0 },
            'Artesano': { str: 1, dex: 1, con: 0, int: 0, wis: 0, cha: 0 },
            'Explorador': { str: 0, dex: 1, con: 0, int: 0, wis: 1, cha: 0 },
            'Mercader': { str: 0, dex: 0, con: 0, int: 1, wis: 0, cha: 1 }
        };

        // XP tables (simplified - Warrior progression)
        const xpTable = [
            0, 2000, 4000, 8000, 16000, 32000, 64000, 125000, 250000, 500000,
            750000, 1000000, 1250000, 1500000, 1750000, 2000000, 2250000, 2500000, 2750000, 3000000
        ];

        // Tab Management
        function showTab(tabName, button) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            button.classList.add('active');

            // Dispatch tab change event
            document.dispatchEvent(new CustomEvent('tabChanged', { detail: tabName }));
        }

        // Dropdown Management
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const header = dropdown.previousElementSibling;
            const icon = header.querySelector('i');
            
            dropdown.classList.toggle('show');
            
            if (dropdown.classList.contains('show')) {
                icon.style.transform = 'rotate(180deg)';
            } else {
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Class Selection
        function selectClass(category, className) {
            characterData.classes[category] = className;
            
            // Update header text
            const header = document.getElementById(category + '-dropdown-header');
            const span = header.querySelector('span');
            
            if (className === 'Ninguna') {
                span.textContent = getDropdownText(category);
            } else {
                span.textContent = getClassIcon(className) + ' ' + className;
            }
            
            // Update selected item
            const dropdown = document.getElementById(category + '-dropdown');
            dropdown.querySelectorAll('.dropdown-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
            
            // Close dropdown
            dropdown.classList.remove('show');
            
            // Update character display
            updateCharacterDisplay();
            updateManaCards();
            updateAllBasicStats();
        }

        function getDropdownText(category) {
            const texts = {
                'primary': 'üèõÔ∏è Categor√≠a Principal',
                'secondary': '‚ö° Categor√≠a Secundaria', 
                'tertiary': '‚≠ê Categor√≠a Terciaria'
            };
            return texts[category] || '';
        }

        function getClassIcon(className) {
            const icons = {
                'Guerrero': '‚öîÔ∏è',
                'B√°rbaro': 'ü™ì',
                'Palad√≠n': '‚õ™',
                'Ranger': 'üèπ',
                'Cl√©rigo': 'üõ°Ô∏è',
                'Druida': 'üåø',
                'Mago': 'üßô',
                'Hechicero': '‚ú®',
                'Ladr√≥n': 'ü•∑',
                'Bardo': 'üé≠',
                'Psi√≥nico': 'üß†'
            };
            return icons[className] || '‚öîÔ∏è';
        }

        // Background Selection
        function selectBackground(background) {
            characterData.background = background;
            
            const header = document.getElementById('background-dropdown-header');
            const span = header.querySelector('span');
            span.textContent = getBackgroundIcon(background) + ' ' + background;
            
            const dropdown = document.getElementById('background-dropdown');
            dropdown.querySelectorAll('.dropdown-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
            dropdown.classList.remove('show');
            
            updateAllAbilityScores();
        }

        function getBackgroundIcon(background) {
            const icons = {
                'Soldado': 'üõ°Ô∏è',
                'Noble': 'üëë',
                'Erudito': 'üìö',
                'Artesano': 'üî®',
                'Explorador': 'üó∫Ô∏è',
                'Mercader': 'üí∞'
            };
            return icons[background] || 'üè∞';
        }

        // Character Display Updates
        function updateCharacterDisplay() {
            const name = document.getElementById('character-name').value || 'Nuevo Personaje';
            const level = document.getElementById('level').value || 1;
            const primaryClass = characterData.classes.primary || 'Sin clase';
            
            document.getElementById('character-display-name').textContent = name;
            document.getElementById('character-display-info').textContent = `${primaryClass} ‚Ä¢ Nivel ${level}`;
            
            characterData.basic.name = name;
            characterData.basic.level = parseInt(level);
        }

        // Utility Functions - Placeholders que ser√°n completados
        function updateAllBasicStats() {
            console.log('updateAllBasicStats called');
        }

        function updateManaCards() {
            console.log('updateManaCards called');
        }

        function updateAllAbilityScores() {
            console.log('updateAllAbilityScores called');
        }

        function saveCharacter() {
            console.log('saveCharacter called');
            showNotification('Personaje guardado (placeholder)', 'success');
        }

        function rollStats() {
            console.log('rollStats called');
            showNotification('Stats generados (placeholder)', 'success');
        }

        function rollHP() {
            console.log('rollHP called');
            showNotification('HP generado (placeholder)', 'success');
        }

        function exportCharacter() {
            console.log('exportCharacter called');
            showNotification('Personaje exportado (placeholder)', 'success');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 90px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1001;
                max-width: 300px;
                animation: slideIn 0.3s ease;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            `;
            
            const colors = {
                'success': 'linear-gradient(135deg, #48bb78, #38a169)',
                'error': 'linear-gradient(135deg, #f56565, #e53e3e)',
                'info': 'linear-gradient(135deg, #4299e1, #3182ce)',
                'warning': 'linear-gradient(135deg, #ed8936, #dd6b20)'
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('AD&D 2e Character Sheet initialized - Base Structure');
        });
    </script>
</body>
</html>

            <!-- Abilities Tab -->
            <div id="abilities-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-fist-raised text-primary"></i>
                    Habilidades
                </h2>
                
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 1px solid #4a5568; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <!-- Strength -->
                        <div style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 10px; padding: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: #e53e3e; color: white; width: 50px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem;" id="strength-method">üé≤</div>
                                <div style="flex: 1;">
                                    <h4 style="color: #e2e8f0; margin: 0;">üí™ Fuerza</h4>
                                    <p style="color: #cbd5e0; margin: 0; font-size: 0.8rem;">Poder f√≠sico y musculatura</p>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; text-align: center; font-size: 0.8rem; color: #cbd5e0;">
                                <div>Base</div>
                                <div>Racial</div>
                                <div>Trasfondo</div>
                                <div>Tama√±o</div>
                                <div>Final</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; align-items: center;">
                                <input type="number" id="strength-base" min="3" max="25" value="10" onchange="updateAbilityScore('strength')" style="padding: 0.5rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="strength-racial" style="text-align: center; color: #4299e1; font-weight: bold;">0</span>
                                <span id="strength-background" style="text-align: center; color: #48bb78; font-weight: bold;">0</span>
                                <span id="strength-size" style="text-align: center; color: #ed8936; font-weight: bold;">0</span>
                                <span id="strength-final" style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.2rem;">10</span>
                            </div>
                            
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                <button onclick="rollAbility('strength', '4d6')" style="flex: 1; background: #4299e1; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">4d6</button>
                                <button onclick="rollAbility('strength', '3d6')" style="flex: 1; background: #48bb78; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">3d6</button>
                                <button onclick="setAbilityAverage('strength')" style="flex: 1; background: #ed8936; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">Prom</button>
                            </div>
                            
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 0.8rem; border-radius: 6px;">
                                <div style="color: #cbd5e0; font-size: 0.8rem; margin-bottom: 0.5rem;">Beneficios:</div>
                                <div id="strength-benefits" style="color: #a0aec0; font-size: 0.8rem;">Ataque: +0, Da√±o: +0, Puertas: 1-2, Cargar: 40 lb</div>
                            </div>
                        </div>

                        <!-- Dexterity -->
                        <div style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 10px; padding: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: #48bb78; color: white; width: 50px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem;" id="dexterity-method">üé≤</div>
                                <div style="flex: 1;">
                                    <h4 style="color: #e2e8f0; margin: 0;">üèÉ Destreza</h4>
                                    <p style="color: #cbd5e0; margin: 0; font-size: 0.8rem;">Agilidad y coordinaci√≥n</p>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; text-align: center; font-size: 0.8rem; color: #cbd5e0;">
                                <div>Base</div>
                                <div>Racial</div>
                                <div>Trasfondo</div>
                                <div>Tama√±o</div>
                                <div>Final</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; align-items: center;">
                                <input type="number" id="dexterity-base" min="3" max="25" value="10" onchange="updateAbilityScore('dexterity')" style="padding: 0.5rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="dexterity-racial" style="text-align: center; color: #4299e1; font-weight: bold;">0</span>
                                <span id="dexterity-background" style="text-align: center; color: #48bb78; font-weight: bold;">0</span>
                                <span id="dexterity-size" style="text-align: center; color: #ed8936; font-weight: bold;">0</span>
                                <span id="dexterity-final" style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.2rem;">10</span>
                            </div>
                            
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                <button onclick="rollAbility('dexterity', '4d6')" style="flex: 1; background: #4299e1; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">4d6</button>
                                <button onclick="rollAbility('dexterity', '3d6')" style="flex: 1; background: #48bb78; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">3d6</button>
                                <button onclick="setAbilityAverage('dexterity')" style="flex: 1; background: #ed8936; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">Prom</button>
                            </div>
                            
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 0.8rem; border-radius: 6px;">
                                <div style="color: #cbd5e0; font-size: 0.8rem; margin-bottom: 0.5rem;">Beneficios:</div>
                                <div id="dexterity-benefits" style="color: #a0aec0; font-size: 0.8rem;">CA: +0, Ataque a distancia: +0, Iniciativa: +0</div>
                            </div>
                        </div>

                        <!-- Constitution -->
                        <div style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 10px; padding: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: #f56565; color: white; width: 50px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem;" id="constitution-method">üé≤</div>
                                <div style="flex: 1;">
                                    <h4 style="color: #e2e8f0; margin: 0;">üõ°Ô∏è Constituci√≥n</h4>
                                    <p style="color: #cbd5e0; margin: 0; font-size: 0.8rem;">Resistencia y salud</p>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; text-align: center; font-size: 0.8rem; color: #cbd5e0;">
                                <div>Base</div>
                                <div>Racial</div>
                                <div>Trasfondo</div>
                                <div>Tama√±o</div>
                                <div>Final</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; align-items: center;">
                                <input type="number" id="constitution-base" min="3" max="25" value="10" onchange="updateAbilityScore('constitution')" style="padding: 0.5rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="constitution-racial" style="text-align: center; color: #4299e1; font-weight: bold;">0</span>
                                <span id="constitution-background" style="text-align: center; color: #48bb78; font-weight: bold;">0</span>
                                <span id="constitution-size" style="text-align: center; color: #ed8936; font-weight: bold;">0</span>
                                <span id="constitution-final" style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.2rem;">10</span>
                            </div>
                            
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                <button onclick="rollAbility('constitution', '4d6')" style="flex: 1; background: #4299e1; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">4d6</button>
                                <button onclick="rollAbility('constitution', '3d6')" style="flex: 1; background: #48bb78; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">3d6</button>
                                <button onclick="setAbilityAverage('constitution')" style="flex: 1; background: #ed8936; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">Prom</button>
                            </div>
                            
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 0.8rem; border-radius: 6px;">
                                <div style="color: #cbd5e0; font-size: 0.8rem; margin-bottom: 0.5rem;">Beneficios:</div>
                                <div id="constitution-benefits" style="color: #a0aec0; font-size: 0.8rem;">HP: +0, Resistencia: Normal, Resurrecci√≥n: 70%</div>
                            </div>
                        </div>

                        <!-- Intelligence -->
                        <div style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 10px; padding: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: #805ad5; color: white; width: 50px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem;" id="intelligence-method">üé≤</div>
                                <div style="flex: 1;">
                                    <h4 style="color: #e2e8f0; margin: 0;">üß† Inteligencia</h4>
                                    <p style="color: #cbd5e0; margin: 0; font-size: 0.8rem;">Razonamiento y memoria</p>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; text-align: center; font-size: 0.8rem; color: #cbd5e0;">
                                <div>Base</div>
                                <div>Racial</div>
                                <div>Trasfondo</div>
                                <div>Tama√±o</div>
                                <div>Final</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; align-items: center;">
                                <input type="number" id="intelligence-base" min="3" max="25" value="10" onchange="updateAbilityScore('intelligence')" style="padding: 0.5rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="intelligence-racial" style="text-align: center; color: #4299e1; font-weight: bold;">0</span>
                                <span id="intelligence-background" style="text-align: center; color: #48bb78; font-weight: bold;">0</span>
                                <span id="intelligence-size" style="text-align: center; color: #ed8936; font-weight: bold;">0</span>
                                <span id="intelligence-final" style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.2rem;">10</span>
                            </div>
                            
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                <button onclick="rollAbility('intelligence', '4d6')" style="flex: 1; background: #4299e1; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">4d6</button>
                                <button onclick="rollAbility('intelligence', '3d6')" style="flex: 1; background: #48bb78; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">3d6</button>
                                <button onclick="setAbilityAverage('intelligence')" style="flex: 1; background: #ed8936; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">Prom</button>
                            </div>
                            
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 0.8rem; border-radius: 6px;">
                                <div style="color: #cbd5e0; font-size: 0.8rem; margin-bottom: 0.5rem;">Beneficios:</div>
                                <div id="intelligence-benefits" style="color: #a0aec0; font-size: 0.8rem;">Idiomas: 2, Conjuros: Normal, Inmunidad: Ninguna</div>
                            </div>
                        </div>

                        <!-- Wisdom -->
                        <div style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 10px; padding: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: #38b2ac; color: white; width: 50px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem;" id="wisdom-method">üé≤</div>
                                <div style="flex: 1;">
                                    <h4 style="color: #e2e8f0; margin: 0;">üïØÔ∏è Sabidur√≠a</h4>
                                    <p style="color: #cbd5e0; margin: 0; font-size: 0.8rem;">Intuici√≥n y percepci√≥n</p>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; text-align: center; font-size: 0.8rem; color: #cbd5e0;">
                                <div>Base</div>
                                <div>Racial</div>
                                <div>Trasfondo</div>
                                <div>Tama√±o</div>
                                <div>Final</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; align-items: center;">
                                <input type="number" id="wisdom-base" min="3" max="25" value="10" onchange="updateAbilityScore('wisdom')" style="padding: 0.5rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="wisdom-racial" style="text-align: center; color: #4299e1; font-weight: bold;">0</span>
                                <span id="wisdom-background" style="text-align: center; color: #48bb78; font-weight: bold;">0</span>
                                <span id="wisdom-size" style="text-align: center; color: #ed8936; font-weight: bold;">0</span>
                                <span id="wisdom-final" style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.2rem;">10</span>
                            </div>
                            
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                <button onclick="rollAbility('wisdom', '4d6')" style="flex: 1; background: #4299e1; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">4d6</button>
                                <button onclick="rollAbility('wisdom', '3d6')" style="flex: 1; background: #48bb78; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">3d6</button>
                                <button onclick="setAbilityAverage('wisdom')" style="flex: 1; background: #ed8936; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">Prom</button>
                            </div>
                            
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 0.8rem; border-radius: 6px;">
                                <div style="color: #cbd5e0; font-size: 0.8rem; margin-bottom: 0.5rem;">Beneficios:</div>
                                <div id="wisdom-benefits" style="color: #a0aec0; font-size: 0.8rem;">Conjuros divinos: 0, Salvaciones mentales: +0</div>
                            </div>
                        </div>

                        <!-- Charisma -->
                        <div style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 10px; padding: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: #ed64a6; color: white; width: 50px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem;" id="charisma-method">üé≤</div>
                                <div style="flex: 1;">
                                    <h4 style="color: #e2e8f0; margin: 0;">üåü Carisma</h4>
                                    <p style="color: #cbd5e0; margin: 0; font-size: 0.8rem;">Personalidad y liderazgo</p>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; text-align: center; font-size: 0.8rem; color: #cbd5e0;">
                                <div>Base</div>
                                <div>Racial</div>
                                <div>Trasfondo</div>
                                <div>Tama√±o</div>
                                <div>Final</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 1rem; align-items: center;">
                                <input type="number" id="charisma-base" min="3" max="25" value="10" onchange="updateAbilityScore('charisma')" style="padding: 0.5rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="charisma-racial" style="text-align: center; color: #4299e1; font-weight: bold;">0</span>
                                <span id="charisma-background" style="text-align: center; color: #48bb78; font-weight: bold;">0</span>
                                <span id="charisma-size" style="text-align: center; color: #ed8936; font-weight: bold;">0</span>
                                <span id="charisma-final" style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.2rem;">10</span>
                            </div>
                            
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                <button onclick="rollAbility('charisma', '4d6')" style="flex: 1; background: #4299e1; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">4d6</button>
                                <button onclick="rollAbility('charisma', '3d6')" style="flex: 1; background: #48bb78; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">3d6</button>
                                <button onclick="setAbilityAverage('charisma')" style="flex: 1; background: #ed8936; border: none; padding: 0.5rem; border-radius: 4px; color: white; cursor: pointer; font-size: 0.8rem;">Prom</button>
                            </div>
                            
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 0.8rem; border-radius: 6px;">
                                <div style="color: #cbd5e0; font-size: 0.8rem; margin-bottom: 0.5rem;">Beneficios:</div>
                                <div id="charisma-benefits" style="color: #a0aec0; font-size: 0.8rem;">Lealtad: 0, Reacci√≥n: 0, Seguidores: 0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generate All Button -->
                <div style="text-align: center; margin-top: 2rem;">
                    <button onclick="generateAllAbilities()" style="background: linear-gradient(135deg, #48bb78, #38a169); border: none; padding: 1rem 2rem; border-radius: 12px; color: white; cursor: pointer; font-weight: bold; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);">
                        <i class="fas fa-dice"></i>
                        Generar Todas las Habilidades (4d6)
                    </button>
                </div>
            </div>

            <!-- Categories Tab -->
<div id="categories-tab" class="tab-content">
    <h2 class="mb-3 text-center">
        <i class="fas fa-scroll text-primary"></i>
        Categor√≠as de Personaje
    </h2>
    
    <div id="selected-classes-info">
        <p style="text-align: center; color: #cbd5e0; font-size: 1.1rem; margin-bottom: 2rem;">
            Selecciona clases en el sidebar para ver informaci√≥n detallada
        </p>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
        <div id="primary-class-card" style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: none;">
            <h3 style="color: #4299e1; margin-bottom: 1rem;">
                <i class="fas fa-crown"></i>
                Categor√≠a Principal
            </h3>
            <div id="primary-class-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>

        <div id="secondary-class-card" style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: none;">
            <h3 style="color: #ed8936; margin-bottom: 1rem;">
                <i class="fas fa-star"></i>
                Categor√≠a Secundaria
            </h3>
            <div id="secondary-class-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>

        <div id="tertiary-class-card" style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: none;">
            <h3 style="color: #48bb78; margin-bottom: 1rem;">
                <i class="fas fa-plus"></i>
                Categor√≠a Terciaria
            </h3>
            <div id="tertiary-class-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>

        <div id="background-card" style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: none;">
            <h3 style="color: #48bb78; margin-bottom: 1rem;">
                <i class="fas fa-home"></i>
                Trasfondo
            </h3>
            <div id="background-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>
// Class information database
const classInfo = {
    'Guerrero': {
        icon: '‚öîÔ∏è',
        hitDie: 'd10',
        thac0: 20,
        description: 'Maestro del combate cuerpo a cuerpo y las armas.',
        abilities: 'Especializaci√≥n en armas, ataques m√∫ltiples, liderazgo',
        restrictions: 'Limitado en el uso de magia'
    },
    'B√°rbaro': {
        icon: 'ü™ì',
        hitDie: 'd12',
        thac0: 20,
        description: 'Guerrero salvaje con furia berserker.',
        abilities: 'Furia berserker, resistencia al miedo, supervivencia',
        restrictions: 'No puede usar armadura pesada, limitaciones m√°gicas'
    },
    'Palad√≠n': {
        icon: '‚õ™',
        hitDie: 'd10',
        thac0: 20,
        description: 'Guerrero santo con poderes divinos.',
        abilities: 'Detectar mal, curar enfermedades, inmunidad al miedo',
        restrictions: 'Debe ser Legal Bueno, c√≥digo de honor estricto'
    },
    'Ranger': {
        icon: 'üèπ',
        hitDie: 'd10',
        thac0: 20,
        description: 'Explorador y guardabosques experto.',
        abilities: 'Rastreo, combate con dos armas, conjuros divinos',
        restrictions: 'Limitado en ciudades, debe ser bueno'
    },
    'Cl√©rigo': {
        icon: 'üõ°Ô∏è',
        hitDie: 'd8',
        thac0: 20,
        description: 'Servidor divino con poderes curativos.',
        abilities: 'Conjuros divinos, expulsar muertos vivientes',
        restrictions: 'Limitaciones de armas seg√∫n deidad'
    },
    'Druida': {
        icon: 'üåø',
        hitDie: 'd8',
        thac0: 20,
        description: 'Guardi√°n de la naturaleza con magia natural.',
        abilities: 'Conjuros dru√≠dicos, forma salvaje, inmunidad a encantamientos',
        restrictions: 'Solo armadura de cuero, armas naturales'
    },
    'Mago': {
        icon: 'üßô',
        hitDie: 'd4',
        thac0: 21,
        description: 'Maestro de las artes arcanas y la magia.',
        abilities: 'Conjuros arcanos, investigaci√≥n m√°gica, crear objetos',
        restrictions: 'Limitado en armas y armaduras'
    },
    'Hechicero': {
        icon: '‚ú®',
        hitDie: 'd4',
        thac0: 21,
        description: 'Conjurador innato con magia espont√°nea.',
        abilities: 'Magia espont√°nea, metamagia, poder m√°gico natural',
        restrictions: 'Conjuros limitados pero flexibles'
    },
    'Ladr√≥n': {
        icon: 'ü•∑',
        hitDie: 'd6',
        thac0: 21,
        description: 'Experto en sigilo, trampas y subterfugio.',
        abilities: 'Habilidades de ladr√≥n, ataque sorpresa, leer lenguajes',
        restrictions: 'Limitado en armadura y algunas armas'
    },
    'Bardo': {
        icon: 'üé≠',
        hitDie: 'd6',
        thac0: 20,
        description: 'Aventurero vers√°til con habilidades m√°gicas y sociales.',
        abilities: 'Conjuros arcanos, habilidades de ladr√≥n, m√∫sica inspiradora',
        restrictions: 'Progresi√≥n m√°gica limitada'
    },
    'Psi√≥nico': {
        icon: 'üß†',
        hitDie: 'd6',
        thac0: 20,
        description: 'Usuario de poderes mentales y ps√≠quicos.',
        abilities: 'Poderes psi√≥nicos, telepat√≠a, telequinesis',
        restrictions: 'Reglas especiales de PSP'
    }
};

// Background information database
const backgroundInfo = {
    'Soldado': {
        icon: 'üõ°Ô∏è',
        description: 'Veterano de guerra con experiencia militar.',
        skills: 'Uso de armas, t√°cticas, liderazgo',
        bonus: '+1 Fuerza, +1 Constituci√≥n',
        equipment: 'Armas militares, armadura, insignias'
    },
    'Noble': {
        icon: 'üëë',
        description: 'Miembro de la aristocracia con educaci√≥n refinada.',
        skills: 'Etiqueta, historia, idiomas',
        bonus: '+1 Inteligencia, +1 Carisma',
        equipment: 'Ropas finas, joyas, documentos'
    },
    'Erudito': {
        icon: 'üìö',
        description: 'Acad√©mico con vasto conocimiento libresco.',
        skills: 'Investigaci√≥n, idiomas, conocimiento arcano',
        bonus: '+2 Inteligencia',
        equipment: 'Libros, instrumentos de escritura, pergaminos'
    },
    'Artesano': {
        icon: 'üî®',
        description: 'Trabajador especializado en un oficio.',
        skills: 'Artesan√≠a, comercio, reparaciones',
        bonus: '+1 Fuerza, +1 Destreza',
        equipment: 'Herramientas, materiales, productos'
    },
    'Explorador': {
        icon: 'üó∫Ô∏è',
        description: 'Viajero experimentado conocedor del mundo.',
        skills: 'Supervivencia, navegaci√≥n, idiomas',
        bonus: '+1 Destreza, +1 Sabidur√≠a',
        equipment: 'Equipo de viaje, mapas, br√∫jula'
    },
    'Mercader': {
        icon: 'üí∞',
        description: 'Comerciante con ojo para los negocios.',
        skills: 'Tasaci√≥n, negociaci√≥n, contactos',
        bonus: '+1 Inteligencia, +1 Carisma',
        equipment: 'Dinero, productos, contratos'
    }
};

// Categories Tab Functions
function updateCategoriesDisplay() {
    const primary = characterData.classes.primary;
    const secondary = characterData.classes.secondary;
    const tertiary = characterData.classes.tertiary;
    const background = characterData.background;

    // Update primary class card
    if (primary && primary !== 'Ninguna') {
        const card = document.getElementById('primary-class-card');
        const content = document.getElementById('primary-class-content');
        const info = classInfo[primary];
        
        if (info) {
            content.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="font-size: 3rem;">${info.icon}</div>
                    <div>
                        <h4 style="color: #f7fafc; margin: 0;">${primary}</h4>
                        <div style="color: #a0aec0; font-size: 0.9rem;">Dado de Golpe: ${info.hitDie}</div>
                    </div>
                </div>
                <p style="color: #e2e8f0; margin-bottom: 1rem;">${info.description}</p>
                <div style="margin-bottom: 1rem;">
                    <strong style="color: #4299e1;">Habilidades:</strong>
                    <div style="color: #cbd5e0; font-size: 0.9rem;">${info.abilities}</div>
                </div>
                <div>
                    <strong style="color: #f56565;">Restricciones:</strong>
                    <div style="color: #cbd5e0; font-size: 0.9rem;">${info.restrictions}</div>
                </div>
            `;
            card.style.display = 'block';
        }
    } else {
        document.getElementById('primary-class-card').style.display = 'none';
    }

    // Update secondary class card
    if (secondary && secondary !== 'Ninguna') {
        const card = document.getElementById('secondary-class-card');
        const content = document.getElementById('secondary-class-content');
        const info = classInfo[secondary];
        
        if (info) {
            content.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="font-size: 2.5rem;">${info.icon}</div>
                    <div>
                        <h5 style="color: #f7fafc; margin: 0;">${secondary}</h5>
                        <div style="color: #a0aec0; font-size: 0.8rem;">Clase Secundaria</div>
                    </div>
                </div>
                <p style="color: #e2e8f0; font-size: 0.9rem;">${info.description}</p>
            `;
            card.style.display = 'block';
        }
    } else {
        document.getElementById('secondary-class-card').style.display = 'none';
    }

    // Update tertiary class card
    if (tertiary && tertiary !== 'Ninguna') {
        const card = document.getElementById('tertiary-class-card');
        const content = document.getElementById('tertiary-class-content');
        const info = classInfo[tertiary];
        
        if (info) {
            content.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="font-size: 2rem;">${info.icon}</div>
                    <div>
                        <h6 style="color: #f7fafc; margin: 0;">${tertiary}</h6>
                        <div style="color: #a0aec0; font-size: 0.8rem;">Clase Terciaria</div>
                    </div>
                </div>
                <p style="color: #e2e8f0; font-size: 0.8rem;">${info.description}</p>
            `;
            card.style.display = 'block';
        }
    } else {
        document.getElementById('tertiary-class-card').style.display = 'none';
    }

    // Update background card
    if (background) {
        const card = document.getElementById('background-card');
        const content = document.getElementById('background-content');
        const info = backgroundInfo[background];
        
        if (info) {
            content.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="font-size: 2.5rem;">${info.icon}</div>
                    <div>
                        <h5 style="color: #f7fafc; margin: 0;">${background}</h5>
                        <div style="color: #48bb78; font-size: 0.8rem;">${info.bonus}</div>
                    </div>
                </div>
                <p style="color: #e2e8f0; font-size: 0.9rem; margin-bottom: 1rem;">${info.description}</p>
                <div>
                    <strong style="color: #ed8936;">Habilidades:</strong>
                    <div style="color: #cbd5e0; font-size: 0.9rem;">${info.skills}</div>
                </div>
            `;
            card.style.display = 'block';
        }
    } else {
        document.getElementById('background-card').style.display = 'none';
    }

    // Hide info message if any class is selected
    if (primary || secondary || tertiary || background) {
        document.getElementById('selected-classes-info').style.display = 'none';
    } else {
        document.getElementById('selected-classes-info').style.display = 'block';
    }
}        
</div>
            <!-- Combat Tab -->
            <div id="combat-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-sword text-primary"></i>
                    Sistema de Combate
                </h2>

                <div class="grid-2">
                    <!-- Combat Stats -->
                    <div class="card">
                        <h3 class="mb-2 text-center">
                            <i class="fas fa-shield-alt text-warning"></i>
                            Estad√≠sticas de Combate
                        </h3>
                        
                        <div class="grid-2 mb-3">
                            <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="color: #cbd5e0; font-size: 0.9rem;">Clase de Armadura</div>
                                <div style="color: #f7fafc; font-size: 2rem; font-weight: bold;" id="armor-class">10</div>
                                <div style="color: #a0aec0; font-size: 0.8rem;" id="ac-breakdown">(Base 10)</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="color: #cbd5e0; font-size: 0.9rem;">GACO</div>
                                <div style="color: #f7fafc; font-size: 2rem; font-weight: bold;" id="thac0">20</div>
                                <div style="color: #a0aec0; font-size: 0.8rem;">Para Impactar CA 0</div>
                            </div>
                        </div>

                        <div class="grid-2">
                            <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="color: #cbd5e0; font-size: 0.9rem;">Iniciativa</div>
                                <div style="color: #48bb78; font-size: 1.5rem; font-weight: bold;" id="initiative-bonus">+0</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="color: #cbd5e0; font-size: 0.9rem;">Ataques/Ronda</div>
                                <div style="color: #ed8936; font-size: 1.5rem; font-weight: bold;" id="attacks-per-round">1</div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <h3 class="mb-2 text-center">
                            <i class="fas fa-bolt text-danger"></i>
                            Acciones R√°pidas
                        </h3>
                        
                        <div class="grid-2">
                            <button class="btn btn-success" onclick="rollInitiative()">
                                <i class="fas fa-dice"></i>
                                Iniciativa
                            </button>
                            <button class="btn btn-danger" onclick="rollToHit()">
                                <i class="fas fa-crosshairs"></i>
                                Ataque
                            </button>
                            <button class="btn btn-warning" onclick="rollDamage()">
                                <i class="fas fa-hammer"></i>
                                Da√±o
                            </button>
                            <button class="btn btn-purple" onclick="rollSavingThrow()">
                                <i class="fas fa-shield-alt"></i>
                                Salvaci√≥n
                            </button>
                        </div>

                        <div class="mt-3" style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                            <h4 style="color: #e2e8f0; margin-bottom: 1rem; font-size: 1rem;">Registro de Combate:</h4>
                            <div id="combat-log" style="color: #a0aec0; font-size: 0.9rem;">
                                Listo para combate...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weapons Section -->
                <div class="card mt-3">
                    <h3 class="mb-3 text-center">
                        <i class="fas fa-sword text-danger"></i>
                        Arsenal de Armas
                    </h3>
                    
                    <div class="grid-3" id="weapon-slots">
                        <div class="weapon-slot" onclick="addWeapon(0)">
                            <i class="fas fa-plus" style="font-size: 2rem; margin-bottom: 1rem; color: #4a5568;"></i>
                            <div>Arma Principal</div>
                            <div style="font-size: 0.8rem; color: #718096;">Click para a√±adir</div>
                        </div>
                        <div class="weapon-slot" onclick="addWeapon(1)">
                            <i class="fas fa-plus" style="font-size: 2rem; margin-bottom: 1rem; color: #4a5568;"></i>
                            <div>Arma Secundaria</div>
                            <div style="font-size: 0.8rem; color: #718096;">Click para a√±adir</div>
                        </div>
                        <div class="weapon-slot" onclick="addWeapon(2)">
                            <i class="fas fa-plus" style="font-size: 2rem; margin-bottom: 1rem; color: #4a5568;"></i>
                            <div>Arma a Distancia</div>
                            <div style="font-size: 0.8rem; color: #718096;">Click para a√±adir</div>
                        </div>
                    </div>
                </div>

                <!-- Armor Section -->
                <div class="card mt-3">
                    <h3 class="mb-3 text-center">
                        <i class="fas fa-shield-alt text-primary"></i>
                        Protecci√≥n y Armadura
                    </h3>
                    
                    <div class="grid-2">
                        <div style="background: rgba(0,0,0,0.2); padding: 1.5rem; border-radius: 8px;">
                            <h4 style="color: #e2e8f0; margin-bottom: 1rem;">Escudo</h4>
                            <select id="shield" onchange="updateArmorClass()" style="width: 100%; padding: 0.5rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0;">
                                <option value="none">Sin Escudo</option>
                                <option value="small">Escudo Peque√±o (+1 CA)</option>
                                <option value="medium">Escudo Mediano (+2 CA)</option>
                                <option value="large">Escudo Grande (+3 CA)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Skills Tab -->
            <div id="skills-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-tools text-primary"></i>
                    Pericias y Habilidades
                </h2>

                <!-- Skill Slots Management -->
                <div class="card">
                    <h3 class="mb-2 text-center">
                        <i class="fas fa-cog text-warning"></i>
                        Gesti√≥n de Slots de Pericia
                    </h3>
                    
                    <div class="grid-3">
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">Slots Disponibles</div>
                            <div style="color: #48bb78; font-size: 2rem; font-weight: bold;" id="available-skill-slots">4</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">Por Clase/INT</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">Slots Usados</div>
                            <div style="color: #ed8936; font-size: 2rem; font-weight: bold;" id="used-skill-slots">0</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">En Pericias</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">Slots Restantes</div>
                            <div style="color: #4299e1; font-size: 2rem; font-weight: bold;" id="remaining-skill-slots">4</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">Sin Asignar</div>
                        </div>
                    </div>
                </div>

                <!-- General Skills -->
                <div class="skill-category">
                    <h3 class="mb-3">
                        <i class="fas fa-hammer text-warning"></i>
                        Pericias Generales
                    </h3>
                    
                    <div class="grid-2">
                        <div class="skill-item">
                            <div>
                                <strong>Agricultura</strong> (Inteligencia)
                                <div style="font-size: 0.8rem; color: #a0aec0;">Cultivos y ganader√≠a</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="agriculture-slots" min="0" max="4" value="0" onchange="updateSkillPercentage('agriculture')" style="width: 50px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="agriculture-percentage" style="color: #48bb78; font-weight: bold; min-width: 40px;">0%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollSkill('agriculture')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Manejo de Animales</strong> (Sabidur√≠a)
                                <div style="font-size: 0.8rem; color: #a0aec0;">Entrenar y controlar animales</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="animal-handling-slots" min="0" max="4" value="0" onchange="updateSkillPercentage('animal-handling')" style="width: 50px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="animal-handling-percentage" style="color: #48bb78; font-weight: bold; min-width: 40px;">0%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollSkill('animal-handling')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Tasaci√≥n</strong> (Inteligencia)
                                <div style="font-size: 0.8rem; color: #a0aec0;">Evaluar objetos y tesoros</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="appraisal-slots" min="0" max="4" value="0" onchange="updateSkillPercentage('appraisal')" style="width: 50px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="appraisal-percentage" style="color: #48bb78; font-weight: bold; min-width: 40px;">0%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollSkill('appraisal')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Armero</strong> (Inteligencia)
                                <div style="font-size: 0.8rem; color: #a0aec0;">Crear y reparar armas</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="weaponsmithing-slots" min="0" max="4" value="0" onchange="updateSkillPercentage('weaponsmithing')" style="width: 50px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="weaponsmithing-percentage" style="color: #48bb78; font-weight: bold; min-width: 40px;">0%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollSkill('weaponsmithing')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Carpinter√≠a</strong> (Fuerza)
                                <div style="font-size: 0.8rem; color: #a0aec0;">Trabajar la madera</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="carpentry-slots" min="0" max="4" value="0" onchange="updateSkillPercentage('carpentry')" style="width: 50px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="carpentry-percentage" style="color: #48bb78; font-weight: bold; min-width: 40px;">0%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollSkill('carpentry')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Cocina</strong> (Inteligencia)
                                <div style="font-size: 0.8rem; color: #a0aec0;">Preparar comida y detectar venenos</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" id="cooking-slots" min="0" max="4" value="0" onchange="updateSkillPercentage('cooking')" style="width: 50px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                                <span id="cooking-percentage" style="color: #48bb78; font-weight: bold; min-width: 40px;">0%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollSkill('cooking')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Thief Skills -->
                <div class="skill-category" id="thief-skills-section" style="display: none;">
                    <h3 class="mb-3">
                        <i class="fas fa-mask text-danger"></i>
                        Habilidades de Ladr√≥n
                    </h3>
                    
                    <div class="grid-2">
                        <div class="skill-item">
                            <div>
                                <strong>Escalar Superficies</strong>
                                <div style="font-size: 0.8rem; color: #a0aec0;">Base: 60% + 5% por nivel</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span id="climb-walls-percentage" style="color: #48bb78; font-weight: bold; min-width: 60px;">60%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollThiefSkill('climb-walls')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Detectar/Desarmar Trampas</strong>
                                <div style="font-size: 0.8rem; color: #a0aec0;">Base: 25% + 5% por nivel</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span id="find-traps-percentage" style="color: #48bb78; font-weight: bold; min-width: 60px;">25%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollThiefSkill('find-traps')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Abrir Cerraduras</strong>
                                <div style="font-size: 0.8rem; color: #a0aec0;">Base: 25% + 5% por nivel</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span id="open-locks-percentage" style="color: #48bb78; font-weight: bold; min-width: 60px;">25%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollThiefSkill('open-locks')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Moverse en Silencio</strong>
                                <div style="font-size: 0.8rem; color: #a0aec0;">Base: 15% + 5% por nivel</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span id="move-silently-percentage" style="color: #48bb78; font-weight: bold; min-width: 60px;">15%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollThiefSkill('move-silently')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Ocultarse en las Sombras</strong>
                                <div style="font-size: 0.8rem; color: #a0aec0;">Base: 10% + 5% por nivel</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span id="hide-in-shadows-percentage" style="color: #48bb78; font-weight: bold; min-width: 60px;">10%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollThiefSkill('hide-in-shadows')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item">
                            <div>
                                <strong>Hurtar Carteras</strong>
                                <div style="font-size: 0.8rem; color: #a0aec0;">Base: 15% + 5% por nivel</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span id="pick-pockets-percentage" style="color: #48bb78; font-weight: bold; min-width: 60px;">15%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollThiefSkill('pick-pockets')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>

                        <div class="skill-item" id="read-languages-skill" style="display: none;">
                            <div>
                                <strong>Leer Lenguajes</strong>
                                <div style="font-size: 0.8rem; color: #a0aec0;">Disponible desde nivel 4</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span id="read-languages-percentage" style="color: #48bb78; font-weight: bold; min-width: 60px;">0%</span>
                                <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="rollThiefSkill('read-languages')">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weapon Proficiencies -->
                <div class="skill-category">
                    <h3 class="mb-3">
                        <i class="fas fa-sword text-danger"></i>
                        Competencias con Armas
                    </h3>
                    
                    <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Slots de Competencia:</strong>
                                <span id="weapon-proficiency-slots" style="color: #48bb78; font-weight: bold;">4</span>
                                disponibles
                            </div>
                            <button class="btn btn-success" onclick="showWeaponProficiencyModal()">
                                <i class="fas fa-plus"></i>
                                A√±adir Competencia
                            </button>
                        </div>
                    </div>

                    <div id="weapon-proficiencies-list">
                        <p style="text-align: center; color: #a0aec0; font-style: italic;">
                            No hay competencias con armas seleccionadas
                        </p>
                    </div>
                </div>

                <!-- Skill Roll Log -->
                <div class="card mt-3">
                    <h3 class="mb-2">
                        <i class="fas fa-scroll text-primary"></i>
                        Registro de Tiradas de Pericia
                    </h3>
                    <div id="skill-log" style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; max-height: 200px; overflow-y: auto; color: #a0aec0; font-size: 0.9rem;">
                        Listo para tiradas de pericia...
                    </div>
                </div>
            </div>

<!-- Spells Tab -->
            <div id="spells-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-magic text-primary"></i>
                    Sistema de Conjuros
                </h2>

                <div id="spell-caster-check">
                    <p style="text-align: center; color: #cbd5e0; font-size: 1.1rem; margin-top: 3rem;">
                        <i class="fas fa-info-circle"></i>
                        Selecciona una clase conjuradora para ver el sistema de conjuros
                    </p>
                    <p style="text-align: center; color: #a0aec0;">
                        Clases conjuradoras: Mago, Hechicero, Cl√©rigo, Druida, Bardo, Palad√≠n, Ranger
                    </p>
                </div>

                <div id="spell-system" class="hidden">
                    <!-- Spell Slots Management -->
                    <div class="card">
                        <h3 class="mb-3 text-center">
                            <i class="fas fa-gem text-purple"></i>
                            Slots de Conjuros
                        </h3>
                        
                        <div class="grid-4" id="spell-slots-grid">
                            <!-- Spell slots will be populated by JavaScript -->
                        </div>

                        <div class="text-center mt-3">
                            <button class="btn btn-success" onclick="applySpellProgression()">
                                <i class="fas fa-level-up-alt"></i>
                                Aplicar Progresi√≥n Autom√°tica
                            </button>
                            <button class="btn btn-primary" onclick="restoreAllSpellSlots()">
                                <i class="fas fa-bed"></i>
                                Descanso Completo
                            </button>
                        </div>
                    </div>

                    <!-- Spell Progression Table -->
                    <div class="card">
                        <h3 class="mb-3 text-center">
                            <i class="fas fa-chart-line text-warning"></i>
                            Tabla de Progresi√≥n
                        </h3>
                        
                        <div style="overflow-x: auto;">
                            <table id="spell-progression-table" style="width: 100%; border-collapse: collapse; color: #e2e8f0;">
                                <!-- Table will be populated by JavaScript -->
                            </table>
                        </div>
                    </div>

                    <!-- Spellbook/Grimoire -->
                    <div class="card">
                        <h3 class="mb-3 text-center">
                            <i class="fas fa-book-open text-purple"></i>
                            Grimorio / Lista de Conjuros
                        </h3>
                        
                        <div style="margin-bottom: 1rem;">
                            <input type="text" id="spell-search" placeholder="Buscar conjuros..." style="width: 100%; padding: 0.8rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 8px; color: #e2e8f0;">
                        </div>

                        <div class="grid-2">
                            <div>
                                <h4 style="color: #e2e8f0; margin-bottom: 1rem;">Conjuros Conocidos</h4>
                                <div id="known-spells-list" style="max-height: 400px; overflow-y: auto;">
                                    <!-- Known spells will be populated by JavaScript -->
                                </div>
                            </div>
                            <div>
                                <h4 style="color: #e2e8f0; margin-bottom: 1rem;">Conjuros Preparados</h4>
                                <div id="prepared-spells-list" style="max-height: 400px; overflow-y: auto;">
                                    <!-- Prepared spells will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Spell Casting Log -->
                    <div class="card">
                        <h3 class="mb-2">
                            <i class="fas fa-scroll text-primary"></i>
                            Registro de Lanzamiento
                        </h3>
                        <div id="spell-log" style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; max-height: 200px; overflow-y: auto; color: #a0aec0; font-size: 0.9rem;">
                            Listo para lanzar conjuros...
                        </div>
                    </div>
                </div>
            </div>f0; margin-bottom: 1rem;">Armadura Corporal</h4>
                            <select id="body-armor" onchange="updateArmorClass()" style="width: 100%; padding: 0.5rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0;">
                                <option value="none">Sin Armadura (CA 10)</option>
                                <option value="leather">Cuero (CA 8)</option>
                                <option value="studded">Cuero Tachonado (CA 7)</option>
                                <option value="chain">Cota de Mallas (CA 5)</option>
                                <option value="splint">Armadura de Bandas (CA 4)</option>
                                <option value="plate">Armadura de Placas (CA 3)</option>
                            </select>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.2); padding: 1.5rem; border-radius: 8px;">
                            <h4 style="color: #e2e8
                <div class="character-name" id="character-display-name">Nuevo Personaje</div>
                <div class="character-level" id="character-display-info">Selecciona una clase ‚Ä¢ Nivel 1</div>
            </div>

<!-- Equipment Tab -->
            <div id="equipment-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-backpack text-primary"></i>
                    Inventario y Equipo
                </h2>

                <!-- Inventory Management -->
                <div class="card">
                    <h3 class="mb-3 text-center">
                        <i class="fas fa-weight-hanging text-warning"></i>
                        Gesti√≥n de Inventario
                    </h3>
                    
                    <div class="grid-4">
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">Peso Total</div>
                            <div style="color: #f56565; font-size: 1.5rem; font-weight: bold;" id="total-weight">0</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">libras</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">Capacidad</div>
                            <div style="color: #48bb78; font-size: 1.5rem; font-weight: bold;" id="carry-capacity">40</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">libras m√°x</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">Items Totales</div>
                            <div style="color: #4299e1; font-size: 1.5rem; font-weight: bold;" id="total-items">0</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">objetos</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">Valor Total</div>
                            <div style="color: #ed8936; font-size: 1.5rem; font-weight: bold;" id="total-value">0</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">po</div>
                        </div>
                    </div>

                    <div class="text-center mt-3">
                        <button class="btn btn-success" onclick="showAddItemModal()">
                            <i class="fas fa-plus"></i>
                            A√±adir Item
                        </button>
                        <button class="btn btn-primary" onclick="showQuickEquipModal()">
                            <i class="fas fa-bolt"></i>
                            Equipo R√°pido
                        </button>
                        <button class="btn btn-warning" onclick="sortInventory()">
                            <i class="fas fa-sort"></i>
                            Ordenar
                        </button>
                        <button class="btn" onclick="exportInventory()">
                            <i class="fas fa-download"></i>
                            Exportar
                        </button>
                    </div>

                    <!-- Carry Capacity Bar -->
                    <div class="mt-3">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="color: #cbd5e0; font-size: 0.9rem;">Capacidad de Carga</span>
                            <span style="color: #e2e8f0; font-size: 0.9rem;" id="weight-status">Normal</span>
                        </div>
                        <div style="width: 100%; height: 12px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; overflow: hidden;">
                            <div id="weight-progress-bar" style="height: 100%; background: linear-gradient(90deg, #48bb78, #ed8936); width: 0%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                </div>

                <!-- Money Section -->
                <div class="card">
                    <h3 class="mb-3 text-center">
                        <i class="fas fa-coins text-warning"></i>
                        Monedas y Tesoro
                    </h3>
                    
                    <div class="grid-4">
                        <div style="text-align: center; padding: 1rem; background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 8px;">
                            <div style="color: #ffd700; font-weight: bold; margin-bottom: 0.5rem;">Oro (po)</div>
                            <input type="number" id="gold-coins" min="0" value="0" onchange="updateMoney()" style="width: 80px; padding: 0.5rem; background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 4px; color: #ffd700; text-align: center; font-weight: bold;">
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(192, 192, 192, 0.1); border: 1px solid rgba(192, 192, 192, 0.2); border-radius: 8px;">
                            <div style="color: #c0c0c0; font-weight: bold; margin-bottom: 0.5rem;">Plata (pp)</div>
                            <input type="number" id="silver-coins" min="0" value="0" onchange="updateMoney()" style="width: 80px; padding: 0.5rem; background: rgba(192, 192, 192, 0.1); border: 1px solid rgba(192, 192, 192, 0.3); border-radius: 4px; color: #c0c0c0; text-align: center; font-weight: bold;">
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(205, 127, 50, 0.1); border: 1px solid rgba(205, 127, 50, 0.2); border-radius: 8px;">
                            <div style="color: #cd7f32; font-weight: bold; margin-bottom: 0.5rem;">Cobre (pc)</div>
                            <input type="number" id="copper-coins" min="0" value="0" onchange="updateMoney()" style="width: 80px; padding: 0.5rem; background: rgba(205, 127, 50, 0.1); border: 1px solid rgba(205, 127, 50, 0.3); border-radius: 4px; color: #cd7f32; text-align: center; font-weight: bold;">
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(230, 230, 250, 0.1); border: 1px solid rgba(230, 230, 250, 0.2); border-radius: 8px;">
                            <div style="color: #e6e6fa; font-weight: bold; margin-bottom: 0.5rem;">Platino (pz)</div>
                            <input type="number" id="platinum-coins" min="0" value="0" onchange="updateMoney()" style="width: 80px; padding: 0.5rem; background: rgba(230, 230, 250, 0.1); border: 1px solid rgba(230, 230, 250, 0.3); border-radius: 4px; color: #e6e6fa; text-align: center; font-weight: bold;">
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: rgba(255, 215, 0, 0.1); border-radius: 8px;">
                        <strong style="color: #ffd700;">Total en Oro Equivalente: </strong>
                        <span id="total-gold-equivalent" style="color: #ffd700; font-size: 1.2rem; font-weight: bold;">0 po</span>
                    </div>
                </div>

                <!-- Equipment Categories -->
                <div class="grid-2">
                    <div class="card">
                        <h3 class="mb-3">
                            <i class="fas fa-sword text-danger"></i>
                            Armas <span id="weapons-count" style="color: #a0aec0; font-size: 0.9rem;">(0)</span>
                        </h3>
                        <div id="weapons-list" style="max-height: 300px; overflow-y: auto;">
                            <p style="text-align: center; color: #a0aec0; font-style: italic;">No hay armas en el inventario</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="mb-3">
                            <i class="fas fa-shield-alt text-primary"></i>
                            Armaduras <span id="armor-count" style="color: #a0aec0; font-size: 0.9rem;">(0)</span>
                        </h3>
                        <div id="armor-list" style="max-height: 300px; overflow-y: auto;">
                            <p style="text-align: center; color: #a0aec0; font-style: italic;">No hay armaduras en el inventario</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="mb-3">
                            <i class="fas fa-tools text-warning"></i>
                            Equipo General <span id="equipment-count" style="color: #a0aec0; font-size: 0.9rem;">(0)</span>
                        </h3>
                        <div id="equipment-list" style="max-height: 300px; overflow-y: auto;">
                            <p style="text-align: center; color: #a0aec0; font-style: italic;">No hay equipo en el inventario</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="mb-3">
                            <i class="fas fa-magic text-purple"></i>
                            Objetos M√°gicos <span id="magic-items-count" style="color: #a0aec0; font-size: 0.9rem;">(0)</span>
                        </h3>
                        <div id="magic-items-list" style="max-height: 300px; overflow-y: auto;">
                            <p style="text-align: center; color: #a0aec0; font-style: italic;">No hay objetos m√°gicos en el inventario</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>


<!-- Companions Tab -->
            <div id="companions-tab" class="tab-content">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-paw text-primary"></i>
                    Compa√±eros y Aliados
                </h2>

                <!-- Companions Management -->
                <div class="card">
                    <h3 class="mb-3 text-center">
                        <i class="fas fa-users text-success"></i>
                        Gesti√≥n de Compa√±eros
                    </h3>
                    
                    <div class="grid-3">
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">Compa√±eros Activos</div>
                            <div style="color: #48bb78; font-size: 2rem; font-weight: bold;" id="active-companions">0</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">En el Grupo</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">HP Total</div>
                            <div style="color: #f56565; font-size: 2rem; font-weight: bold;" id="companions-total-hp">0</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">Puntos de Golpe</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="color: #cbd5e0; font-size: 0.9rem;">Nivel Promedio</div>
                            <div style="color: #4299e1; font-size: 2rem; font-weight: bold;" id="companions-avg-level">0</div>
                            <div style="color: #a0aec0; font-size: 0.8rem;">Del Grupo</div>
                        </div>
                    </div>

                    <div class="text-center mt-3">
                        <button class="btn btn-success" onclick="showAddCompanionModal()">
                            <i class="fas fa-plus"></i>
                            A√±adir Compa√±ero
                        </button>
                        <button class="btn btn-primary" onclick="restoreAllCompanions()">
                            <i class="fas fa-heart"></i>
                            Curar Todos
                        </button>
                        <button class="btn btn-warning" onclick="companionGroupRest()">
                            <i class="fas fa-bed"></i>
                            Descanso Grupal
                        </button>
                    </div>
                </div>

                <!-- Companions List -->
                <div id="companions-list">
                    <div style="text-align: center; color: #a0aec0; font-style: italic; margin: 2rem 0;">
                        No hay compa√±eros en el grupo
                    </div>
                </div>

                <!-- Companion Categories -->
                <div class="grid-3">
                    <div class="card">
                        <h4 class="mb-2 text-center">
                            <i class="fas fa-dog text-success"></i>
                            Compa√±eros Animales
                        </h4>
                        <div style="font-size: 0.9rem; color: #a0aec0; text-align: center;">
                            <div>‚Ä¢ Lobo (Guardi√°n)</div>
                            <div>‚Ä¢ Oso Pardo (Tanque)</div>
                            <div>‚Ä¢ Halc√≥n (Explorador)</div>
                            <div>‚Ä¢ Caballo (Montura)</div>
                        </div>
                    </div>

                    <div class="card">
                        <h4 class="mb-2 text-center">
                            <i class="fas fa-user-friends text-warning"></i>
                            Compa√±eros Humanoides
                        </h4>
                        <div style="font-size: 0.9rem; color: #a0aec0; text-align: center;">
                            <div>‚Ä¢ Escudero</div>
                            <div>‚Ä¢ Mercenario</div>
                            <div>‚Ä¢ Explorador</div>
                            <div>‚Ä¢ Guardia</div>
                        </div>
                    </div>

                    <div class="card">
                        <h4 class="mb-2 text-center">
                            <i class="fas fa-magic text-purple"></i>
                            Compa√±eros M√°gicos
                        </h4>
                        <div style="font-size: 0.9rem; color: #a0aec0; text-align: center;">
                            <div>‚Ä¢ Pseudodrag√≥n</div>
                            <div>‚Ä¢ Familiar</div>
                            <div>‚Ä¢ Sprite</div>
                            <div>‚Ä¢ Elemental Menor</div>
                        </div>
                    </div>
                </div>
            </div>


--- LUIS RONDON
}

        // Ability Score Management
        function rollAbility(ability, diceType) {
            let total = 0;
            
            if (diceType === '4d6') {
                // Roll 4d6, drop lowest
                let rolls = [];
                for (let i = 0; i < 4; i++) {
                    rolls.push(Math.floor(Math.random() * 6) + 1);
                }
                rolls.sort((a, b) => b - a);
                total = rolls[0] + rolls[1] + rolls[2];
                characterData.abilities[ability].method = 'rolled4d6';
                document.getElementById(ability + '-method').textContent = 'üé≤';
            } else if (diceType === '3d6') {
                // Roll 3d6
                for (let i = 0; i < 3; i++) {
                    total += Math.floor(Math.random() * 6) + 1;
                }
                characterData.abilities[ability].method = 'rolled3d6';
                document.getElementById(ability + '-method').textContent = 'üé≤';
            }
            
            document.getElementById(ability + '-base').value = total;
            updateAbilityScore(ability);
        }

        function setAbilityAverage(ability) {
            document.getElementById(ability + '-base').value = 11;
            characterData.abilities[ability].method = 'average';
            document.getElementById(ability + '-method').textContent = 'üìä';
            updateAbilityScore(ability);
        }

        function updateAbilityScore(ability) {
            const base = parseInt(document.getElementById(ability + '-base').value) || 10;
            const race = document.getElementById('race').value || '';
            const background = characterData.background || '';
            const height = parseInt(document.getElementById('height').value) || 175;
            
            // Calculate modifiers
            const racial = racialModifiers[race] ? racialModifiers[race][ability.substring(0, 3)] || 0 : 0;
            const backgroundMod = backgroundModifiers[background] ? backgroundModifiers[background][ability.substring(0, 3)] || 0 : 0;
            const sizeMod = getSizeModifier(ability, height);
            
            const final = base + racial + backgroundMod + sizeMod;
            
            // Update display
            document.getElementById(ability + '-racial').textContent = racial >= 0 ? '+' + racial : racial;
            document.getElementById(ability + '-background').textContent = backgroundMod >= 0 ? '+' + backgroundMod : backgroundMod;
            document.getElementById(ability + '-size').textContent = sizeMod >= 0 ? '+' + sizeMod : sizeMod;
            document.getElementById(ability + '-final').textContent = final;
            
            // Update benefits
            updateAbilityBenefits(ability, final);
            
            // Store in character data
            characterData.abilities[ability] = {
                base: base,
                racial: racial,
                background: backgroundMod,
                size: sizeMod,
                final: final,
                method: characterData.abilities[ability].method
            };
            
            // Trigger stats changed event
            document.dispatchEvent(new CustomEvent('statsChanged'));
        }

        function getSizeModifier(ability, height) {
            // Size modifiers for abilities (simplified)
            if (height < 120) { // Small
                if (ability === 'strength') return -1;
                if (ability === 'dexterity') return +1;
            } else if (height > 200) { // Large
                if (ability === 'strength') return +2;
                if (ability === 'dexterity') return -1;
            }
            return 0;
        }

        function updateAbilityBenefits(ability, score) {
            let benefits = '';
            
            switch (ability) {
                case 'strength':
                    const hitBonus = Math.floor((score - 15) / 2);
                    const damageBonus = Math.floor((score - 15) / 2);
                    const carryCapacity = getCarryingCapacity(score);
                    benefits = `Ataque: ${hitBonus >= 0 ? '+' : ''}${hitBonus}, Da√±o: ${damageBonus >= 0 ? '+' : ''}${damageBonus}, Puertas: ${Math.min(score - 3, 19)}/20, Cargar: ${carryCapacity} lb`;
                    break;
                    
                case 'dexterity':
                    const acBonus = Math.floor((score - 15) / 2);
                    const rangedBonus = Math.floor((score - 15) / 2);
                    const initBonus = Math.floor((score - 15) / 2);
                    benefits = `CA: ${acBonus >= 0 ? '+' : ''}${acBonus}, Ataque a distancia: ${rangedBonus >= 0 ? '+' : ''}${rangedBonus}, Iniciativa: ${initBonus >= 0 ? '+' : ''}${initBonus}`;
                    break;
                    
                case 'constitution':
                    const hpBonus = Math.floor((score - 15) / 2);
                    const resurrection = Math.min(70 + (score - 10) * 2, 99);
                    benefits = `HP: ${hpBonus >= 0 ? '+' : ''}${hpBonus}, Resistencia: ${score >= 16 ? 'Alta' : 'Normal'}, Resurrecci√≥n: ${resurrection}%`;
                    break;
                    
                case 'intelligence':
                    const languages = Math.max(2, 2 + Math.floor((score - 10) / 2));
                    const spellImmunity = score >= 19 ? 'Nivel 1-2' : score >= 18 ? 'Nivel 1' : 'Ninguna';
                    benefits = `Idiomas: ${languages}, Conjuros: ${score >= 9 ? 'Normal' : 'Limitado'}, Inmunidad: ${spellImmunity}`;
                    break;
                    
                case 'wisdom':
                    const bonusSpells = Math.max(0, Math.floor((score - 13) / 2));
                    const mentalSave = Math.floor((score - 15) / 2);
                    benefits = `Conjuros divinos: ${bonusSpells}, Salvaciones mentales: ${mentalSave >= 0 ? '+' : ''}${mentalSave}`;
                    break;
                    
                case 'charisma':
                    const loyalty = Math.floor((score - 10) / 2);
                    const reaction = Math.floor((score - 10) / 2);
                    const followers = Math.max(0, Math.floor((score - 12) / 2));
                    benefits = `Lealtad: ${loyalty}, Reacci√≥n: ${reaction >= 0 ? '+' : ''}${reaction}, Seguidores: ${followers}`;
                    break;
            }
            
            document.getElementById(ability + '-benefits').textContent = benefits;
        }

        function getCarryingCapacity(strength) {
            const capacityTable = {
                3: 5, 4: 10, 5: 10, 6: 20, 7: 20, 8: 35, 9: 35, 10: 40,
                11: 40, 12: 45, 13: 45, 14: 55, 15: 55, 16: 70, 17: 85,
                18: 110, 19: 185, 20: 335, 21: 485, 22: 635, 23: 785, 24: 935, 25: 1235
            };
            return capacityTable[Math.min(strength, 25)] || 40;
        }

        function generateAllAbilities() {
            const abilities = ['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma'];
            abilities.forEach(ability => {
                rollAbility(ability, '4d6');
            });
        }

        function updateAllAbilityScores() {
            const abilities = ['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma'];
            abilities.forEach(ability => {
                updateAbilityScore(ability);
            });
        }

        // Saving Throws
        function updateSavingThrows() {
            const saves = ['death', 'wands', 'petrification', 'breath', 'spells'];
            
            saves.forEach(save => {
                const base = parseInt(document.getElementById('save-' + save + '-base').textContent) || 0;
                const mod1 = parseInt(document.getElementById('save-' + save + '-mod1').value) || 0;
                const mod2 = parseInt(document.getElementById('save-' + save + '-mod2').value) || 0;
                const total = base + mod1 + mod2;
                
                document.getElementById('save-' + save + '-total').textContent = total;
                
                characterData.savingThrows[save] = {
                    base: base,
                    mod1: mod1,
                    mod2: mod2,
                    total: total
                };
            });
        }

        function updateAllBasicStats() {
            updateSavingThrows();
            updateAllAbilityScores();
            updateXPProgress();
        }

        // Skills Tab Functions
        function updateSkillsDisplay() {
            const primaryClass = characterData.classes.primary;
            const level = parseInt(document.getElementById('level').value) || 1;
            
            // Show/hide thief skills
            const thiefSkillsSection = document.getElementById('thief-skills-section');
            if (primaryClass === 'Ladr√≥n' || primaryClass === 'Bardo') {
                thiefSkillsSection.style.display = 'block';
                updateThiefSkills(level);
            } else {
                thiefSkillsSection.style.display = 'none';
            }
            
            // Update skill slots
            updateSkillSlots();
        }

        function updateThiefSkills(level) {
            const thiefSkills = {
                'climb-walls': 60,
                'find-traps': 25,
                'open-locks': 25,
                'move-silently': 15,
                'hide-in-shadows': 10,
                'pick-pockets': 15,
                'read-languages': 0
            };
            
            Object.keys(thiefSkills).forEach(skill => {
                let percentage = thiefSkills[skill] + (level - 1) * 5;
                
                // Special case for read languages
                if (skill === 'read-languages') {
                    if (level >= 4) {
                        percentage = (level - 4) * 5 + 20;
                        document.getElementById('read-languages-skill').style.display = 'flex';
                    } else {
                        document.getElementById('read-languages-skill').style.display = 'none';
                        return;
                    }
                }
                
                percentage = Math.min(95, percentage);
                document.getElementById(skill + '-percentage').textContent = percentage + '%';
            });
        }

        function updateSkillSlots() {
            const primaryClass = characterData.classes.primary;
            const intelligence = characterData.abilities.intelligence.final;
            
            // Base slots by class
            let baseSlots = 2;
            switch (primaryClass) {
                case 'Bardo': baseSlots = 6; break;
                case 'Ladr√≥n': baseSlots = 4; break;
                case 'Ranger': baseSlots = 3; break;
                case 'Mago': case 'Hechicero': baseSlots = 1; break;
                case 'Cl√©rigo': case 'Druida': baseSlots = 2; break;
                case 'Guerrero': case 'Palad√≠n': baseSlots = 3; break;
                default: baseSlots = 2; break;
            }
            
            // Intelligence bonus
            const intBonus = Math.max(0, Math.floor((intelligence - 12) / 2));
            const totalSlots = baseSlots + intBonus;
            
            document.getElementById('available-skill-slots').textContent = totalSlots;
            
            // Calculate used slots
            const usedSlots = calculateUsedSkillSlots();
            document.getElementById('used-skill-slots').textContent = usedSlots;
            document.getElementById('remaining-skill-slots').textContent = Math.max(0, totalSlots - usedSlots);
        }

        function calculateUsedSkillSlots() {
            const skills = ['agriculture', 'animal-handling', 'appraisal', 'weaponsmithing', 'carpentry', 'cooking'];
            let total = 0;
            
            skills.forEach(skill => {
                const element = document.getElementById(skill + '-slots');
                if (element) {
                    total += parseInt(element.value) || 0;
                }
            });
            
            return total;
        }

        function updateSkillPercentage(skill) {
            const slots = parseInt(document.getElementById(skill + '-slots').value) || 0;
            let baseAbility = 10; // Default
            
            // Determine base ability for each skill
            const skillAbilities = {
                'agriculture': characterData.abilities.intelligence.final,
                'animal-handling': characterData.abilities.wisdom.final,
                'appraisal': characterData.abilities.intelligence.final,
                'weaponsmithing': characterData.abilities.intelligence.final,
                'carpentry': characterData.abilities.strength.final,
                'cooking': characterData.abilities.intelligence.final
            };
            
            baseAbility = skillAbilities[skill] || 10;
            const percentage = Math.min(95, baseAbility + (slots * 15));
            
            document.getElementById(skill + '-percentage').textContent = percentage + '%';
            updateSkillSlots();
        }

        function rollSkill(skill) {
            const percentage = parseInt(document.getElementById(skill + '-percentage').textContent) || 0;
            const roll = Math.floor(Math.random() * 100) + 1;
            const success = roll <= percentage;
            
            let result = `${skill.charAt(0).toUpperCase() + skill.slice(1).replace('-', ' ')}: ${roll} vs ${percentage}% - `;
            result += success ? '√âXITO' : 'FALLO';
            
            if (roll <= 5) result += ' (√âxito cr√≠tico)';
            else if (roll >= 96) result += ' (Fallo cr√≠tico)';
            
            addSkillLogEntry(result, success ? 'success' : 'danger');
        }

        function rollThiefSkill(skill) {
            const percentage = parseInt(document.getElementById(skill + '-percentage').textContent) || 0;
            const roll = Math.floor(Math.random() * 100) + 1;
            const success = roll <= percentage;
            
            const skillNames = {
                'climb-walls': 'Escalar',
                'find-traps': 'Detectar Trampas',
                'open-locks': 'Abrir Cerraduras',
                'move-silently': 'Moverse en Silencio',
                'hide-in-shadows': 'Ocultarse',
                'pick-pockets': 'Hurtar Carteras',
                'read-languages': 'Leer Lenguajes'
            };
            
            let result = `${skillNames[skill]}: ${roll} vs ${percentage}% - `;
            result += success ? '√âXITO' : 'FALLO';
            
            if (roll <= 5) result += ' (√âxito cr√≠tico)';
            else if (roll >= 96) result += ' (Fallo cr√≠tico)';
            
            addSkillLogEntry(result, success ? 'success' : 'danger');
        }

        function addSkillLogEntry(message, type = 'info') {
            const log = document.getElementById('skill-log');
            const time = new Date().toLocaleTimeString();
            const colors = {
                'info': '#4299e1',
                'success': '#48bb78',
                'warning': '#ed8936',
                'danger': '#f56565'
            };
            
            const entry = document.createElement('div');
            entry.style.color = colors[type];
            entry.style.marginBottom = '0.5rem';
            entry.innerHTML = `<span style="color: #718096;">[${time}]</span> ${message}`;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // Spells Tab Functions
        function updateSpellsDisplay() {
            const primary = characterData.classes.primary;
            const secondary = characterData.classes.secondary;
            const tertiary = characterData.classes.tertiary;
            
            const spellcasters = ['Mago', 'Hechicero', 'Cl√©rigo', 'Druida', 'Bardo', 'Palad√≠n', 'Ranger'];
            const isSpellcaster = spellcasters.includes(primary) || spellcasters.includes(secondary) || spellcasters.includes(tertiary);
            
            if (isSpellcaster) {
                document.getElementById('spell-caster-check').style.display = 'none';
                document.getElementById('spell-system').classList.remove('hidden');
                initializeSpellSystem(primary);
            } else {
                document.getElementById('spell-caster-check').style.display = 'block';
                document.getElementById('spell-system').classList.add('hidden');
            }
        }

        function initializeSpellSystem(primaryClass) {
            const level = parseInt(document.getElementById('level').value) || 1;
            
            // Determine spell levels based on class
            let maxSpellLevel = 7; // Divine classes
            if (primaryClass === 'Mago' || primaryClass === 'Hechicero') {
                maxSpellLevel = 9; // Arcane classes
            }
            
            // Create spell slots grid
            const grid = document.getElementById('spell-slots-grid');
            grid.innerHTML = '';
            
            for (let spellLevel = 1; spellLevel <= maxSpellLevel; spellLevel++) {
                const slotCard = document.createElement('div');
                slotCard.style.cssText = `
                    text-align: center;
                    padding: 1rem;
                    background: rgba(0,0,0,0.2);
                    border-radius: 8px;
                    border: 2px solid #4a5568;
                `;
                
                slotCard.innerHTML = `
                    <div style="color: #e2e8f0; font-weight: bold; margin-bottom: 0.5rem;">Nivel ${spellLevel}</div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="number" id="spell-slots-level-${spellLevel}" min="0" max="20" value="0" 
                               style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;">
                        <span style="color: #cbd5e0;">slots</span>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 0.3rem;">
                        <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="adjustSpellSlots(${spellLevel}, -1)">-</button>
                        <button class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;" onclick="adjustSpellSlots(${spellLevel}, 1)">+</button>
                    </div>
                `;
                
                grid.appendChild(slotCard);
            }
            
            // Initialize spell progression table
            updateSpellProgressionTable(primaryClass);
        }

        function adjustSpellSlots(level, amount) {
            const input = document.getElementById(`spell-slots-level-${level}`);
            const currentValue = parseInt(input.value) || 0;
            const newValue = Math.max(0, Math.min(20, currentValue + amount));
            input.value = newValue;
        }

        function applySpellProgression() {
            const primaryClass = characterData.classes.primary;
            const level = parseInt(document.getElementById('level').value) || 1;
            
            if (spellProgression[primaryClass] && spellProgression[primaryClass][level]) {
                const slots = spellProgression[primaryClass][level];
                
                slots.forEach((slotCount, index) => {
                    const spellLevel = index + 1;
                    const input = document.getElementById(`spell-slots-level-${spellLevel}`);
                    if (input) {
                        input.value = slotCount;
                    }
                });
                
                showNotification(`Progresi√≥n autom√°tica aplicada para ${primaryClass} nivel ${level}`, 'success');
            } else {
                showNotification('No hay progresi√≥n autom√°tica disponible para esta clase/nivel', 'warning');
            }
        }

        function restoreAllSpellSlots() {
            const inputs = document.querySelectorAll('[id^="spell-slots-level-"]');
            inputs.forEach(input => {
                // Reset to maximum (you might want to implement used vs total slots)
                // For now, this is just a placeholder
            });
            
            showNotification('Todos los slots de conjuros restaurados', 'success');
            addSpellLogEntry('Descanso completo - Slots restaurados', 'success');
        }

        function updateSpellProgressionTable(primaryClass) {
            const table = document.getElementById('spell-progression-table');
            const currentLevel = parseInt(document.getElementById('level').value) || 1;
            
            if (!spellProgression[primaryClass]) {
                table.innerHTML = '<tr><td style="text-align: center; padding: 1rem; color: #a0aec0;">No hay tabla de progresi√≥n disponible</td></tr>';
                return;
            }
            
            let html = '<thead><tr style="border-bottom: 2px solid #4a5568;"><th style="padding: 0.5rem; text-align: center;">Nivel</th>';
            
            // Add spell level headers
            const maxSpellLevel = Math.max(...Object.values(spellProgression[primaryClass]).map(slots => slots.length));
            for (let i = 1; i <= maxSpellLevel; i++) {
                html += `<th style="padding: 0.5rem; text-align: center;">Nv ${i}</th>`;
            }
            html += '</tr></thead><tbody>';
            
            // Add progression rows
            for (let level = 1; level <= 10; level++) {
                const isCurrentLevel = level === currentLevel;
                const rowStyle = isCurrentLevel ? 'background: rgba(66, 153, 225, 0.2); border: 1px solid #4299e1;' : '';
                
                html += `<tr style="${rowStyle}"><td style="padding: 0.5rem; text-align: center; font-weight: bold;">${level}</td>`;
                
                const slots = spellProgression[primaryClass][level] || [];
                for (let i = 0; i < maxSpellLevel; i++) {
                    const slotCount = slots[i] || 0;
                    html += `<td style="padding: 0.5rem; text-align: center; color: ${slotCount > 0 ? '#48bb78' : '#718096'};">${slotCount || '-'}</td>`;
                }
                html += '</tr>';
            }
            
            html += '</tbody>';
            table.innerHTML = html;
        }

        function addSpellLogEntry(message, type = 'info') {
            const log = document.getElementById('spell-log');
            const time = new Date().toLocaleTimeString();
            const colors = {
                'info': '#805ad5',
                'success': '#48bb78',
                'warning': '#ed8936',
                'danger': '#f56565'
            };
            
            const entry = document.createElement('div');
            entry.style.color = colors[type];
            entry.style.marginBottom = '0.5rem';
            entry.innerHTML = `<span style="color: #718096;">[${time}]</span> ${message}`;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // Companions Tab Functions
        function updateCompanionsDisplay() {
            // Update companion statistics
            updateCompanionStats();
        }

        function updateCompanionStats() {
            const companions = characterData.companions || [];
            const activeCompanions = companions.filter(c => c.status !== 'dismissed');
            
            document.getElementById('active-companions').textContent = activeCompanions.length;
            
            const totalHP = activeCompanions.reduce((sum, c) => sum + (c.currentHP || 0), 0);
            document.getElementById('companions-total-hp').textContent = totalHP;
            
            const avgLevel = activeCompanions.length > 0 ? 
                Math.round(activeCompanions.reduce((sum, c) => sum + (c.level || 1), 0) / activeCompanions.length) : 0;
            document.getElementById('companions-avg-level').textContent = avgLevel;
        }

        function showAddCompanionModal() {
            showNotification('Modal de compa√±eros en desarrollo', 'info');
        }

        function restoreAllCompanions() {
            characterData.companions.forEach(companion => {
                companion.currentHP = companion.maxHP;
            });
            updateCompanionsDisplay();
            showNotification('Todos los compa√±eros curados completamente', 'success');
        }

        function companionGroupRest() {
            characterData.companions.forEach(companion => {
                companion.currentHP = Math.min(companion.maxHP, companion.currentHP + Math.floor(companion.maxHP * 0.5));
            });
            updateCompanionsDisplay();
            showNotification('Descanso grupal completado (50% HP restaurado)', 'success');
        }

        // Equipment Tab Functions
        function updateEquipmentDisplay() {
            updateInventoryStats();
            updateCarryCapacity();
        }

        function updateInventoryStats() {
            const items = characterData.equipment.items || [];
            
            const totalWeight = items.reduce((sum, item) => sum + ((item.weight || 0) * (item.quantity || 1)), 0);
            const totalValue = items.reduce((sum, item) => sum + ((item.value || 0) * (item.quantity || 1)), 0);
            
            document.getElementById('total-weight').textContent = totalWeight;
            document.getElementById('total-items').textContent = items.length;
            document.getElementById('total-value').textContent = totalValue;
            
            // Update carry capacity
            const strength = characterData.abilities.strength.final;
            const capacity = getCarryingCapacity(strength);
            document.getElementById('carry-capacity').textContent = capacity;
            
            updateWeightProgressBar(totalWeight, capacity);
        }

        function updateCarryCapacity() {
            const strength = characterData.abilities.strength.final;
            const capacity = getCarryingCapacity(strength);
            document.getElementById('carry-capacity').textContent = capacity;
        }

        function updateWeightProgressBar(currentWeight, maxCapacity) {
            const percentage = (currentWeight / maxCapacity) * 100;
            const bar = document.getElementById('weight-progress-bar');
            const status = document.getElementById('weight-status');
            
            bar.style.width = Math.min(percentage, 100) + '%';
            
            if (percentage <= 50) {
                bar.style.background = 'linear-gradient(90deg, #48bb78, #38a169)';
                status.textContent = 'Normal';
                status.style.color = '#48bb78';
            } else if (percentage <= 100) {
                bar.style.background = 'linear-gradient(90deg, #ed8936, #dd6b20)';
                status.textContent = 'Cargado';
                status.style.color = '#ed8936';
            } else {
                bar.style.background = 'linear-gradient(90deg, #f56565, #e53e3e)';
                status.textContent = 'Sobrecargado';
                status.style.color = '#f56565';
            }
        }

        function updateMoney() {
            const gold = parseInt(document.getElementById('gold-coins').value) || 0;
            const silver = parseInt(document.getElementById('silver-coins').value) || 0;
            const copper = parseInt(document.getElementById('copper-coins').value) || 0;
            const platinum = parseInt(document.getElementById('platinum-coins').value) || 0;
            
            // Convert to gold equivalent (1 pp = 5 po, 1 po = 1 po, 1 pp = 10 pp, 1 pc = 0.1 po)
            const totalGold = (platinum * 5) + gold + (silver * 0.1) + (copper * 0.01);
            
            document.getElementById('total-gold-equivalent').textContent = totalGold.toFixed(2) + ' po';
            
            characterData.equipment.money = { gold, silver, copper, platinum };
        }

        function showAddItemModal() {
            showNotification('Modal de items en desarrollo', 'info');
        }

        function showQuickEquipModal() {
            showNotification('Equipo r√°pido en desarrollo', 'info');
        }

        function sortInventory() {
            showNotification('Inventario ordenado', 'success');
        }

        function exportInventory() {
            const data = JSON.stringify(characterData.equipment, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `${characterData.basic.name || 'personaje'}_inventario.json`;
            link.click();
            
            showNotification('Inventario exportado', 'success');
        }

        // Header Actions
        function saveCharacter() {
            // Update character data from form
            characterData.basic.name = document.getElementById('character-name').value;
            characterData.basic.player = document.getElementById('player-name').value;
            characterData.basic.race = document.getElementById('race').value;
            characterData.basic.alignment = document.getElementById('alignment').value;
            characterData.basic.height = parseInt(document.getElementById('height').value);
            characterData.basic.religion = document.getElementById('religion').value;
            characterData.basic.experience = parseInt(document.getElementById('experience').value);
            characterData.basic.level = parseInt(document.getElementById('level').value);
            
            // Store in localStorage
            localStorage.setItem('addCharacterData', JSON.stringify(characterData));
            
            showNotification('Personaje guardado exitosamente', 'success');
        }

        function rollStats() {
            generateAllAbilities();
            showNotification('Todas las habilidades generadas con 4d6', 'success');
        }

        function rollHP() {
            const level = parseInt(document.getElementById('level').value) || 1;
            const constitution = characterData.abilities.constitution.final || 10;
            const conBonus = Math.floor((constitution - 15) / 2);
            
            // Simple HP calculation (d8 hit die for average class)
            let totalHP = 8; // Max at level 1
            for (let i = 2; i <= level; i++) {
                totalHP += Math.floor(Math.random() * 8) + 1;
            }
            totalHP += conBonus * level;
            totalHP = Math.max(1, totalHP);
            
            document.getElementById('max-hp').value = totalHP;
            document.getElementById('current-hp').value = totalHP;
            
            showNotification(`HP generado: ${totalHP} (${level}d8 + ${conBonus * level})`, 'success');
        }

        function exportCharacter() {
            const dataStr = JSON.stringify(characterData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `${characterData.basic.name || 'personaje'}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Personaje exportado exitosamente', 'success');
        }

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 90px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1001;
                max-width: 300px;
                animation: slideIn 0.3s ease;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            `;
            
            const colors = {
                'success': 'linear-gradient(135deg, #48bb78, #38a169)',
                'error': 'linear-gradient(135deg, #f56565, #e53e3e)',
                'info': 'linear-gradient(135deg, #4299e1, #3182ce)',
                'warning': 'linear-gradient(135deg, #ed8936, #dd6b20)'
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Load saved character data
        function loadCharacter() {
            const saved = localStorage.getItem('addCharacterData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    characterData = { ...characterData, ...data };
                    
                    // Populate form fields
                    if (data.basic) {
                        document.getElementById('character-name').value = data.basic.name || '';
                        document.getElementById('player-name').value = data.basic.player || '';
                        document.getElementById('race').value = data.basic.race || '';
                        document.getElementById('alignment').value = data.basic.alignment || 'Neutral Aut√©ntico';
                        document.getElementById('height').value = data.basic.height || 175;
                        document.getElementById('religion').value = data.basic.religion || '';
                        document.getElementById('experience').value = data.basic.experience || 0;
                        document.getElementById('level').value = data.basic.level || 1;
                    }
                    
                    // Update displays
                    updateCharacterDisplay();
                    updateSizeCategory();
                    updateAllBasicStats();
                    
                    console.log('Character data loaded successfully');
                } catch (e) {
                    console.error('Error loading character data:', e);
                }
            }
        }

        // Add notification animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCharacter();
            updateAllBasicStats();
            updateManaCards();
            updateSavingThrows();
            
            console.log('AD&D 2e Character Sheet initialized');
        });

        // Auto-save on changes
        let saveTimeout;
        document.addEventListener('input', function() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveCharacter();
            }, 2000); // Auto-save after 2 seconds of inactivity
        });

        // Event listeners for stats changes
        document.addEventListener('statsChanged', function() {
            updateCombatStats();
            updateCarryCapacity();
        });
    </script>
</body>
</html>        }

        // Dropdown Management
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(category + '-dropdown');
            dropdown.querySelectorAll('.dropdown-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
            
            // Close dropdown
            dropdown.classList.remove('show');
            
            // Update character display
            updateCharacterDisplay();
            updateManaCards();
            updateAllBasicStats();
        }

        function getDropdownText(category) {
            const texts = {
                'primary': 'üèõÔ∏è Categor√≠a Principal',
                'secondary': '‚ö° Categor√≠a Secundaria', 
                'tertiary': '‚≠ê Categor√≠a Terciaria'
            };
            return texts[category] || '';
        }

        function getClassIcon(className) {
            const icons = {
                'Guerrero': '‚öîÔ∏è',
                'B√°rbaro': 'ü™ì',
                'Palad√≠n': '‚õ™',
                'Ranger': 'üèπ',
                'Cl√©rigo': 'üõ°Ô∏è',
                'Druida': 'üåø',
                'Mago': 'üßô',
                'Hechicero': '‚ú®',
                'Ladr√≥n': 'ü•∑',
                'Bardo': 'üé≠',
                'Psi√≥nico': 'üß†'
            };
            return icons[className] || '‚öîÔ∏è';
        }

        // Background Selection
        function selectBackground(background) {
            characterData.background = background;
            
            const header = document.getElementById('background-dropdown-header');
            const span = header.querySelector('span');
            span.textContent = getBackgroundIcon(background) + ' ' + background;
            
            const dropdown = document.getElementById('background-dropdown');
            dropdown.querySelectorAll('.dropdown-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
            dropdown.classList.remove('show');
            
            updateAllAbilityScores();
        }

        function getBackgroundIcon(background) {
            const icons = {
                'Soldado': 'üõ°Ô∏è',
                'Noble': 'üëë',
                'Erudito': 'üìö',
                'Artesano': 'üî®',
                'Explorador': 'üó∫Ô∏è',
                'Mercader': 'üí∞'
            };
            return icons[background] || 'üè∞';
        }

        // Character Display Updates
        function updateCharacterDisplay() {
            const name = document.getElementById('character-name').value || 'Nuevo Personaje';
            const level = document.getElementById('level').value || 1;
            const primaryClass = characterData.classes.primary || 'Sin clase';
            
            document.getElementById('character-display-name').textContent = name;
            document.getElementById('character-display-info').textContent = `${primaryClass} ‚Ä¢ Nivel ${level}`;
            
            characterData.basic.name = name;
            characterData.basic.level = parseInt(level);
        }

        // Categories Tab Functions
        function updateCategoriesDisplay() {
            const primary = characterData.classes.primary;
            const secondary = characterData.classes.secondary;
            const tertiary = characterData.classes.tertiary;
            const background = characterData.background;

            // Update primary class card
            if (primary && primary !== 'Ninguna') {
                const card = document.getElementById('primary-class-card');
                const content = document.getElementById('primary-class-content');
                const info = classInfo[primary];
                
                if (info) {
                    content.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 3rem;">${info.icon}</div>
                            <div>
                                <h4 style="color: #f7fafc; margin: 0;">${primary}</h4>
                                <div style="color: #a0aec0; font-size: 0.9rem;">Dado de Golpe: ${info.hitDie}</div>
                            </div>
                        </div>
                        <p style="color: #e2e8f0; margin-bottom: 1rem;">${info.description}</p>
                        <div style="margin-bottom: 1rem;">
                            <strong style="color: #4299e1;">Habilidades:</strong>
                            <div style="color: #cbd5e0; font-size: 0.9rem;">${info.abilities}</div>
                        </div>
                        <div>
                            <strong style="color: #f56565;">Restricciones:</strong>
                            <div style="color: #cbd5e0; font-size: 0.9rem;">${info.restrictions}</div>
                        </div>
                    `;
                    card.classList.remove('hidden');
                }
            } else {
                document.getElementById('primary-class-card').classList.add('hidden');
            }

            // Update secondary class card
            if (secondary && secondary !== 'Ninguna') {
                const card = document.getElementById('secondary-class-card');
                const content = document.getElementById('secondary-class-content');
                const info = classInfo[secondary];
                
                if (info) {
                    content.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 2.5rem;">${info.icon}</div>
                            <div>
                                <h5 style="color: #f7fafc; margin: 0;">${secondary}</h5>
                                <div style="color: #a0aec0; font-size: 0.8rem;">Clase Secundaria</div>
                            </div>
                        </div>
                        <p style="color: #e2e8f0; font-size: 0.9rem;">${info.description}</p>
                    `;
                    card.classList.remove('hidden');
                }
            } else {
                document.getElementById('secondary-class-card').classList.add('hidden');
            }

            // Update background card
            if (background) {
                const card = document.getElementById('background-card');
                const content = document.getElementById('background-content');
                const info = backgroundInfo[background];
                
                if (info) {
                    content.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 2.5rem;">${info.icon}</div>
                            <div>
                                <h5 style="color: #f7fafc; margin: 0;">${background}</h5>
                                <div style="color: #48bb78; font-size: 0.8rem;">${info.bonus}</div>
                            </div>
                        </div>
                        <p style="color: #e2e8f0; font-size: 0.9rem; margin-bottom: 1rem;">${info.description}</p>
                        <div>
                            <strong style="color: #ed8936;">Habilidades:</strong>
                            <div style="color: #cbd5e0; font-size: 0.9rem;">${info.skills}</div>
                        </div>
                    `;
                    card.classList.remove('hidden');
                }
            } else {
                document.getElementById('background-card').classList.add('hidden');
            }

            // Hide info message if any class is selected
            if (primary || secondary || tertiary || background) {
                document.getElementById('selected-classes-info').style.display = 'none';
            } else {
                document.getElementById('selected-classes-info').style.display = 'block';
            }
        }

        // Combat Tab Functions
        function updateCombatStats() {
            const level = parseInt(document.getElementById('level').value) || 1;
            const primaryClass = characterData.classes.primary;
            const dexterity = characterData.abilities.dexterity.final;
            const strength = characterData.abilities.strength.final;
            
            // Calculate THAC0
            let thac0 = 20;
            if (classInfo[primaryClass]) {
                thac0 = classInfo[primaryClass].thac0 - Math.floor((level - 1) / 2);
            }
            document.getElementById('thac0').textContent = thac0;
            
            // Calculate Initiative bonus
            const initBonus = Math.floor((dexterity - 15) / 2);
            document.getElementById('initiative-bonus').textContent = initBonus >= 0 ? '+' + initBonus : initBonus;
            
            // Calculate Attacks per Round
            let attacksPerRound = 1;
            if (primaryClass === 'Guerrero' || primaryClass === 'Palad√≠n' || primaryClass === 'Ranger') {
                if (level >= 7 && level <= 12) attacksPerRound = 1.5;
                else if (level >= 13) attacksPerRound = 2;
            }
            document.getElementById('attacks-per-round').textContent = attacksPerRound;
            
            updateArmorClass();
        }

        function updateArmorClass() {
            let ac = 10;
            const armor = document.getElementById('body-armor').value;
            const shield = document.getElementById('shield').value;
            const dexterity = characterData.abilities.dexterity.final;
            
            // Base armor AC
            const armorAC = {
                'none': 10,
                'leather': 8,
                'studded': 7,
                'chain': 5,
                'splint': 4,
                'plate': 3
            };
            
            ac = armorAC[armor] || 10;
            
            // Shield bonus
            const shieldBonus = {
                'none': 0,
                'small': 1,
                'medium': 2,
                'large': 3
            };
            
            ac -= shieldBonus[shield] || 0;
            
            // Dexterity bonus (only if not in heavy armor)
            if (armor !== 'splint' && armor !== 'plate') {
                const dexBonus = Math.floor((dexterity - 15) / 2);
                ac -= Math.max(-4, Math.min(2, dexBonus)); // Cap at -4 to +2
            }
            
            document.getElementById('armor-class').textContent = ac;
            
            // Update AC breakdown
            let breakdown = `Base ${armorAC[armor] || 10}`;
            if (shieldBonus[shield]) breakdown += `, Escudo -${shieldBonus[shield]}`;
            if (armor !== 'splint' && armor !== 'plate') {
                const dexBonus = Math.floor((dexterity - 15) / 2);
                if (dexBonus !== 0) breakdown += `, Des ${dexBonus >= 0 ? '-' + dexBonus : '+' + Math.abs(dexBonus)}`;
            }
            document.getElementById('ac-breakdown').textContent = `(${breakdown})`;
            
            characterData.combat.armorClass = ac;
        }

        // Combat Action Functions
        function rollInitiative() {
            const dexBonus = Math.floor((characterData.abilities.dexterity.final - 15) / 2);
            const roll = Math.floor(Math.random() * 10) + 1;
            const total = roll + dexBonus;
            
            addCombatLogEntry(`Iniciativa: ${roll} + ${dexBonus} = ${total}`, 'success');
        }

        function rollToHit() {
            const roll = Math.floor(Math.random() * 20) + 1;
            const thac0 = parseInt(document.getElementById('thac0').textContent);
            const strBonus = Math.floor((characterData.abilities.strength.final - 15) / 2);
            const total = roll + strBonus;
            const acHit = thac0 - total;
            
            let result = `Ataque: ${roll}`;
            if (strBonus !== 0) result += ` + ${strBonus}`;
            result += ` = ${total} (impacta CA ${acHit} o mejor)`;
            
            if (roll === 20) result += ' - ¬°Cr√≠tico!';
            else if (roll === 1) result += ' - Pifia';
            
            addCombatLogEntry(result, roll === 20 ? 'success' : roll === 1 ? 'danger' : 'info');
        }

        function rollDamage() {
            // Simple damage roll (1d8 for average weapon)
            const roll = Math.floor(Math.random() * 8) + 1;
            const strBonus = Math.floor((characterData.abilities.strength.final - 15) / 2);
            const total = Math.max(1, roll + strBonus);
            
            let result = `Da√±o: ${roll}`;
            if (strBonus !== 0) result += ` + ${strBonus}`;
            result += ` = ${total} puntos`;
            
            addCombatLogEntry(result, 'warning');
        }

        function rollSavingThrow() {
            const saves = ['death', 'wands', 'petrification', 'breath', 'spells'];
            const saveNames = ['Muerte/Par√°lisis', 'Varitas', 'Petrificaci√≥n', 'Aliento', 'Conjuros'];
            const randomSave = saves[Math.floor(Math.random() * saves.length)];
            const saveName = saveNames[saves.indexOf(randomSave)];
            const saveValue = parseInt(document.getElementById('save-' + randomSave + '-total').textContent);
            
            const roll = Math.floor(Math.random() * 20) + 1;
            const success = roll >= saveValue;
            
            const result = `Salvaci√≥n vs ${saveName}: ${roll} vs ${saveValue} - ${success ? '√âXITO' : 'FALLO'}`;
            addCombatLogEntry(result, success ? 'success' : 'danger');
        }

        function addCombatLogEntry(message, type = 'info') {
            const log = document.getElementById('combat-log');
            const time = new Date().toLocaleTimeString();
            const colors = {
                'info': '#4299e1',
                'success': '#48bb78',
                'warning': '#ed8936',
                'danger': '#f56565'
            };
            
            const entry = document.createElement('div');
            entry.style.color = colors[type];
            entry.style.marginBottom = '0.5rem';
            entry.innerHTML = `<span style="color: #718096;">[${time}]</span> ${message}`;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // Size Category Update
        function updateSizeCategory() {
            const height = parseInt(document.getElementById('height').value);
            let size = 'Mediano';
            
            if (height < 120) size = 'Peque√±o';
            else if (height > 200) size = 'Grande';
            
            document.getElementById('size-category').value = size;
            characterData.basic.height = height;
            
            updateAllAbilityScores();
        }

        // XP and Level Conversion
        function updateLevelFromXP() {
            const xp = parseInt(document.getElementById('experience').value) || 0;
            let level = 1;
            
            for (let i = 0; i < xpTable.length; i++) {
                if (xp >= xpTable[i]) {
                    level = i + 1;
                }
            }
            
            document.getElementById('level').value = level;
            characterData.basic.experience = xp;
            characterData.basic.level = level;
            
            updateXPProgress();
            updateCharacterDisplay();
        }

        function updateXPFromLevel() {
            const level = parseInt(document.getElementById('level').value) || 1;
            const xp = xpTable[level - 1] || 0;
            
            document.getElementById('experience').value = xp;
            characterData.basic.experience = xp;
            characterData.basic.level = level;
            
            updateXPProgress();
            updateCharacterDisplay();
        }

        function convertXPToLevel() {
            updateLevelFromXP();
        }

        function updateXPProgress() {
            const currentXP = parseInt(document.getElementById('experience').value) || 0;
            const level = parseInt(document.getElementById('level').value) || 1;
            
            document.getElementById('current-xp-display').textContent = currentXP.toLocaleString();
            document.getElementById('current-level-display').textContent = level;
            
            if (level < 20) {
                const nextLevelXP = xpTable[level] || xpTable[xpTable.length - 1];
                const currentLevelXP = xpTable[level - 1] || 0;
                const progress = ((currentXP - currentLevelXP) / (nextLevelXP - currentLevelXP)) * 100;
                
                document.getElementById('xp-progress-bar').style.width = Math.min(Math.max(progress, 0), 100) + '%';
                document.getElementById('xp-needed-display').textContent = `Necesita ${nextLevelXP.toLocaleString()} XP para nivel ${level + 1}`;
            } else {
                document.getElementById('xp-progress-bar').style.width = '100%';
                document.getElementById('xp-needed-display').textContent = 'Nivel m√°ximo alcanzado';
            }
        }

        // Mana Cards Management
        function updateManaCards() {
            const primary = characterData.classes.primary;
            const secondary = characterData.classes.secondary;
            const tertiary = characterData.classes.tertiary;
            
            // Hide all mana cards initially
            document.getElementById('arcane-mana-card').style.display = 'none';
            document.getElementById('divine-mana-card').style.display = 'none';
            document.getElementById('psp-card').style.display = 'none';
            
            // Show relevant mana cards
            const arcaneClasses = ['Mago', 'Hechicero', 'Bardo'];
            const divineClasses = ['Cl√©rigo', 'Druida', 'Palad√≠n', 'Ranger'];
            const psionicClasses = ['Psi√≥nico'];
            
            if (arcaneClasses.includes(primary) || arcaneClasses.includes(secondary) || arcaneClasses.includes(tertiary)) {
                document.getElementById('arcane-mana-card').style.display = 'block';
            }
            
            if (divineClasses.includes(primary) || divineClasses.includes(secondary) || divineClasses.includes(tertiary)) {
                document.getElementById('divine-mana-card').style.display = 'block';
            }
            
            if (psionicClasses.includes(primary) || psionicClasses.includes(secondary) || psionicClasses.includes(tertiary)) {
                document.getElementById('psp-card').style.display = 'block';
            }
        } document.getElementById(dropdownId);
            const header = dropdown.previousElementSibling;
            const icon = header.querySelector('i');
            
            dropdown.classList.toggle('show');
            
            if (dropdown.classList.contains('show')) {
                icon.style.transform = 'rotate(180deg)';
            } else {
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Class Selection
        function selectClass(category, className) {
            characterData.classes[category] = className;
            
            // Update header text
            const header = document.getElementById(category + '-dropdown-header');
            const span = header.querySelector('span');
            
            if (className === 'Ninguna') {
                span.textContent = getDropdownText(category);
            } else {
                span.textContent = getClassIcon(className) + ' ' + className;
            }
            
            // Update selected item
            const dropdown =             </div>




    <script>
        // Global character data
        let characterData = {
            basic: {
                name: '',
                player: '',
                race: '',
                alignment: 'Neutral Aut√©ntico',
                height: 175,
                religion: '',
                experience: 0,
                level: 1
            },
            abilities: {
                strength: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                dexterity: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                constitution: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                intelligence: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                wisdom: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' },
                charisma: { base: 10, racial: 0, background: 0, size: 0, final: 10, method: 'manual' }
            },
            classes: {
                primary: '',
                secondary: '',
                tertiary: ''
            },
            background: '',
            savingThrows: {
                death: { base: 14, mod1: 0, mod2: 0, total: 14 },
                wands: { base: 16, mod1: 0, mod2: 0, total: 16 },
                petrification: { base: 12, mod1: 0, mod2: 0, total: 12 },
                breath: { base: 17, mod1: 0, mod2: 0, total: 17 },
                spells: { base: 17, mod1: 0, mod2: 0, total: 17 }
            },
            combat: {
                armorClass: 10,
                thac0: 20,
                weapons: [],
                armor: 'none',
                shield: 'none'
            },
            skills: {
                general: {},
                thief: {},
                weaponProficiencies: []
            },
            spells: {
                slots: {},
                known: [],
                prepared: []
            },
            companions: [],
            equipment: {
                items: [],
                money: { gold: 0, silver: 0, copper: 0, platinum: 0 }
            }
        };

        // Class information database
        const classInfo = {
            'Guerrero': {
                icon: '‚öîÔ∏è',
                hitDie: 'd10',
                thac0: 20,
                saves: { death: 14, wands: 16, petrification: 12, breath: 17, spells: 17 },
                description: 'Maestro del combate cuerpo a cuerpo y las armas.',
                abilities: 'Especializaci√≥n en armas, ataques m√∫ltiples, liderazgo',
                restrictions: 'Limitado en el uso de magia'
            },
            'B√°rbaro': {
                icon: 'ü™ì',
                hitDie: 'd12',
                thac0: 20,
                saves: { death: 14, wands: 16, petrification: 12, breath: 16, spells: 17 },
                description: 'Guerrero salvaje con furia berserker.',
                abilities: 'Furia berserker, resistencia al miedo, supervivencia',
                restrictions: 'No puede usar armadura pesada, limitaciones m√°gicas'
            },
            'Palad√≠n': {
                icon: '‚õ™',
                hitDie: 'd10',
                thac0: 20,
                saves: { death: 12, wands: 14, petrification: 10, breath: 15, spells: 15 },
                description: 'Guerrero santo con poderes divinos.',
                abilities: 'Detectar mal, curar enfermedades, inmunidad al miedo',
                restrictions: 'Debe ser Legal Bueno, c√≥digo de honor estricto'
            },
            'Ranger': {
                icon: 'üèπ',
                hitDie: 'd10',
                thac0: 20,
                saves: { death: 14, wands: 16, petrification: 12, breath: 16, spells: 17 },
                description: 'Explorador y guardabosques experto.',
                abilities: 'Rastreo, combate con dos armas, conjuros divinos',
                restrictions: 'Limitado en ciudades, debe ser bueno'
            },
            'Cl√©rigo': {
                icon: 'üõ°Ô∏è',
                hitDie: 'd8',
                thac0: 20,
                saves: { death: 10, wands: 14, petrification: 13, breath: 16, spells: 15 },
                description: 'Servidor divino con poderes curativos.',
                abilities: 'Conjuros divinos, expulsar muertos vivientes',
                restrictions: 'Limitaciones de armas seg√∫n deidad'
            },
            'Druida': {
                icon: 'üåø',
                hitDie: 'd8',
                thac0: 20,
                saves: { death: 10, wands: 14, petrification: 13, breath: 16, spells: 15 },
                description: 'Guardi√°n de la naturaleza con magia natural.',
                abilities: 'Conjuros dru√≠dicos, forma salvaje, inmunidad a encantamientos',
                restrictions: 'Solo armadura de cuero, armas naturales'
            },
            'Mago': {
                icon: 'üßô',
                hitDie: 'd4',
                thac0: 21,
                saves: { death: 14, wands: 11, petrification: 13, breath: 15, spells: 12 },
                description: 'Maestro de las artes arcanas y la magia.',
                abilities: 'Conjuros arcanos, investigaci√≥n m√°gica, crear objetos',
                restrictions: 'Limitado en armas y armaduras'
            },
            'Hechicero': {
                icon: '‚ú®',
                hitDie: 'd4',
                thac0: 21,
                saves: { death: 14, wands: 11, petrification: 13, breath: 15, spells: 12 },
                description: 'Conjurador innato con magia espont√°nea.',
                abilities: 'Magia espont√°nea, metamagia, poder m√°gico natural',
                restrictions: 'Conjuros limitados pero flexibles'
            },
            'Ladr√≥n': {
                icon: 'ü•∑',
                hitDie: 'd6',
                thac0: 21,
                saves: { death: 13, wands: 14, petrification: 12, breath: 16, spells: 15 },
                description: 'Experto en sigilo, trampas y subterfugio.',
                abilities: 'Habilidades de ladr√≥n, ataque sorpresa, leer lenguajes',
                restrictions: 'Limitado en armadura y algunas armas'
            },
            'Bardo': {
                icon: 'üé≠',
                hitDie: 'd6',
                thac0: 20,
                saves: { death: 13, wands: 14, petrification: 12, breath: 16, spells: 15 },
                description: 'Aventurero vers√°til con habilidades m√°gicas y sociales.',
                abilities: 'Conjuros arcanos, habilidades de ladr√≥n, m√∫sica inspiradora',
                restrictions: 'Progresi√≥n m√°gica limitada'
            },
            'Psi√≥nico': {
                icon: 'üß†',
                hitDie: 'd6',
                thac0: 20,
                saves: { death: 13, wands: 14, petrification: 12, breath: 16, spells: 14 },
                description: 'Usuario de poderes mentales y ps√≠quicos.',
                abilities: 'Poderes psi√≥nicos, telepat√≠a, telequinesis',
                restrictions: 'Reglas especiales de PSP'
            }
        };

        // Background information database
        const backgroundInfo = {
            'Soldado': {
                icon: 'üõ°Ô∏è',
                description: 'Veterano de guerra con experiencia militar.',
                skills: 'Uso de armas, t√°cticas, liderazgo',
                bonus: '+1 Fuerza, +1 Constituci√≥n',
                equipment: 'Armas militares, armadura, insignias'
            },
            'Noble': {
                icon: 'üëë',
                description: 'Miembro de la aristocracia con educaci√≥n refinada.',
                skills: 'Etiqueta, historia, idiomas',
                bonus: '+1 Inteligencia, +1 Carisma',
                equipment: 'Ropas finas, joyas, documentos'
            },
            'Erudito': {
                icon: 'üìö',
                description: 'Acad√©mico con vasto conocimiento libresco.',
                skills: 'Investigaci√≥n, idiomas, conocimiento arcano',
                bonus: '+2 Inteligencia',
                equipment: 'Libros, instrumentos de escritura, pergaminos'
            },
            'Artesano': {
                icon: 'üî®',
                description: 'Trabajador especializado en un oficio.',
                skills: 'Artesan√≠a, comercio, reparaciones',
                bonus: '+1 Fuerza, +1 Destreza',
                equipment: 'Herramientas, materiales, productos'
            },
            'Explorador': {
                icon: 'üó∫Ô∏è',
                description: 'Viajero experimentado conocedor del mundo.',
                skills: 'Supervivencia, navegaci√≥n, idiomas',
                bonus: '+1 Destreza, +1 Sabidur√≠a',
                equipment: 'Equipo de viaje, mapas, br√∫jula'
            },
            'Mercader': {
                icon: 'üí∞',
                description: 'Comerciante con ojo para los negocios.',
                skills: 'Tasaci√≥n, negociaci√≥n, contactos',
                bonus: '+1 Inteligencia, +1 Carisma',
                equipment: 'Dinero, productos, contratos'
            }
        };

        // Racial modifiers (AD&D 2e)
        const racialModifiers = {
            'Humano': { str: 0, dex: 0, con: 0, int: 0, wis: 0, cha: 0 },
            'Elfo': { str: 0, dex: 1, con: -1, int: 0, wis: 0, cha: 0 },
            'Enano': { str: 0, dex: 0, con: 1, int: 0, wis: 0, cha: -1 },
            'Halfling': { str: -1, dex: 1, con: 0, int: 0, wis: 0, cha: 0 },
            'Gnomo': { str: 0, dex: 0, con: 1, int: 0, wis: 0, cha: 0 },
            'Semielfos': { str: 0, dex: 0, con: 0, int: 0, wis: 0, cha: 0 },
            'Semiorcos': { str: 1, dex: 0, con: 1, int: -1, wis: 0, cha: -2 }
        };

        // Background modifiers
        const backgroundModifiers = {
            'Soldado': { str: 1, dex: 0, con: 1, int: 0, wis: 0, cha: 0 },
            'Noble': { str: 0, dex: 0, con: 0, int: 1, wis: 0, cha: 1 },
            'Erudito': { str: 0, dex: 0, con: 0, int: 2, wis: 0, cha: 0 },
            'Artesano': { str: 1, dex: 1, con: 0, int: 0, wis: 0, cha: 0 },
            'Explorador': { str: 0, dex: 1, con: 0, int: 0, wis: 1, cha: 0 },
            'Mercader': { str: 0, dex: 0, con: 0, int: 1, wis: 0, cha: 1 }
        };

        // XP tables (simplified - Warrior progression)
        const xpTable = [
            0, 2000, 4000, 8000, 16000, 32000, 64000, 125000, 250000, 500000,
            750000, 1000000, 1250000, 1500000, 1750000, 2000000, 2250000, 2500000, 2750000, 3000000
        ];

        // Spell progression tables
        const spellProgression = {
            'Mago': {
                1: [1, 0, 0, 0, 0, 0, 0, 0, 0],
                2: [2, 0, 0, 0, 0, 0, 0, 0, 0],
                3: [2, 1, 0, 0, 0, 0, 0, 0, 0],
                4: [3, 2, 0, 0, 0, 0, 0, 0, 0],
                5: [4, 2, 1, 0, 0, 0, 0, 0, 0],
                6: [4, 2, 2, 0, 0, 0, 0, 0, 0],
                7: [4, 3, 2, 1, 0, 0, 0, 0, 0],
                8: [4, 3, 3, 2, 0, 0, 0, 0, 0],
                9: [4, 3, 3, 2, 1, 0, 0, 0, 0],
                10: [4, 4, 3, 2, 2, 0, 0, 0, 0]
            },
            'Cl√©rigo': {
                1: [1, 0, 0, 0, 0, 0, 0],
                2: [2, 0, 0, 0, 0, 0, 0],
                3: [2, 1, 0, 0, 0, 0, 0],
                4: [3, 2, 0, 0, 0, 0, 0],
                5: [3, 3, 1, 0, 0, 0, 0],
                6: [3, 3, 2, 0, 0, 0, 0],
                7: [3, 3, 2, 1, 0, 0, 0],
                8: [3, 3, 3, 2, 0, 0, 0],
                9: [4, 4, 3, 2, 1, 0, 0],
                10: [4, 4, 3, 3, 2, 0, 0]
            }
        };

        // Weapon database
        const weaponDatabase = {
            'Daga': { damage: '1d4', type: 'P', size: 'S', weight: 1, cost: 2 },
            'Espada Corta': { damage: '1d6', type: 'P', size: 'S', weight: 3, cost: 10 },
            'Espada Larga': { damage: '1d8', type: 'S', size: 'M', weight: 4, cost: 15 },
            'Espada de dos manos': { damage: '1d10', type: 'S', size: 'L', weight: 15, cost: 50 },
            'Maza': { damage: '1d6', type: 'B', size: 'M', weight: 10, cost: 8 },
            'Martillo de Guerra': { damage: '1d4+1', type: 'B', size: 'M', weight: 6, cost: 12 },
            'Hacha de Batalla': { damage: '1d8', type: 'S', size: 'M', weight: 7, cost: 15 },
            'Arco Corto': { damage: '1d6', type: 'P', size: 'M', weight: 2, cost: 30, range: '50/100/150' },
            'Arco Largo': { damage: '1d6', type: 'P', size: 'L', weight: 3, cost: 75, range: '70/140/210' },
            'Ballesta Ligera': { damage: '1d4', type: 'P', size: 'S', weight: 5, cost: 35, range: '60/120/180' }
        };

        // Tab Management
        function showTab(tabName, button) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            button.classList.add('active');

            // Update tab-specific content
            updateTabContent(tabName);

            // Dispatch tab change event
            document.dispatchEvent(new CustomEvent('tabChanged', { detail: tabName }));
        }

        function updateTabContent(tabName) {
            switch(tabName) {
                case 'categories':
                    updateCategoriesDisplay();
                    break;
                case 'combat':
                    updateCombatStats();
                    break;
                case 'skills':
                    updateSkillsDisplay();
                    break;
                case 'spells':
                    updateSpellsDisplay();
                    break;
                case 'companions':
                    updateCompanionsDisplay();
                    break;
                case 'equipment':
                    updateEquipmentDisplay();
                    break;
            }
        }
                        <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AD&D 2e Pandunk</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e, #16213e);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #1a202c, #2d3748);
            border-bottom: 2px solid #4a5568;
            padding: 0.8rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #f7fafc;
        }

        .logo i {
            color: #f6ad55;
            font-size: 1.8rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .header-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }

        .header-btn.save { background: linear-gradient(135deg, #48bb78, #38a169); }
        .header-btn.export { background: linear-gradient(135deg, #ed8936, #dd6b20); }

        /* Main Layout */
        .main-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, #1a202c, #2d3748);
            border-right: 2px solid #4a5568;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .character-card {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f6ad55, #ed8936);
            margin: 0 auto 1rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .character-name {
            color: #f7fafc;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .character-level {
            color: #cbd5e0;
            font-size: 0.9rem;
        }

        .dropdown-section {
            margin-bottom: 1.5rem;
        }

        .dropdown-header {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            padding: 0.8rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .dropdown-header:hover {
            background: linear-gradient(135deg, #718096, #4a5568);
            transform: translateX(4px);
        }

        .dropdown-header.primary { border-left: 4px solid #f6ad55; }
        .dropdown-header.secondary { border-left: 4px solid #4299e1; }
        .dropdown-header.tertiary { border-left: 4px solid #9f7aea; }
        .dropdown-header.background { border-left: 4px solid #48bb78; }

        .dropdown-content {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            padding: 0.5rem;
            display: none;
        }

        .dropdown-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .dropdown-item {
            padding: 0.6rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 0.3rem;
            transition: all 0.3s ease;
            color: #cbd5e0;
        }

        .dropdown-item:hover {
            background: rgba(66, 153, 225, 0.2);
            color: #e2e8f0;
            transform: translateX(4px);
        }

        .dropdown-item.selected {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            font-weight: bold;
        }

        /* Main Content */
        .main-content {
            background: linear-gradient(180deg, #16213e, #1a1a2e);
            padding: 1.5rem;
            overflow-y: auto;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            color: #cbd5e0;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: fit-content;
        }

        .tab-btn:hover {
            background: rgba(66, 153, 225, 0.2);
            color: #e2e8f0;
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            box-shadow: 0 4px 8px rgba(66, 153, 225, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            color: #e2e8f0;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 0.8rem;
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        /* Card Styles */
        .card {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Button Styles */
        .btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }

        .btn-success { background: linear-gradient(135deg, #48bb78, #38a169); }
        .btn-warning { background: linear-gradient(135deg, #ed8936, #dd6b20); }
        .btn-danger { background: linear-gradient(135deg, #f56565, #e53e3e); }
        .btn-purple { background: linear-gradient(135deg, #805ad5, #6b46c1); }

        /* Grid Styles */
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 2px solid #4a5568;
            }
            
            .header {
                padding: 0.5rem 1rem;
            }
            
            .header-actions {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .tab-navigation {
                flex-wrap: wrap;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-primary { color: #4299e1; }
        .text-success { color: #48bb78; }
        .text-warning { color: #ed8936; }
        .text-danger { color: #f56565; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .hidden { display: none; }
        .visible { display: block; }

        /* Combat Styles */
        .combat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .weapon-slot {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 2px dashed #4a5568;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            color: #a0aec0;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .weapon-slot.filled {
            border: 2px solid #48bb78;
            background: linear-gradient(135deg, #1a365d, #2c5282);
        }

        /* Skills Styles */
        .skill-category {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .skill-item:hover {
            background: rgba(66, 153, 225, 0.1);
            transform: translateX(4px);
        }

        /* Equipment Styles */
        .item-card {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .item-equipped {
            border-color: #48bb78;
            box-shadow: 0 0 0 2px rgba(72, 187, 120, 0.2);
        }

        .item-magical {
            border-color: #805ad5;
            box-shadow: 0 0 0 2px rgba(128, 90, 213, 0.2);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 2rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.3);
        }

        /* Companion Cards */
        .companion-card {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .companion-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .companion-healthy { border-left: 4px solid #48bb78; }
        .companion-injured { border-left: 4px solid #ed8936; }
        .companion-critical { border-left: 4px solid #f56565; }
        .companion-dead { border-left: 4px solid #718096; opacity: 0.6; }

        /* Health Bar */
        .health-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .health-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .health-full { background: linear-gradient(90deg, #48bb78, #38a169); }
        .health-injured { background: linear-gradient(90deg, #ed8936, #dd6b20); }
        .health-critical { background: linear-gradient(90deg, #f56565, #e53e3e); }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-dice-d20"></i>
            <span>AD&D 2e Pandunk</span>
        </div>
        <div class="header-actions">
            <button class="header-btn save" onclick="saveCharacter()">
                <i class="fas fa-save"></i>
                Guardar
            </button>
            <button class="header-btn" onclick="rollStats()">
                <i class="fas fa-dice"></i>
                Roll Stats
            </button>
            <button class="header-btn" onclick="rollHP()">
                <i class="fas fa-heart"></i>
                Roll HP
            </button>
            <button class="header-btn export" onclick="exportCharacter()">
                <i class="fas fa-download"></i>
                Exportar
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Character Card -->
            <div class="character-card">
                <div class="character-avatar">
                    <i class="fas fa-user"></i>
                </div>






            <!-- Class Dropdowns -->
            <div class="dropdown-section">
                <div class="dropdown-header primary" id="primary-dropdown-header" onclick="toggleDropdown('primary-dropdown')">
                    <span>üèõÔ∏è Categor√≠a Principal</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-content" id="primary-dropdown">
                    <div class="dropdown-item" onclick="selectClass('primary', 'Guerrero')">‚öîÔ∏è Guerrero</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'B√°rbaro')">ü™ì B√°rbaro</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Palad√≠n')">‚õ™ Palad√≠n</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Ranger')">üèπ Ranger</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Cl√©rigo')">üõ°Ô∏è Cl√©rigo</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Druida')">üåø Druida</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Mago')">üßô Mago</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Hechicero')">‚ú® Hechicero</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Ladr√≥n')">ü•∑ Ladr√≥n</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Bardo')">üé≠ Bardo</div>
                    <div class="dropdown-item" onclick="selectClass('primary', 'Psi√≥nico')">üß† Psi√≥nico</div>
                </div>
            </div>

            <div class="dropdown-section">
                <div class="dropdown-header secondary" id="secondary-dropdown-header" onclick="toggleDropdown('secondary-dropdown')">
                    <span>‚ö° Categor√≠a Secundaria</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-content" id="secondary-dropdown">
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Ninguna')">‚ùå Ninguna</div>
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Guerrero')">‚öîÔ∏è Guerrero</div>
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Ladr√≥n')">ü•∑ Ladr√≥n</div>
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Mago')">üßô Mago</div>
                    <div class="dropdown-item" onclick="selectClass('secondary', 'Cl√©rigo')">üõ°Ô∏è Cl√©rigo</div>
                </div>
            </div>

            <div class="dropdown-section">
                <div class="dropdown-header tertiary" id="tertiary-dropdown-header" onclick="toggleDropdown('tertiary-dropdown')">
                    <span>‚≠ê Categor√≠a Terciaria</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-content" id="tertiary-dropdown">
                    <div class="dropdown-item" onclick="selectClass('tertiary', 'Ninguna')">‚ùå Ninguna</div>
                    <div class="dropdown-item" onclick="selectClass('tertiary', 'Guerrero')">‚öîÔ∏è Guerrero</div>
                    <div class="dropdown-item" onclick="selectClass('tertiary', 'Ladr√≥n')">ü•∑ Ladr√≥n</div>
                    <div class="dropdown-item" onclick="selectClass('tertiary', 'Mago')">üßô Mago</div>
                </div>
            </div>

            <div class="dropdown-section">
                <div class="dropdown-header background" id="background-dropdown-header" onclick="toggleDropdown('background-dropdown')">
                    <span>üè∞ Trasfondos</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-content" id="background-dropdown">
                    <div class="dropdown-item" onclick="selectBackground('Soldado')">üõ°Ô∏è Soldado</div>
                    <div class="dropdown-item" onclick="selectBackground('Noble')">üëë Noble</div>
                    <div class="dropdown-item" onclick="selectBackground('Erudito')">üìö Erudito</div>
                    <div class="dropdown-item" onclick="selectBackground('Artesano')">üî® Artesano</div>
                    <div class="dropdown-item" onclick="selectBackground('Explorador')">üó∫Ô∏è Explorador</div>
                    <div class="dropdown-item" onclick="selectBackground('Mercader')">üí∞ Mercader</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Tab Navigation -->
            <nav class="tab-navigation">
                <button class="tab-btn active" onclick="showTab('basic', this)">
                    <i class="fas fa-user"></i>
                    B√°sico
                </button>
                <button class="tab-btn" onclick="showTab('abilities', this)">
                    <i class="fas fa-fist-raised"></i>
                    Habilidades
                </button>
                <button class="tab-btn" onclick="showTab('categories', this)">
                    <i class="fas fa-scroll"></i>
                    Categor√≠as
                </button>
                <button class="tab-btn" onclick="showTab('combat', this)">
                    <i class="fas fa-sword"></i>
                    Combate
                </button>
                <button class="tab-btn" onclick="showTab('skills', this)">
                    <i class="fas fa-tools"></i>
                    Pericias
                </button>
                <button class="tab-btn" onclick="showTab('spells', this)">
                    <i class="fas fa-magic"></i>
                    Conjuros
                </button>
                <button class="tab-btn" onclick="showTab('companions', this)">
                    <i class="fas fa-paw"></i>
                    Compa√±eros
                </button>
                <button class="tab-btn" onclick="showTab('equipment', this)">
                    <i class="fas fa-backpack"></i>
                    Equipo
                </button>
            </nav>

            <!-- Basic Info Tab -->
            <div id="basic-tab" class="tab-content active">
                <h2 class="mb-3 text-center">
                    <i class="fas fa-user text-primary"></i>
                    Informaci√≥n B√°sica
                </h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="character-name">
                            <i class="fas fa-signature"></i>
                            Nombre del Personaje
                        </label>
                        <input type="text" id="character-name" placeholder="Ej: Nombre del Personaje" onchange="updateCharacterDisplay()">
                    </div>
                    
                    <div class="form-group">
                        <label for="player-name">
                            <i class="fas fa-user-friends"></i>
                            Jugador
                        </label>
                        <input type="text" id="player-name" placeholder="Tu nombre">
                    </div>
                    
                    <div class="form-group">
                        <label for="race">
                            <i class="fas fa-users"></i>
                            Raza
                        </label>
                        <select id="race" onchange="updateCharacterDisplay(); updateAllBasicStats();">
                            <option value="">Selecciona Raza</option>
                            <option value="Humano">Humano</option>
                            <option value="Elfo">Elfo</option>
                            <option value="Enano">Enano</option>
                            <option value="Halfling">Halfling</option>
                            <option value="Gnomo">Gnomo</option>
                            <option value="Semielfos">Semielfo</option>
                            <option value="Semiorcos">Semiorco</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="alignment">
                            <i class="fas fa-balance-scale"></i>
                            Alineamiento
                        </label>
                        <select id="alignment">
                            <option value="Neutral Aut√©ntico">Neutral Aut√©ntico</option>
                            <option value="Legal Bueno">Legal Bueno</option>
                            <option value="Legal Neutral">Legal Neutral</option>
                            <option value="Legal Malvado">Legal Malvado</option>
                            <option value="Neutral Bueno">Neutral Bueno</option>
                            <option value="Neutral Malvado">Neutral Malvado</option>
                            <option value="Ca√≥tico Bueno">Ca√≥tico Bueno</option>
                            <option value="Ca√≥tico Neutral">Ca√≥tico Neutral</option>
                            <option value="Ca√≥tico Malvado">Ca√≥tico Malvado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="height">
                            <i class="fas fa-ruler-vertical"></i>
                            Altura (cm)
                        </label>
                        <input type="number" id="height" min="100" max="300" value="175" onchange="updateSizeCategory()">
                    </div>
                    
                    <div class="form-group">
                        <label for="size-category">
                            <i class="fas fa-expand-arrows-alt"></i>
                            Tama√±o
                        </label>
                        <input type="text" id="size-category" value="Mediano" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="religion">
                            <i class="fas fa-pray"></i>
                            Religi√≥n
                        </label>
                        <input type="text" id="religion" placeholder="Sin religi√≥n">
                    </div>
                    
                    <div class="form-group">
                        <label for="experience">
                            <i class="fas fa-star"></i>
                            Experiencia
                        </label>
                        <input type="number" id="experience" min="0" value="0" onchange="updateLevelFromXP()">
                    </div>
                    
                    <div class="form-group">
                        <label for="level">
                            <i class="fas fa-level-up-alt"></i>
                            Nivel
                        </label>
                        <input type="number" id="level" min="1" max="20" value="1" onchange="updateXPFromLevel(); updateCharacterDisplay();">
                    </div>
                </div>

                <!-- Saving Throws Section -->
                <div class="saving-throws-section mt-3">
                    <h3 class="mb-2 text-center">
                        <i class="fas fa-shield-alt text-warning"></i>
                        Tiradas de Salvaci√≥n
                    </h3>
                    
                    <div style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 12px; padding: 1.5rem;">
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem; font-weight: bold; color: #cbd5e0;">
                            <div>Tipo de Salvaci√≥n</div>
                            <div style="text-align: center;">Base</div>
                            <div style="text-align: center;">Mod1</div>
                            <div style="text-align: center;">Mod2</div>
                            <div style="text-align: center;">Total</div>
                        </div>
                        
                        <!-- Paralisis/Veneno/Muerte -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 0.8rem; align-items: center; padding: 0.8rem; background: rgba(0, 0, 0, 0.2); border-radius: 8px;">
                            <div style="color: #e2e8f0;">Par√°lisis/Veneno/Muerte</div>
                            <div style="text-align: center; color: #48bb78; font-weight: bold;" id="save-death-base">14</div>
                            <div style="text-align: center;">
                                <input type="number" id="save-death-mod1" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center;">
                                <input type="number" id="save-death-mod2" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.1rem;" id="save-death-total">14</div>
                        </div>
                        
                        <!-- Cetros/Varas/Varitas -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 0.8rem; align-items: center; padding: 0.8rem; background: rgba(0, 0, 0, 0.2); border-radius: 8px;">
                            <div style="color: #e2e8f0;">Cetros/Varas/Varitas</div>
                            <div style="text-align: center; color: #48bb78; font-weight: bold;" id="save-wands-base">16</div>
                            <div style="text-align: center;">
                                <input type="number" id="save-wands-mod1" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center;">
                                <input type="number" id="save-wands-mod2" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.1rem;" id="save-wands-total">16</div>
                        </div>
                        
                        <!-- Petrificaci√≥n/Transformaci√≥n -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 0.8rem; align-items: center; padding: 0.8rem; background: rgba(0, 0, 0, 0.2); border-radius: 8px;">
                            <div style="color: #e2e8f0;">Petrificaci√≥n/Transformaci√≥n</div>
                            <div style="text-align: center; color: #48bb78; font-weight: bold;" id="save-petrification-base">12</div>
                            <div style="text-align: center;">
                                <input type="number" id="save-petrification-mod1" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center;">
                                <input type="number" id="save-petrification-mod2" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.1rem;" id="save-petrification-total">12</div>
                        </div>
                        
                        <!-- Aliento de Drag√≥n -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 0.8rem; align-items: center; padding: 0.8rem; background: rgba(0, 0, 0, 0.2); border-radius: 8px;">
                            <div style="color: #e2e8f0;">Aliento de Drag√≥n</div>
                            <div style="text-align: center; color: #48bb78; font-weight: bold;" id="save-breath-base">17</div>
                            <div style="text-align: center;">
                                <input type="number" id="save-breath-mod1" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center;">
                                <input type="number" id="save-breath-mod2" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.1rem;" id="save-breath-total">17</div>
                        </div>
                        
                        <!-- Conjuros -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 0.8rem; align-items: center; padding: 0.8rem; background: rgba(0, 0, 0, 0.2); border-radius: 8px;">
                            <div style="color: #e2e8f0;">Conjuros</div>
                            <div style="text-align: center; color: #48bb78; font-weight: bold;" id="save-spells-base">17</div>
                            <div style="text-align: center;">
                                <input type="number" id="save-spells-mod1" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center;">
                                <input type="number" id="save-spells-mod2" value="0" min="-10" max="10" style="width: 60px; padding: 0.3rem; background: #1a202c; border: 1px solid #4a5568; border-radius: 4px; color: #e2e8f0; text-align: center;" onchange="updateSavingThrows()">
                            </div>
                            <div style="text-align: center; color: #f7fafc; font-weight: bold; font-size: 1.1rem;" id="save-spells-total">17</div>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-cards mt-3">
                    <h3 class="mb-2 text-center">
                        <i class="fas fa-heart text-danger"></i>
                        Estad√≠sticas Vitales
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <!-- HP Card -->
                        <div style="background: linear-gradient(135deg, #e53e3e, #c53030); border-radius: 12px; padding: 1.5rem; color: white; text-align: center;">
                            <h4 style="margin: 0 0 1rem 0;"><i class="fas fa-heart"></i> Puntos de Golpe</h4>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                                <input type="number" id="current-hp" min="0" value="8" style="width: 80px; padding: 0.5rem; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; text-align: center; font-size: 1.2rem; font-weight: bold;">
                                <span style="font-size: 1.5rem; font-weight: bold;">/</span>
                                <input type="number" id="max-hp" min="1" value="8" style="width: 80px; padding: 0.5rem; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; text-align: center; font-size: 1.2rem; font-weight: bold;">
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">Bonificaci√≥n Manual:</label>
                                <input type="number" id="hp-bonus" value="0" style="width: 80px; padding: 0.5rem; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; text-align: center;">
                            </div>
                        </div>

                        <!-- Arcane Mana Card -->
                        <div id="arcane-mana-card" style="background: linear-gradient(135deg, #805ad5, #6b46c1); border-radius: 12px; padding: 1.5rem; color: white; text-align: center; display: none;">
                            <h4 style="margin: 0 0 1rem 0;"><i class="fas fa-magic"></i> Man√° Arcano</h4>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                                <input type="number" id="current-arcane-mana" min="0" value="0" style="width: 80px; padding: 0.5rem; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; text-align: center; font-size: 1.2rem; font-weight: bold;">
                                <span style="font-size: 1.5rem; font-weight: bold;">/</span>
                                <input type="number" id="max-arcane-mana" min="0" value="0" style="width: 80px; padding: 0.5rem; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; text-align: center; font-size: 1.2rem; font-weight: bold;">
                            </div>
                        </div>

                        <!-- Divine Mana Card -->
                        <div id="divine-mana-card" style="background: linear-gradient(135deg, #4299e1, #3182ce); border-radius: 12px; padding: 1.5rem; color: white; text-align: center; display: none;">
                            <h4 style="margin: 0 0 1rem 0;"><i class="fas fa-pray"></i> Man√° Divino</h4>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                                <input type="number" id="current-divine-mana" min="0" value="0" style="width: 80px; padding: 0.5rem; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; text-align: center; font-size: 1.2rem; font-weight: bold;">
                                <span style="font-size: 1.5rem; font-weight: bold;">/</span>
                                <input type="number" id="max-divine-mana" min="0" value="0" style="width: 80px; padding: 0.5rem; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; text-align: center; font-size: 1.2rem; font-weight: bold;">
                            </div>
                        </div>

                        <!-- PSP Card -->
                        <div id="psp-card" style="background: linear-gradient(135deg, #ed64a6, #d53f8c); border-radius: 12px; padding: 1.5rem; color: white; text-align: center; display: none;">
                            <h4 style="margin: 0 0 1rem 0;"><i class="fas fa-brain"></i> Pool PSP</h4>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                                <input type="number" id="current-psp" min="0" value="0" style="width: 80px; padding: 0.5rem; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; text-align: center; font-size: 1.2rem; font-weight: bold;">
                                <span style="font-size: 1.5rem; font-weight: bold;">/</span>
                                <input type="number" id="max-psp" min="0" value="0" style="width: 80px; padding: 0.5rem; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 6px; color: white; text-align: center; font-size: 1.2rem; font-weight: bold;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- XP Progress -->
                <div class="xp-progress mt-3">
                    <h3 class="mb-2 text-center">
                        <i class="fas fa-star text-warning"></i>
                        Progresi√≥n de Experiencia
                    </h3>
                    
                    <div style="background: linear-gradient(135deg, #2d3748, #1a202c); border: 1px solid #4a5568; border-radius: 12px; padding: 1.5rem;">
                        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                            <div style="text-align: center;">
                                <div style="color: #cbd5e0; font-size: 0.9rem;">XP Actual</div>
                                <div style="color: #4299e1; font-size: 1.5rem; font-weight: bold;" id="current-xp-display">0</div>
                            </div>
                            <div style="text-align: center;">
                                <button onclick="convertXPToLevel()" style="background: linear-gradient(135deg, #48bb78, #38a169); border: none; padding: 0.8rem 1.2rem; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                                    <i class="fas fa-exchange-alt"></i><br>Convertir
                                </button>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #cbd5e0; font-size: 0.9rem;">Nivel Actual</div>
                                <div style="color: #48bb78; font-size: 1.5rem; font-weight: bold;" id="current-level-display">1</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="color: #cbd5e0; font-size: 0.9rem;">Progreso al siguiente nivel</span>
                                <span style="color: #e2e8f0; font-size: 0.9rem;" id="xp-needed-display">Necesita 2000 XP para nivel 2</span>
                            </div>
                            <div style="width: 100%; height: 12px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; overflow: hidden;">
                                <div id="xp-progress-bar" style="height: 100%; background: linear-gradient(90deg, #4299e1, #48bb78); width: 0%; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
